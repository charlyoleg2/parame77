import{f as U,C as Vo,S as $o,i as Xo,a as Yo,b as n,p as Jt,w as Ro,t as uo,c as Mt,d as M,g as Ns,h as No,j as Mo,E as j,k as ee,l as e,m as Tt,n as We,o as Te,q as ae,r as z,u as we,v as Qt,x as ho,y as Ds,z as ao}from"./CnQuUVUo.js";function ke(c){return c.toFixed(2)}function oo(c){let t=c;for(;t<-Math.PI;)t+=2*Math.PI;for(;t>Math.PI;)t-=2*Math.PI;return t}function Wo(c){let t=!1;const r=10**-4;return Math.abs(c)<r&&(t=!0),t}function Ye(c,t,r){let o="";if(r===0)throw`err${c}: ${t}`;return r===1&&(o+=`warn${c}: ${t}
`),o}function To(c,t,r=0){let o="";const s=oo(c);if(s<=0||Wo(s)){const i=`${t} : a1 ${ke(c)}, a1b ${ke(s)} is null or negative`;o+=Ye("145",i,r)}return o}function Oe(c,t,r=0){let o="";if(c<=0||Wo(c)){const s=`${t} : l1 ${ke(c)} is null or negative`;o+=Ye("159",s,r)}return o}function Es(c,t,r=0){let o="";const s=oo(c),i=oo(t);if(o+=To(s,"triAArA.a1",2),o+=To(i,"triAArA.a2",2),Math.sign(c)*Math.sign(t)<0){const d=`triAArA : the signs of a1 ${ke(c)} and a2 ${ke(t)} differ`;o+=Ye("178",d,r)}if(Math.abs(s)+Math.abs(i)>=Math.PI){const d=`triAArA : a1 ${ke(c)} plus a2 ${ke(t)} are bigger than Pi`;o+=Ye("182",d,r)}return[oo(Math.PI-c-t),o]}function Cs(c,t,r,o=0){let s="";const[i,l]=Es(c,r,o);s+=l,s+=Oe(t,"triALArLL.l12",o);let d=0,h=0;if(Wo(i)){const f=`triALArLL : flat triangle with a1 ${ke(c)}, a2 ${ke(r)} and a3 ${ke(i)}`;s+=Ye("209",f,o),Wo(c)?(d=0,h=t):(d=t,h=0)}else d=t*Math.sin(c)/Math.sin(i),h=t*Math.sin(r)/Math.sin(i);return[d,h,s]}function Ue(c,t,r,o=0){let s="";s+=Oe(c,"triLALrL.l1",o),s+=To(t,"triLALrL.a12",2),s+=Oe(r,"triLALrL.l2",o);const i=c**2+r**2-2*c*r*Math.cos(t);if(i<0){const d=`triLALrL : ql3 ${ke(i)} is negative with l1 ${ke(c)}, a12 ${ke(t)}, l2 ${ke(r)}`;s+=Ye("241",d,o)}return[Math.sqrt(i),s]}function Eo(c,t,r,o=0){let s="";s+=To(c,"triALLrL.a31",2),s+=Oe(t,"triALLrL.l1",o),s+=Oe(r,"triALLrL.l2",o);const i=-2*t*Math.cos(c),l=t**2-r**2,d=i**2-4*l;if(d<0){const a=`triALLrL : qD ${ke(d)} is negative with a31 ${ke(c)}, l1 ${ke(t)}, l2 ${ke(r)}`;s+=Ye("271",a,o)}const h=(-i-Math.sqrt(d))/2,f=(-i+Math.sqrt(d))/2;return s+=Oe(h,"triALLrL.rx1",2),s+=Oe(f,"triALLrL.rx2",2),[h,f,s]}function eo(c,t,r,o=0){let s="";const[i,l,d]=Eo(c,t,r,o);s+=d;const h=i>0?c:oo(c-Math.PI),f=l>0?c:oo(c-Math.PI),[a,b]=Xe(r,Math.abs(i),t,o),[g,S]=Xe(r,Math.abs(l),t,o);s+=b+S;const _=Math.sign(h)*a,x=Math.sign(f)*g;return[i,h,_,l,f,x,s]}function Xe(c,t,r,o=0){let s="";s+=Oe(c,"triLLLrA.l1",o),s+=Oe(t,"triLLLrA.l2",o),s+=Oe(r,"triLLLrA.l3",o);const i=(r**2+c**2-t**2)/(2*r*c);if(Math.abs(i)>1){const d=`triLLLrA : cosA31 ${ke(i)} is bigger than 1`;s+=Ye("296",d,o)}return[Math.acos(i),s]}var de=(c=>(c[c.eA=0]="eA",c[c.eB=1]="eB",c))(de||{}),ie=(c=>(c[c.eABRight=0]="eABRight",c[c.eABLeft=1]="eABLeft",c))(ie||{});function Os(c){let t=0;return c===t&&(t=1),t}var fo=class Co extends Vo{pJuncs=[];lastPosition=-1;facetIdx=-1;ctrIdx=-1;used=0;startJunction(t,r,o){for(const i of this.pJuncs)if(i.jName===t)throw`err209: jName ${t} already used`;const s=this.segments.length-1;if(s===this.lastPosition)throw`err210: jName ${t} overwrites previous position ${s}`;return this.lastPosition=s,this.pJuncs.push({jName:t,jDir:r,jSide:o,jPosition:s}),this}findIdx(t){let r=-1;for(const[o,s]of this.pJuncs.entries())t===s.jName&&(r=o);return r}cloneJ(t){const r=new Co(t.segments[0].px,t.segments[0].py);for(const o of t.segments){const s=o.clone();s.sType!==$o.eStart&&(r.addSeg(s),Xo(s.sType)&&r.setLastPoint(s.px,s.py))}for(const o of this.pJuncs)r.pJuncs.push({jName:o.jName,jDir:o.jDir,jSide:o.jSide,jPosition:o.jPosition});return r.lastPosition=this.lastPosition,r}generateRevertOrientation(){const t=super.generateRevertOrientation(),r=new Co(t.segments[0].px,t.segments[0].py);for(const s of t.segments){const i=s.clone();i.sType!==$o.eStart&&(r.addSeg(i),Xo(i.sType)&&r.setLastPoint(i.px,i.py))}const o=this.pJuncs.length;for(let s=0;s<o;s++){const i=this.pJuncs[o-s-1],l=this.segments.length-2-i.jPosition;if(l<0)throw`err110: revert ctrJ len ${this.segments.length} has lastPos ${l} negative`;r.pJuncs.push({jName:i.jName,jDir:Os(i.jDir),jSide:i.jSide,jPosition:l}),r.lastPosition=l}return r}translate(t,r){const o=super.translate(t,r);return this.cloneJ(o)}translatePolar(t,r){return this.translate(r*Math.cos(t),r*Math.sin(t))}rotate(t,r,o){const s=super.rotate(t,r,o);return this.cloneJ(s)}setIdx(t,r){this.facetIdx=t,this.ctrIdx=r,this.used=0}compareIdx(t,r){let o=!1;return t===this.facetIdx&&r===this.ctrIdx&&(o=!0),o}incrementUsed(){this.used+=1}normOrientation(t){return super.getEnvelop().orientation!==t?this.generateRevertOrientation():this}},Is=class{attached=!1;ax=0;ay=0;aa=0;juncIdx=0;outerInner=[];constructor(c){for(const t of c)this.outerInner.push(t)}place(c){const t=c.getRotation(),[r,o]=c.getTranslation(),s=[];for(const l of this.outerInner)s.push(l.rotate(0,0,t).translate(r,o));const i=ve(s);return i.attached=this.attached,i.ax=this.ax,i.ay=this.ay,i.aa=this.aa,i.juncIdx=this.juncIdx,i}getContourPure(){const c=[];for(const t of this.outerInner)t instanceof fo||c.push(t);return c}getContourJ(c){const t=[];for(const[r,o]of this.outerInner.entries())if(o instanceof fo){const s=o.normOrientation(r===0);s.setIdx(c,r),t.push(s)}return t}getContourAll(){const c=[];for(const t of this.outerInner)c.push(Oo(t));return c}};function ye(c,t,r=""){return new fo(c,t,r)}function ve(c){return new Is(c)}function Oo(c){return c.clone()}var Bs=10**-5,Fs=class{pThickness=0;pPartName="";pSFMark="";pFacets=[];pJuncs=[];pProfiles=[];constructor(c,t,r,o,s,i){this.pThickness=o,this.pPartName=s,this.pSFMark=i;const l=Object.keys(t);for(const[d,h]of c.entries()){let f=0;for(const[a,b]of h.outerInner.entries())if(b instanceof fo)for(const g of b.pJuncs){const S=g.jName,_=this.pJuncs.map(x=>x.jName);if(_.includes(S)){const x=_.findIndex(A=>A===S);if(this.pJuncs[x].associated===1){const A=this.pJuncs[x].a1FacetIdx;if(d<=A)throw`err390: junction ${x} connects facets ${A} and ${d}. Must be higher!`;if(this.pJuncs[x].associated=2,this.pJuncs[x].a2FacetIdx=d,this.pJuncs[x].a2ContIdx=a,this.pJuncs[x].a2SegIdx=g.jPosition,this.pJuncs[x].a2Dir=g.jDir,this.pJuncs[x].a2Side=g.jSide,f===0)f=1;else throw`err628: jName ${S} is the second backward junction of facet-idx ${d}`}else throw`err125: jName ${S} used a third time in facet-idx ${d}`}else if(l.includes(S))this.pJuncs.push({jName:S,angle:t[S].angle,radius:t[S].radius,neutral:t[S].neutral,mark:t[S].mark,associated:1,a1FacetIdx:d,a1ContIdx:a,a1SegIdx:g.jPosition,a1Dir:g.jDir,a1Side:g.jSide,a1x:0,a1y:0,a1Teta:0,a2FacetIdx:-1,a2ContIdx:-1,a2SegIdx:-1,a2Dir:0,a2Side:0,a2x:0,a2y:0,a2Teta:0,jLength:0,jx:0,jy:0});else throw`err129: jName ${S} not defined in junction-list`}if(f===0&&d>0)throw`err738: iFacetIdx ${d} has no backward connection`;this.pFacets.push(h)}this.computeLength(),this.checkFacet();for(const d of r){if(d.l1<=0)throw`err292: profile l1 ${d.l1} is negative or null`;for(const[h,f]of d.ante.entries())if(h%2===0){if(typeof f!="string")throw"err234: even element of ante is not a string";if(!l.includes(f))throw`err242: even element string ${f} of ante is not a declared junctions`}else{if(typeof f!="number")throw"err239: odd element of ante is not a number";if(f<=0)throw`err242: odd element number ${f} of ante is negative or null`}for(const[h,f]of d.post.entries())if(h%2===0){if(typeof f!="string")throw"err234: even element of post is not a string";if(!l.includes(f))throw`err242: even element string ${f} of post is not a declared junctions`}else{if(typeof f!="number")throw"err239: odd element of post is not a number";if(f<=0)throw`err242: odd element number ${f} of post is negative or null`}this.pProfiles.push(d)}}printJuncs(){for(const c of this.pJuncs){const t=c.a1FacetIdx,r=c.a1ContIdx,o=c.a1SegIdx,s=c.a2FacetIdx,i=c.a2ContIdx,l=c.a2SegIdx;console.log(`dbg527: ${c.jName} : ${t} ${r} ${o} : ${s} ${i} ${l}`)}}oneTetaLength(c,t,r){const o=this.pFacets[c].outerInner[t];if(!(o instanceof Vo))throw`err234: faIdx ${c}, coIdx ${t} is not a Contour but a ContourCircle`;const s=o.segments.length,i=o.segments[r],l=o.segments[(r+1)%s],d=o.segments[(r+2)%s];if(Yo(i.sType))throw`err101: junction ${c} ${t} ${r} starts with an active corner`;if($o.eStroke!==l.sType)throw`err102: junction ${c} ${t} ${r} is not a stroke`;if(Yo(d.sType))throw`err103: junction ${c} ${t} ${r} ends with an active corner`;const h=Math.sqrt((l.px-i.px)**2+(l.py-i.py)**2),f=Math.atan2(l.py-i.py,l.px-i.px),a=`Ax ${n(i.px)} Ay ${n(i.py)} Bx ${n(l.px)} By ${n(l.py)}`;return[i.px,i.py,f,h,a]}computeLength(){for(const[c,t]of this.pJuncs.entries())for(let r=0;r<t.associated;r++){let o=t.a1FacetIdx,s=t.a1ContIdx,i=t.a1SegIdx,l=t.a1Dir;r===1&&(o=t.a2FacetIdx,s=t.a2ContIdx,i=t.a2SegIdx,l=t.a2Dir);const[d,h,f,a,b]=this.oneTetaLength(o,s,i);let g=f,S=d,_=h;if(l===1){const x=Jt(d,h).translatePolar(f,a);S=x.cx,_=x.cy,g=Ro(f+Math.PI)}if(r===1){const x=Math.abs(a-t.jLength);if(x>Bs){const A=`jName ${t.jName} ${b}`;throw`err908: junction ${c} jLength ${n(t.jLength)} ${n(a)} differs of ${x}
${A}`}if(t.a1Side===t.a2Side)throw`err905: jSide ${t.a1Side} ${t.a2Side} must be opposite`;if(t.a2x=S,t.a2y=_,t.a2Teta=g,this.pFacets[o].attached===!1)this.pFacets[o].attached=!0,this.pFacets[o].ax=S,this.pFacets[o].ay=_,this.pFacets[o].aa=g,this.pFacets[o].juncIdx=c;else throw`err545: pFacet ${o} is already attached`}else t.jLength=a,t.a1Teta=g,t.a1x=S,t.a1y=_}}checkFacet(){for(const[c,t]of this.pFacets.entries())if(c>0&&t.attached===!1)throw`err464: pFacet ${c} ax is not set`}getJuncIdx(c){let t=-1;for(const[r,o]of this.pJuncs.entries())c===o.jName&&(t=r);if(t<0)throw`err801: jName ${c} not found`;return t}fromJunctionToAttach(c){let t=c.a1Teta,r=c.a1x,o=c.a1y;const s=c.a1FacetIdx;if(s>0){const i=this.pFacets[s];t=t-i.aa;const l=r-i.ax,d=o-i.ay,h=Math.sqrt(l**2+d**2),a=Math.atan2(d,l)-i.aa;r=h*Math.cos(a),o=h*Math.sin(a)}return[t,r,o]}positionF(c,t){let r=c;if(t>0){const o=this.pFacets[t].juncIdx,s=this.pJuncs[o];s.a1Side===1?r=r.addRotation(-s.angle,0,0).addTranslation(0,-s.jx,s.jy):r=r.addRotation(s.angle,0,0).addTranslation(0,s.jx,s.jy),r=this.positionJ(r,o)}return r}positionJ(c,t){const r=this.pJuncs[t],[o,s,i]=this.fromJunctionToAttach(r);let l=c.addRotation(0,0,o).addTranslation(s,i,0);const d=r.a1FacetIdx;return d>0&&(l=this.positionF(l,d)),l}positionJ2d(c){const t=uo();let r=c;if(this.pFacets[c].attached)for(;r>0;){const o=this.pFacets[r].juncIdx,s=this.pJuncs[o],i=Math.abs(s.angle),l=i===0?s.radius:i*s.radius,d=s.a1Side===1?-1:1;t.addTranslation(0,d*l);const[h,f,a]=this.fromJunctionToAttach(s);t.addRotation(h),t.addTranslation(f,a),r=s.a1FacetIdx}else throw`err491: iFacetIdx ${c} is not attached!`;return t}positionF2d(c){const t=this.positionJ2d(c),r=t.getRotation(),[o,s]=t.getTranslation(),i=this.pFacets[c];return uo().addTranslation(-i.ax,-i.ay).addRotation(-i.aa+r).addTranslation(o,s)}findCtrJ(c,t,r){let o=c[0],s=!1;for(const i of c)i.compareIdx(t,r)&&(o=i,s=!0);if(!s)throw`err612: not found ctrJ with iFacetIdx ${t} and iCtrIdx ${r}`;return o}generateJunc3List(c){const t=[];for(const r of c.pJuncs){const o={jName:r.jName,segPosition:r.jPosition,jDir:r.jDir};t.push(o)}return t}calcJuncList(c,t){const r=c.findIdx(t);if(r<0)throw`err324: junction ${t} not found`;const o=this.generateJunc3List(c);return[...o.slice(r),...o.slice(0,r)]}incrSegIdx(c,t,r){let o=c+t;return o>=r?o=0:o<0&&(o=r+o),o}addSeg(c,t){t.sType!==$o.eStart&&(c.addSeg(t),c.setLastPoint(t.px,t.py))}makePartialCtr(c,t,r,o){let s=t[0].segPosition,i=this.incrSegIdx(s,0,c.segments.length);r||(s=this.incrSegIdx(t[0].segPosition,1,c.segments.length),i=this.incrSegIdx(s,0,c.segments.length));const l=Mt(c.segments[s].px,c.segments[s].py);let d=this.incrSegIdx(s,0,c.segments.length);for(let h=1;h<t.length;h++){for(c.incrementUsed();d!==t[h].segPosition;)d=this.incrSegIdx(d,1,c.segments.length),this.addSeg(l,c.segments[d].clone());const f=this.pJuncs[this.getJuncIdx(t[h].jName)];if(f.a2FacetIdx===-1){const a=c.segments[d].px,b=c.segments[d].py;d=this.incrSegIdx(d,1,c.segments.length);const g=c.segments[d].px,S=c.segments[d].py,_=g-a,x=S-b,A=Math.sqrt(_**2+x**2),R=Math.atan2(x,_);let v=0;t[h].jDir===1&&(v=Math.PI);const T=f.angle===0?f.radius:Math.abs(f.angle)*f.radius,k=f.a1Side===1?-Math.PI/2:Math.PI/2;l.addSegStrokeRP(R+k+v,T),l.addSegStrokeRP(R,A),l.addSegStrokeA(g,S)}else{const a=this.findCtrJ(o,f.a2FacetIdx,f.a2ContIdx),b=this.calcJuncList(a,f.jName),g=this.makePartialCtr(a,b,!1,o);l.addSegStrokeA(g.segments[0].px,g.segments[0].py);for(const S of g.segments)this.addSeg(l,S.clone());d=this.incrSegIdx(d,1,c.segments.length),l.addSegStrokeA(c.segments[d].px,c.segments[d].py)}}for(c.incrementUsed(),d=this.incrSegIdx(d,1,c.segments.length);d!==i;)this.addSeg(l,c.segments[d].clone()),d=this.incrSegIdx(d,1,c.segments.length);return l}generateNewContours(c){const t=[];for(const r of c)if(r.used===0){const s=[{jName:"",segPosition:0,jDir:0},...this.generateJunc3List(r)],i=this.makePartialCtr(r,s,!0,c);t.push(i)}return t}generateOneMarker(c){const t=c.angle===0?c.radius:Math.abs(c.angle)*c.radius;return t<2*c.mark?M(-c.mark,0,2*c.mark,t):Mt(-c.mark,c.mark).addPointA(0,0).addPointA(c.mark,c.mark).addSegArc2().addSegStrokeA(c.mark,t-c.mark).addPointA(0,t).addPointA(-c.mark,t-c.mark).addSegArc2().closeSegStroke()}generateMarkers(){const c=[];for(const t of this.pJuncs){if(t.associated===0)throw`err509: junction ${t.jName} is not associated`;if(t.mark>0){const r=t.a1FacetIdx,o=Math.abs(t.angle),s=o===0?t.radius:o*t.radius,i=t.a1Side===1?-1:0,l=uo().addTranslation(t.jLength/2,i*s);if(r>0){const[h,f,a]=this.fromJunctionToAttach(t);l.addRotation(h).addTranslation(f,a);const b=this.positionJ2d(r);l.addRotation(b.getRotation()).addTranslation(...b.getTranslation())}else l.addRotation(t.a1Teta).addTranslation(t.a1x,t.a1y);const d=this.generateOneMarker(t).rotate(0,0,l.getRotation()).translate(...l.getTranslation());c.push(d)}}return c}makePatternFigure(c){const t=[];for(const[g,S]of this.pFacets.entries())if(g>0){const _=this.positionF2d(g);t.push(S.place(_))}else{if(S.attached)throw`err490: iFacetIdx ${g} is attached!`;const _=uo();t.push(S.place(_))}const r=[],o=[],s=[];for(const[g,S]of t.entries())r.push(...S.getContourAll()),o.push(...S.getContourPure()),s.push(...S.getContourJ(g));const i=U();for(const g of r)i.addSecond(g);const l=this.generateNewContours(s),d=this.generateMarkers(),h=[...l,...o,...d],f=[];let a=h[0];const b=Ns(a.getEnvelop());for(const g of h)b.add(g.getEnvelop())?(f.push(a),a=g):f.push(g);if(c&&!b.check(a.getEnvelop()))throw"err782: the outer-contour does not envelop all contours";return i.addMainOI([a,...f]),i}nameFacePattern(){return`${this.pSFMark}_pattern`}nameFace(c){return`${this.pSFMark}_f${c.toString().padStart(2,"0")}`}nameFaceJ(c){return`${this.pSFMark}_fj${c.toString().padStart(2,"0")}`}nameFaceProfiles(){return`${this.pSFMark}_profiles`}makeFacetFig(c,t){const r=U(),o=[];for(const s of t.outerInner){let i=Oo(s);c>0&&(i=i.translate(-t.ax,-t.ay).rotate(0,0,Math.PI/2-t.aa)),o.push(i)}return r.addMainOI(o),r}drawJuncPositive(c,t,r){const o=Jt(0,c),s=o.translatePolar(-Math.PI/2+r/2,c),i=o.translatePolar(-Math.PI/2+r,c),l=o.translatePolar(-Math.PI/2+r,t),d=o.translatePolar(-Math.PI/2+r/2,t);return[Mt(0,0).addPointA(s.cx,s.cy).addPointA(i.cx,i.cy).addSegArc2().addSegStrokeA(l.cx,l.cy).addPointA(d.cx,d.cy).addPointA(0,this.pThickness).addSegArc2().closeSegStroke(),i.cx,i.cy]}drawJuncNegative(c,t,r){const o=Jt(0,-t),s=o.translatePolar(Math.PI/2+r/2,c),i=o.translatePolar(Math.PI/2+r,c),l=o.translatePolar(Math.PI/2+r,t),d=o.translatePolar(Math.PI/2+r/2,t);return[Mt(0,0).addPointA(d.cx,d.cy).addPointA(l.cx,l.cy).addSegArc2().addSegStrokeA(i.cx,i.cy).addPointA(s.cx,s.cy).addPointA(0,this.pThickness).addSegArc2().closeSegStroke(),l.cx,l.cy]}makeJuncCtr(c,t,r,o){let s=M(0,0,r,this.pThickness);if(o<0||o>1)throw`err329: junction ${c} with neutral ${o} not within 0..1`;if(r<0)throw`err328: junction ${c} with negative radius ${r}`;const i=r-this.pThickness*o,l=r+this.pThickness*(1-o);if(i<=0)throw`err901: junction ${c} with negative rI ${i}, radius ${r}, neutral ${o}, thickness ${this.pThickness}`;let d=0,h=0;if(t===0)d=r,h=0;else if(t>0){const[f,a,b]=this.drawJuncPositive(l,i,t);s=f,d=a,h=b}else{const[f,a,b]=this.drawJuncNegative(l,i,t);s=f,d=a,h=b}return[s,d,h]}makeProfileFig(){const c=U();for(const t of this.pProfiles){let r=t.x1,o=t.y1,s=t.a1;c.addMainO(No(r,o,t.l1,this.pThickness,s));const i=Jt(r,o).translatePolar(s,t.l1);r=i.cx,o=i.cy;for(const d of t.post)if(typeof d=="number"){c.addMainO(No(r,o,d,this.pThickness,s));const h=Jt(r,o).translatePolar(s,d);r=h.cx,o=h.cy}else{const h=this.pJuncs[this.getJuncIdx(d)],[f,a,b]=this.makeJuncCtr(h.jName,h.angle,h.radius,h.neutral);c.addMainO(f.rotate(0,0,s).translate(r,o));const g=Jt(a,b).rotate(Jt(0,0),s);r+=g.cx,o+=g.cy,s+=h.angle}r=t.x1,o=t.y1,s=t.a1+Math.PI;const l=Jt(r,o).translatePolar(s-Math.PI/2,this.pThickness);r=l.cx,o=l.cy;for(const d of t.ante)if(typeof d=="number"){c.addMainO(No(r,o,d,this.pThickness,s));const h=Jt(r,o).translatePolar(s,d);r=h.cx,o=h.cy}else{const h=this.pJuncs[this.getJuncIdx(d)],[f,a,b]=this.makeJuncCtr(h.jName,-h.angle,h.radius,h.neutral);c.addMainO(f.rotate(0,0,s).translate(r,o));const g=Jt(a,b).rotate(Jt(0,0),s);r+=g.cx,o+=g.cy,s-=h.angle}}return c}makeFigures(c=!0){const t={};if(this.pThickness<=0)throw`err822: thickness ${this.pThickness} is negative`;if(t[this.nameFacePattern()]=this.makePatternFigure(c),this.pProfiles.length>0){const r=this.nameFaceProfiles();t[r]=this.makeProfileFig()}for(const[r,o]of this.pFacets.entries()){const s=this.nameFace(r);t[s]=this.makeFacetFig(r,o)}for(const[r,o]of this.pJuncs.entries()){const s=this.nameFaceJ(r),[i,l,d]=this.makeJuncCtr(o.jName,o.angle,o.radius,o.neutral),h=U();h.addMainO(i),t[s]=h,o.jx=l,o.jy=d}return t}makeVolume(){const c=[];for(const s of this.pFacets.keys()){const i=Mo();let l=i;if(s>0){const h=i.addRotation(0,0,-Math.PI/2);l=this.positionF(h,s)}const d={outName:`subpax_${this.pPartName}_${this.nameFace(s)}`,face:`${this.pPartName}_${this.nameFace(s)}`,extrudeMethod:j.eLinearOrtho,length:this.pThickness,rotate:l.getRotation(),translate:l.getTranslation()};c.push(d)}for(const[s,i]of this.pJuncs.entries()){let l=Mo();i.a1Side===1?l=l.addRotation(Math.PI/2,0,0).addTranslation(0,i.jLength,0).addRotation(0,0,-Math.PI/2):l=l.addRotation(Math.PI/2,0,0).addRotation(0,0,Math.PI/2);const d=this.positionJ(l,s),h={outName:`subpax_${this.pPartName}_${this.nameFaceJ(s)}`,face:`${this.pPartName}_${this.nameFaceJ(s)}`,extrudeMethod:j.eLinearOrtho,length:i.jLength,rotate:d.getRotation(),translate:d.getTranslation()};c.push(h)}const t=c.map(s=>s.outName),r=[],o={outName:`pax_${this.pPartName}`,boolMethod:ee.eUnion,inList:t};return r.push(o),{extrudes:c,volumes:r}}};function vo(c,t,r,o,s,i="SFG"){return new Fs(c,t,r,o,s,i)}function ms(c){const t=U(),r=[];for(const o of c.outerInner)o instanceof fo?r.push(Oo(o)):r.push(o);return t.addMainOI(r),t}var zo={partName:"door1arc",params:[e("W1","mm",1500,100,4e3,1),e("H1","mm",1e3,1,4e3,1),e("H2p","%",50,1,100,1),Tt("vault"),e("Hc","mm",0,-1e3,1e3,1),We("spread",["widest","odd","even"]),e("vL","mm",400,10,1e3,1),e("vW","mm",200,10,1e3,1),Tt("brick"),e("bL","mm",400,10,1e3,1),e("bH","mm",200,10,1e3,1),e("jW","mm",.2,0,200,.1),e("T1","mm",200,1,1e3,1)],paramSvg:{W1:"door1Arc_nArcs.svg",H1:"door1Arc_nArcs.svg",H2p:"door1Arc_face.svg",Hc:"door1Arc_face.svg",spread:"door1Arc_spread.svg",vL:"door1Arc_vaultStone.svg",vW:"door1Arc_vaultStone.svg",bL:"door1Arc_face.svg",bH:"door1Arc_face.svg",jW:"door1Arc_face.svg",T1:"door1Arc_nArcs.svg"},sim:{tMax:180,tStep:.5,tUpdate:500}};function Do(c,t,r){let o=t;if(r>0){let s=c+Math.PI/2;s>Math.PI&&(s=2*Math.PI-s),[,o]=Eo(s,r,t)}else if(r<0){let s=Math.PI/2-c;s<0&&(s=-s),[,o]=Eo(s,-r,t)}return o}function Js(c,t,r=""){const o=ae(zo.partName+r),s=U();o.logstr+=`${o.partName} simTime: ${c}
`;try{let d=function(dt,Y,rt){return M(dt+t.jW,Y+t.jW,rt-2*t.jW,t.bH-2*t.jW)},h=function(dt,Y){const rt=(t.bH-X)/Math.tan(k),p=t.bL*Math.tan(k),at=Mt(dt,t.H1,"green");return rt>t.bL?at.addSegStrokeR(-Y*t.bL,p).addSegStrokeR(0,-p-X):at.addSegStrokeR(-Y*rt,t.bH-X).addSegStrokeR(Y*(-t.bL+rt),0).addSegStrokeR(0,-t.bH),X===0?at.closeSegStroke():at.addSegStrokeR(Y*t.bL,0).closeSegStroke(),at};var i=d,l=h;const f=t.H2p/100*t.W1/2,a=t.H1+f,b=f,g=t.W1/2,S=Math.atan2(g,b),A=Math.sqrt(b**2+g**2)/2/Math.cos(S),R=A,v=A-f-t.Hc,T=Math.max(v,0),k=Math.atan2(T,t.W1/2),m=Math.PI-2*k,O=Math.max(Do(k,R,t.Hc),R-t.Hc);let W=Math.ceil(m*(O+t.vL)/t.vW);const F=W%2===0;(t.spread===1&&F||t.spread===2&&!F)&&(W+=1);const ct=m/W,u=t.bL/2,I=Math.floor(t.H1/t.bH),J=Math.ceil(t.W1/t.bL)-1,G=(t.W1+t.bL-J*t.bL)/2,X=t.H1-I*t.bH,Ht=t.vL*Math.sin(k)+X,Q=t.vL*Math.cos(k),ht=Math.ceil(Ht/t.bH),vt=Math.ceil(Q/t.bL),gt=a+t.vL-(I+ht)*t.bH,ft=Math.ceil(gt/t.bH),st=Math.ceil(t.W1/t.bL),et=(vt-1)*t.bL,E=Math.ceil((t.W1+2*et+2*u)/t.bL),xt=Math.ceil((t.W1+2*et+2)/t.bL),K=t.W1/st,ut=(t.W1+2*et+2*u)/E,nt=(t.W1+2*et)/xt;if(t.H2p<1)throw`err167: H2p ${t.H2p} is too small`;if(v<-.1)throw`err170: lEG ${v} is negative`;const tt=t.bH-2*t.jW;if(tt<1)throw`err192: bHs ${n(tt)} is negative or almost zero`;const Nt=k>.1;o.logstr+=`Hdoor ${n(a)}, Hvault ${n(f)} mm
`,o.logstr+=`nVaultStone ${n(W)} vault-stones
`,o.logstr+=`aVaultStone ${n(Qt(ct))} degree ${n(ct*O)} ${n(ct*(O+t.vL))} mm
`,Nt?o.logstr+=`including side-vault stone with aMGF ${n(Qt(k))} degree
`:o.logstr+=`without side-vault stone because too small aMGF ${n(Qt(k))} degree
`;const Pt=Mt(0,0,"green").addSegStrokeR(t.W1,0).addSegStrokeR(0,t.H1).addPointR(-t.W1/2,f).addPointR(-t.W1,0).addSegArc2().closeSegStroke();s.addSecond(Pt);const Ft=t.W1/2,V=t.H1+f-R;s.addDynamics(z(Ft,V,R)),s.addPoint(Jt(Ft,V,ho.eTwoTri)),s.addPoint(Jt(Ft,V+t.Hc,ho.eSquare));for(let dt=0;dt<W;dt++){const Y=k+dt*ct,rt=Do(Y,R,t.Hc),p=Y+ct,at=Do(p,R,t.Hc),kt=Jt(t.W1/2,t.H1-v).translatePolar(Y,rt),Ot=Jt(t.W1/2,t.H1-v).translatePolar(p,at+t.vL),It=Mt(kt.cx,kt.cy).addSegStrokeRP(Y,t.vL).addSegStrokeA(Ot.cx,Ot.cy).addSegStrokeRP(p+Math.PI,t.vL).closeSegStroke();s.addMainO(It)}for(let dt=0;dt<I;dt++){const Y=dt*t.bH,rt=dt%2===0?2*u:u;s.addMainO(d(-rt,Y,rt)),s.addMainO(d(t.W1,Y,rt))}s.addMainO(d(-u,-t.bH,G));for(let dt=0;dt<J;dt++){const Y=-u+G+dt*2*u;s.addMainO(d(Y,-t.bH,2*u))}const it=-u+G+J*2*u;if(s.addMainO(d(it,-t.bH,G)),Nt){for(let dt=0;dt<ht;dt++){const Y=(dt+I)*t.bH;for(let rt=0;rt<vt;rt++){const p=(rt-vt)*2*u,at=t.W1+rt*2*u;s.addSecond(d(p,Y,2*u)),s.addSecond(d(at,Y,2*u))}}for(let dt=0;dt<st;dt++){const Y=(I+ht-1)*t.bH;s.addSecond(d(dt*K,Y,K))}}Nt&&(s.addMainO(h(0,1)),s.addMainO(h(t.W1,-1)));for(let dt=0;dt<ft;dt++){const Y=(dt+I+ht)*t.bH,rt=dt%2===1?2*u:u;s.addSecond(d(-et-2*u,Y,rt)),s.addSecond(d(t.W1+et+2*u-rt,Y,rt));const p=dt%2===0?E:xt,at=dt%2===0?ut:nt,kt=dt%2===0?-et-u:-et;for(let Ot=0;Ot<p;Ot++)s.addSecond(d(kt+Ot*at,Y,at))}o.fig={faceDoor:s};const wt=o.partName;o.vol={extrudes:[{outName:`subpax_${wt}_top`,face:`${wt}_faceDoor`,extrudeMethod:j.eLinearOrtho,length:t.T1,rotate:[0,0,0],translate:[0,0,0]}],volumes:[{outName:`pax_${wt}`,boolMethod:ee.eIdentity,inList:[`subpax_${wt}_top`]}]},o.sub={},o.logstr+=`door1arc drawn successfully!
`,o.calcErr=!1}catch(d){o.logstr+=d,console.log(d)}return o}var qs={pTitle:"door1arc",pDescription:"A door or a window with a 1-arc vault",pDef:zo,pGeom:Js},Ko={partName:"stoneTower",params:[e("L1","cm",800,100,4e3,1),e("W1","cm",500,100,4e3,1),e("T1","cm",40,1,200,1),e("T2","cm",40,1,200,1),e("W2","cm",80,1,500,1),Tt("floor support"),e("N4","support",5,2,100,1),e("T4","cm",20,1,200,1),e("W4","cm",40,1,200,1),e("H4","cm",60,1,200,1),e("H4b","cm",60,1,200,1),Tt("floor"),e("N1","floor",5,1,10,1),e("H1","cm",400,100,1e3,1),e("Hf","cm",40,1,100,1),e("Hs","cm",40,1,100,1),Te("showFloor",!1),Tt("top"),e("H5","cm",120,0,250,1),e("H6","cm",180,0,300,1),e("H7","cm",300,0,600,1),Tt("door"),e("H8","cm",220,100,400,1),e("W8","cm",100,40,400,1),e("N3","stairs",12,1,40,1),Te("showExtWall",!0),Tt("window-1"),e("wN1","hollow",0,0,5,1),e("wW1","cm",80,10,300,1),e("wH1","cm",150,10,500,1),e("wE1","cm",20,1,100,1),e("wS1","cm",120,0,300,1),Tt("window-2"),e("wN2","hollow",1,0,5,1),e("wW2","cm",80,10,300,1),e("wH2","cm",150,10,500,1),e("wE2","cm",20,1,100,1),e("wS2","cm",120,0,300,1),Tt("window-3"),e("wN3","hollow",2,0,5,1),e("wW3","cm",80,10,300,1),e("wH3","cm",150,10,500,1),e("wE3","cm",20,1,100,1),e("wS3","cm",120,0,300,1),Tt("window-4"),e("wN4","hollow",3,0,5,1),e("wW4","cm",80,10,300,1),e("wH4","cm",150,10,500,1),e("wE4","cm",20,1,100,1),e("wS4","cm",120,0,300,1)],paramSvg:{L1:"stoneTower_hplan.svg",W1:"stoneTower_hplan.svg",T1:"stoneTower_hplan.svg",T2:"stoneTower_hplan.svg",W2:"stoneTower_hplan.svg",N4:"stoneTower_hplan.svg",T4:"stoneTower_hplan.svg",W4:"stoneTower_vw.svg",H4:"stoneTower_vw.svg",H4b:"stoneTower_vw.svg",N1:"stoneTower_vw.svg",H1:"stoneTower_vw.svg",Hf:"stoneTower_vw.svg",Hs:"stoneTower_vw.svg",showFloor:"stoneTower_vw.svg",H5:"stoneTower_vw.svg",H6:"stoneTower_vw.svg",H7:"stoneTower_vw.svg",H8:"stoneTower_vw.svg",W8:"stoneTower_vw.svg",N3:"stoneTower_hplan.svg",showExtWall:"stoneTower_hplan.svg",wN1:"stoneTower_window2.svg",wW1:"stoneTower_window2.svg",wH1:"stoneTower_window2.svg",wE1:"stoneTower_window2.svg",wS1:"stoneTower_window2.svg",wN2:"stoneTower_window2.svg",wW2:"stoneTower_window2.svg",wH2:"stoneTower_window2.svg",wE2:"stoneTower_window2.svg",wS2:"stoneTower_window2.svg",wN3:"stoneTower_window2.svg",wW3:"stoneTower_window2.svg",wH3:"stoneTower_window2.svg",wE3:"stoneTower_window2.svg",wS3:"stoneTower_window2.svg",wN4:"stoneTower_window2.svg",wW4:"stoneTower_window2.svg",wH4:"stoneTower_window2.svg",wE4:"stoneTower_window2.svg",wS4:"stoneTower_window2.svg"},sim:{tMax:180,tStep:.5,tUpdate:500}},Zo=2;function js(c,t,r=""){const o=ae(Ko.partName+r),s=U(),i=U(),l=U(),d=U(),h=U(),f=U(),a=U(),b=U();o.logstr+=`${o.partName} simTime: ${c}
`;try{let R=function(P){const Z=[],D=ht[P],ot=vt[P],Wt=gt[P],St=ft[P],yt=st[P],$t=ot/2,lt=(D-1)*(ot+St)/2,Lt=ot+St;for(let qt=0;qt<D;qt++){const Xt=Mt(-$t,yt).addSegStrokeA($t,yt).addSegStrokeA($t,yt+Wt-$t).addPointA(0,yt+Wt).addPointA(-$t,yt+Wt-$t).addSegArc2().closeSegStroke();Z.push(Xt.translate(-lt+qt*Lt,0))}return Z},v=function(P,Z){const D=U(),ot=R(P);for(const Wt of ot)D.addMainO(Wt);return D.mergeFigure(Z,!0),D},T=function(P,Z){const D=[],ot=t.T2+t.W2+t.T1,Wt=P?t.L1:t.W1;return D.push(M(-t.T1,0,t.T1,t.H1+t.Hf)),D.push(M(-ot,0,t.T2,t.H1+t.Hf)),D.push(M(Wt,0,t.T1,t.H1+t.Hf)),D.push(M(Wt+t.T1+t.W2,0,t.T2,t.H1+t.Hf)),D.push(p.translate(-t.W2-t.T1,0)),D.push(p.translate(Wt+t.T1,0)),Z&&(P?D.push(...rt):(D.push(at),D.push(kt))),D},k=function(P,Z=!1){const D=U(),ot=P?t.L1:t.W1,Wt=t.T2+t.W2+t.T1;if(P){const St=t.T2+t.W2,yt=t.L1+2*t.T1;D.addSecond(M(0,W,u,t.H5)),D.addSecond(M(St,W,yt,t.H6)),D.addSecond(M(St,W+t.H6,yt,t.H7))}else D.mergeFigure(f,!0);for(let St=0;St<t.N1;St++){for(const $t of T(P,!0))D.addSecond($t.translate(t.T2+t.W2+t.T1,St*O));const yt=M(Wt,t.H1+St*O,ot,t.Hf);t.showFloor&&Z?D.addMainO(yt):D.addSecond(yt)}return D},m=function(P,Z){const D=U(),ot=P%2===0,Wt=ot?Ft[0]:Ft[1],St=ot?t.L1:t.W1,yt=Z?-1:1,$t=Z?-Wt:0,lt=Z?0:-Wt;D.mergeFigure(k(ot),!0);const Lt=t.T2+t.W2,qt=Lt+t.T1+St/2,Xt=Lt+2*t.T1+St,Zt=Z?t.T2:Xt,Et=Z?Xt:t.T2;for(let mt=0;mt<t.N1;mt++){if((mt+P)%4===0){D.addSecond(Y.translate(qt,mt*O));for(let Kt=0;Kt<t.N3;Kt++){const zt=qt+yt*(t.W8/2+Kt*Wt)+$t,ne=mt*O+(Kt+1)*Nt-Pt;D.addMainO(M(zt,ne,Wt,Pt))}const Ut=(mt+.5)*O-Pt;D.addMainO(M(Zt,Ut,t.W2,Pt))}if((mt+P+1)%4===0){const Ut=(mt+.5)*O-Pt;D.addSecond(M(Et,Ut,t.W2,Pt));for(let Kt=0;Kt<t.N3;Kt++){const zt=qt-yt*(t.W8/2+Kt*Wt)+lt,ne=(mt+.5)*O+(t.N3-Kt)*Nt-Pt;D.addMainO(M(zt,ne,Wt,Pt))}}if(mt>0){const Ut=R((mt+P)%4);for(const Kt of Ut)D.addSecond(Kt.translate(qt,mt*O))}}return D};var g=R,S=v,_=T,x=k,A=m;const O=t.H1+t.Hf,W=t.N1*O,F=W+t.H6+t.H7,ct=t.T1+t.W2+t.T2,u=t.L1+2*ct,I=t.W1+2*ct,J=t.T2+t.W2,G=(t.L1-t.N4*t.T4)/(t.N4-1),X=t.H1-t.H4-t.H4b,Ht=10,Q=t.W2/2,ht=[t.wN1,t.wN2,t.wN3,t.wN4],vt=[t.wW1,t.wW2,t.wW3,t.wW4],gt=[t.wH1,t.wH2,t.wH3,t.wH4],ft=[t.wE1,t.wE2,t.wE3,t.wE4],st=[t.wS1,t.wS2,t.wS3,t.wS4],et=t.T2+t.W2+t.T1,E=et,xt=G+t.T4,K=Math.atan2(t.H7,t.T1+t.W1/2),ut=(Math.PI/2-K)/2,nt=t.T1/Math.cos(K),tt=t.T1*Math.tan(ut),Nt=O/2/(t.N3+1),Pt=Nt*.15,Ft=[(t.L1/2-t.W8/2+t.T1)/t.N3,(t.W1/2-t.W8/2+t.T1)/t.N3];if(G<0)throw`err152: L1 ${t.L1} is too small compare to N4 ${t.N4} W4 ${t.W4}`;if(t.H8<t.W8/2)throw`err158: H8 ${t.H8} is too small compare to W8 ${t.W8}`;if(X<t.H8)throw`err161: H1 ${t.H1} is too small compare to H8 ${t.H8}`;if(Math.max(t.L1,t.W1)<t.W8)throw`err168: L1 ${t.L1} or W1 ${t.W1} is too small compare to W8 ${t.W8}`;for(let P=0;P<4;P++){if(gt[P]<vt[P]/2)throw`err169: window-${P} wH ${gt[P]} is too small compare to wW ${vt[P]}`;if(X<st[P]+gt[P])throw`err172: H1 ${t.H1} is too small compare to wS ${st[P]} and wH ${gt[P]}`;if(ht[P]>0&&Math.max(t.L1,t.W1)<ht[P]*vt[P]+(ht[P]-1)*ft[P])throw`err175: L1 ${t.L1} or W1 ${t.W1} is too small compare to wN ${ht[P]}, wW ${vt[P]} and wE ${ft[P]}`}if(t.H1<t.W2/2+t.Hs)throw`err193: H1 ${t.H1} is too small compare to W2 ${t.W2} and Hs ${t.Hs}`;o.logstr+=`L3 ${n(u)}, W3 ${n(I)}, H3 ${n(W)}, H3b ${n(F)} cm
`,o.logstr+=`aCabRoof ${n(Qt(K))} degree
`;const V=M(0,0,u,I),it=M(t.T2,t.T2,u-2*t.T2,I-2*t.T2),wt=M(J,J,t.L1+2*t.T1,t.W1+2*t.T1),dt=M(J+t.T1,J+t.T1,t.L1,t.W1);t.showExtWall?s.addMainOI([V,it]):(s.addSecond(V),s.addSecond(it)),s.addMainOI([wt,dt]);const Y=Mt(-t.W8/2,0).addSegStrokeA(t.W8/2,0).addSegStrokeA(t.W8/2,t.H8-t.W8/2).addPointA(0,t.H8).addPointA(-t.W8/2,t.H8-t.W8/2).addSegArc2().closeSegStroke();i.addMainO(Y),i.addSecond(M(-t.L1/2,0,t.L1,t.H1)),i.addSecond(M(-t.W1/2,0,t.W1,t.H1));const rt=[];for(let P=0;P<t.N4;P++){const Z=P*(G+t.T4);rt.push(M(Z,X+t.H4b,t.T4,t.H4)),rt.push(M(Z,X,t.T4,t.H4b))}for(const P of rt)i.addSecond(P.translate(-t.L1/2,0));const p=Mt(0,t.H1+t.Hf-t.Hs-t.W2/2).addPointR(t.W2/2,t.W2/2).addPointR(t.W2,0).addSegArc2().addSegStrokeR(0,t.W2/2+t.Hs).addSegStrokeR(-t.W2,0).closeSegStroke();l.addMainO(p),l.addSecond(M(-t.T2,0,t.T2,t.H1+t.Hf)),l.addSecond(M(t.W2,0,t.T2,t.H1+t.Hf));const at=Mt(0,X).addSegStrokeR(t.W4,t.H4b).addSegStrokeR(0,t.H4).addSegStrokeR(-t.W4,0).closeSegStroke(),kt=Mt(t.W1,X).addSegStrokeR(0,t.H4+t.H4b).addSegStrokeR(-t.W4,0).addSegStrokeR(0,-t.H4).closeSegStroke();d.addMainO(at),d.addMainO(kt);for(const P of T(!1,!1))d.addSecond(P);d.addSecond(M(0,t.H1,t.W1,t.Hf)),h.addMainOI([V,it]),h.addSecond(V),h.addSecond(it);const Ot=Mt(t.T2+t.W2,t.N1*O).addSegStrokeR(t.W1/2-t.W8/2+t.T1,0).addSegStrokeR(0,t.H8-t.W8/2).addPointR(t.W8/2,t.W8/2).addPointR(t.W8,0).addSegArc2().addSegStrokeR(0,-t.H8+t.W8/2).addSegStrokeR(t.W1/2-t.W8/2+t.T1,0).addSegStrokeR(0,t.H6).addSegStrokeR(-t.W1/2-t.T1,t.H7).addSegStrokeR(-t.W1/2-t.T1,-t.H7).closeSegStroke(),It=M(0,t.N1*O,t.T2,t.H5),w=M(I-t.T2,t.N1*O,t.T2,t.H5);f.addMainO(Ot),f.addSecond(It),f.addSecond(w);const Dt=Mt(t.T2+t.W2,t.N1*O).addSegStrokeR(t.T1,0).addSegStrokeR(0,t.H6-tt).addSegStrokeR(t.W1/2,t.H7-nt+tt).addSegStrokeR(t.W1/2,-t.H7+nt-tt).addSegStrokeR(0,-t.H6+tt).addSegStrokeR(t.T1,0).addSegStrokeR(0,t.H6).addSegStrokeR(-t.W1/2-t.T1,t.H7).addSegStrokeR(-t.W1/2-t.T1,-t.H7).closeSegStroke();a.addMainO(Dt),a.addSecond(It),a.addSecond(w),a.addSecond(Ot);const B=Mt(t.T2+t.W2,t.N1*O).addSegStrokeR(t.W1+2*t.T1,0).addSegStrokeR(0,t.H6).addSegStrokeR(-t.W1/2-t.T1,t.H7).addSegStrokeR(-t.W1/2-t.T1,-t.H7).closeSegStroke();b.addMainO(B),b.addSecond(It),b.addSecond(w),b.addSecond(Dt);const bt=k(!1,!0);o.fig={faceHplan:s,faceDoor:i,faceWin1:v(0,i),faceWin2:v(1,i),faceWin3:v(2,i),faceWin4:v(3,i),faceCorri:l,faceFS:d,faceTopExt:h,faceTCFront:f,faceTCMid:a,faceTCRear:b,faceFloors:bt,faceStairsL1:m(2,!1),faceStairsW2:m(1,!1),faceStairsL2:m(0,!0),faceStairsW1:m(3,!0)};const L=o.partName,Gt=[],Vt=[];for(let P=0;P<t.N1;P++){const Z=(P+Zo)%4,ot=Z%2===0?t.W1/2:t.L1/2,Wt=t.T1+ot+t.W2/2;if(Gt.push({outName:`subpax_${L}_doorIn${P}`,face:`${L}_faceDoor`,extrudeMethod:j.eLinearOrtho,length:Wt,rotate:[Math.PI/2,0,Z*Math.PI/2],translate:[u/2,I/2,P*O]}),Vt.push(`subpax_${L}_doorIn${P}`),P>0){for(let St=0;St<4;St++)if(ht[St]>0){const yt=(Z+St)%4,lt=yt%2===0?t.W1/2:t.L1/2,Lt=t.T1+lt+t.W2+2*t.T2;Gt.push({outName:`subpax_${L}_win${P}_${St}`,face:`${L}_faceWin${St+1}`,extrudeMethod:j.eLinearOrtho,length:Lt,rotate:[Math.PI/2,0,yt*Math.PI/2],translate:[u/2,I/2,P*O]}),Vt.push(`subpax_${L}_win${P}_${St}`)}}}const q=[],H=[],y=[t.T2+t.W2,t.T2,t.T2+t.W2,t.T2+t.W2+2*t.T1+t.L1],C=[t.T2,t.T2+t.W2+t.W1+2*t.T1,t.T2+t.W2+2*t.T1+t.W1,t.T2+t.W2+t.W1+2*t.T1];for(let P=0;P<t.N1;P++){for(let Z=0;Z<4;Z++){const D=Z%2===0?t.L1:t.W1,ot=(P+Z+Zo+1)%4===0,Wt=ot?(D+t.W8)/2+t.T1:D+2*t.T1,St=ot&&Z===0?Wt-t.W8:0,yt=ot&&Z===1?-Wt+t.W8:0,$t=Z%2===0?1:0;q.push({outName:`subpax_${L}_corri${P}_${Z}`,face:`${L}_faceCorri`,extrudeMethod:j.eLinearOrtho,length:Wt,rotate:[Math.PI/2,0,$t*Math.PI/2],translate:[y[Z]+St,C[Z]+yt,P*O]}),H.push(`subpax_${L}_corri${P}_${Z}`)}for(let Z=0;Z<t.N4;Z++)q.push({outName:`subpax_${L}_fs${P}_${Z}`,face:`${L}_faceFS`,extrudeMethod:j.eLinearOrtho,length:t.T4,rotate:[Math.PI/2,0,Math.PI/2],translate:[et+Z*xt,E,P*O]}),H.push(`subpax_${L}_fs${P}_${Z}`)}q.push({outName:`subpax_${L}_topExt`,face:`${L}_faceTopExt`,extrudeMethod:j.eLinearOrtho,length:t.H5,rotate:[0,0,0],translate:[0,0,t.N1*O]}),H.push(`subpax_${L}_topExt`),q.push({outName:`subpax_${L}_TCFront`,face:`${L}_faceTCFront`,extrudeMethod:j.eLinearOrtho,length:t.T1,rotate:[Math.PI/2,0,Math.PI/2],translate:[J,0,0]}),H.push(`subpax_${L}_TCFront`),q.push({outName:`subpax_${L}_TCMid`,face:`${L}_faceTCMid`,extrudeMethod:j.eLinearOrtho,length:2*t.T1+t.L1,rotate:[Math.PI/2,0,Math.PI/2],translate:[J,0,0]}),H.push(`subpax_${L}_TCMid`),q.push({outName:`subpax_${L}_TCRear`,face:`${L}_faceTCRear`,extrudeMethod:j.eLinearOrtho,length:t.T1,rotate:[Math.PI/2,0,Math.PI/2],translate:[J+t.T1+t.L1,0,0]}),H.push(`subpax_${L}_TCRear`),q.push({outName:`subpax_${L}_stairsL1`,face:`${L}_faceStairsL1`,extrudeMethod:j.eLinearOrtho,length:t.W2,rotate:[Math.PI/2,0,0],translate:[0,t.W2+t.T2,0]}),H.push(`subpax_${L}_stairsL1`),q.push({outName:`subpax_${L}_stairsL2`,face:`${L}_faceStairsL2`,extrudeMethod:j.eLinearOrtho,length:t.W2,rotate:[Math.PI/2,0,0],translate:[0,t.T2+2*t.W2+2*t.T1+t.W1,0]}),H.push(`subpax_${L}_stairsL2`),q.push({outName:`subpax_${L}_stairsW1`,face:`${L}_faceStairsW1`,extrudeMethod:j.eLinearOrtho,length:t.W2,rotate:[Math.PI/2,0,Math.PI/2],translate:[t.T2,0,0]}),H.push(`subpax_${L}_stairsW1`),q.push({outName:`subpax_${L}_stairsW2`,face:`${L}_faceStairsW2`,extrudeMethod:j.eLinearOrtho,length:t.W2,rotate:[Math.PI/2,0,Math.PI/2],translate:[t.T2+t.W2+2*t.T1+t.L1,0,0]}),H.push(`subpax_${L}_stairsW2`),t.showFloor&&(q.push({outName:`subpax_${L}_Floors`,face:`${L}_faceFloors`,extrudeMethod:j.eLinearOrtho,length:t.L1,rotate:[Math.PI/2,0,Math.PI/2],translate:[J+t.T1,0,0]}),H.push(`subpax_${L}_Floors`)),o.vol={extrudes:[{outName:`subpax_${L}_Hplan`,face:`${L}_faceHplan`,extrudeMethod:j.eLinearOrtho,length:W+Ht,rotate:[0,0,0],translate:[0,0,-Ht]},{outName:`subpax_${L}_door`,face:`${L}_faceDoor`,extrudeMethod:j.eLinearOrtho,length:t.T2+2*Q,rotate:[Math.PI/2,0,0],translate:[u/2,t.T2+Q,0]},...Gt,...q],volumes:[{outName:`ipax_${L}_stone`,boolMethod:ee.eUnion,inList:[`subpax_${L}_Hplan`,...H]},{outName:`ipax_${L}_hollow`,boolMethod:ee.eUnion,inList:[`subpax_${L}_door`,...Vt]},{outName:`pax_${L}`,boolMethod:ee.eSubstraction,inList:[`ipax_${L}_stone`,`ipax_${L}_hollow`]}]},o.sub={},o.logstr+=`stoneTower drawn successfully!
`,o.calcErr=!1}catch(R){o.logstr+=R,console.log(R)}return o}var Gs={pTitle:"stoneTower",pDescription:"a middle-age tower made out of stones",pDef:Ko,pGeom:js},Qo={partName:"house",params:[e("WA","cm",1e3,100,2e3,1),e("WB","cm",800,100,2e3,1),e("WC","cm",800,100,2e3,1),e("WD","cm",500,100,2e3,1),e("WE","cm",400,100,2e3,1),Tt("Heights"),e("HA1","cm",400,200,2e3,1),e("HA2","cm",1200,200,2e3,1),e("HB1","cm",600,200,2e3,1),e("HB2","cm",1100,200,2e3,1),e("HC1","cm",700,200,2e3,1),e("HC2","cm",600,200,2e3,1),e("HD1","cm",700,200,2e3,1),e("HD2","cm",600,200,2e3,1),e("HE1","cm",1e3,200,2e3,1),e("HE2","cm",600,200,2e3,1),Tt("L-Lengths"),e("L1","cm",1200,200,2e3,1),e("L2","cm",200,200,2e3,1),e("L3","cm",1500,200,2e3,1),e("S1","cm",200,50,2e3,1),e("S2","cm",300,50,2e3,1),e("S3","cm",100,50,2e3,1),e("Ht","cm",400,50,2e3,1),Tt("M-Lengths"),e("M1","cm",200,50,2e3,1),e("M2","cm",400,50,2e3,1),e("M3","cm",800,50,2e3,1),e("M4","cm",100,50,2e3,1),Tt("Nest"),e("AE1","cm",400,50,2e3,1),e("AE2","cm",300,50,2e3,1),e("BE1","cm",400,50,2e3,1),e("BE2","cm",400,50,2e3,1)],paramSvg:{WA:"house_top.svg",WB:"house_top.svg",WC:"house_top.svg",WD:"house_top.svg",WE:"house_top.svg",HA1:"house_pignon.svg",HA2:"house_pignon.svg",HB1:"house_pignon.svg",HB2:"house_pignon.svg",HC1:"house_pignon.svg",HC2:"house_pignon.svg",HD1:"house_pignon.svg",HD2:"house_pignon.svg",HE1:"house_pignon.svg",HE2:"house_pignon.svg",L1:"house_top.svg",L2:"house_top.svg",L3:"house_top.svg",S1:"house_top.svg",S2:"house_top.svg",S3:"house_top.svg",Ht:"house_top.svg",M1:"house_top.svg",M2:"house_top.svg",M3:"house_top.svg",M4:"house_top.svg",AE1:"house_top.svg",AE2:"house_top.svg",BE1:"house_top.svg",BE2:"house_top.svg"},sim:{tMax:180,tStep:.5,tUpdate:500}};function Xs(c,t,r=""){const o=ae(Qo.partName+r),s=U(),i=U(),l=U(),d=U(),h=U(),f=U();o.logstr+=`${o.partName} simTime: ${c}
`;try{let g=function(ut,nt,tt){return Mt(-ut,0).addSegStrokeR(2*ut,0).addSegStrokeR(0,nt).addSegStrokeR(-ut,tt).addSegStrokeR(-ut,-tt).closeSegStroke()},S=function(ut,nt,tt,Nt,Pt){return M(-ut,0,2*ut,nt).rotate(0,0,(2+tt)*F).translate(Nt,Pt)};var a=g,b=S;const _=t.WA/2,x=t.WB/2,A=t.WC/2,R=t.WD/2,v=t.WE/2,T=t.HA1+t.HA2,k=t.HB1+t.HB2,m=t.HC1+t.HC2,O=t.HD1+t.HD2,W=t.HE1+t.HE2;if(k<T)throw`err167: HBtotal ${n(k)} is too small compare to HAtotal ${n(T)}`;o.logstr+=`HAtotal ${n(T/100)} m
`,o.logstr+=`HBtotal ${n(k/100)} m
`,o.logstr+=`HCtotal ${n(m/100)} m
`,o.logstr+=`HDtotal ${n(O/100)} m
`,o.logstr+=`HEtotal ${n(W/100)} m
`;const F=Math.PI/2;s.addMainO(g(_,t.HA1,t.HA2)),i.addMainO(g(x,t.HB1,t.HB2)),l.addMainO(g(A,t.HC1,t.HC2)),d.addMainO(g(R,t.HD1,t.HD2)),h.addMainO(g(v,t.HE1,t.HE2)),s.mergeFigure(i.translate(_+x,0),!0),s.mergeFigure(l.translate(_+2*x+A,0),!0),s.mergeFigure(d.translate(_+2*(x+A)+R,0),!0),s.mergeFigure(h.translate(_+2*(x+A+R)+v,0),!0),s.addSecond(M(-_-t.S2,0,t.S2,t.Ht));const ct=x+2*A+t.L1,u=x+t.L3/2,I=ct,J=x+t.L2,G=_+t.M2,X=_+t.M3+t.M4,Ht=_+t.M1,Q=-x-A,ht=_,vt=-x-t.L3+R+t.S3,gt=x,ft=-_-t.M3+R,st=t.AE1,et=-t.BE1-v,E=t.AE2,xt=-t.BE2-v;f.addMainO(S(_/2,t.S1,3,-ct,0)),f.addMainO(S(t.L3/2,t.S2,0,-u,-_)),f.addSecond(S(_,I,3,0,0)),f.addSecond(S(_,J,1,0,0)),f.addSecond(S(x,G,2,0,0)),f.addSecond(S(x,X,0,0,0)),f.addSecond(S(A,Ht,2,Q,0)),f.addSecond(S(R,ht,0,vt,0)),f.addSecond(S(R,gt,1,0,ft)),f.addSecond(S(v,st,0,et,0)),f.addSecond(S(v,E,3,0,xt)),o.fig={facePA:s,facePB:i,facePC:l,facePD:d,facePE:h,faceTerrasse:f};const K=o.partName;o.vol={extrudes:[{outName:`subpax_${K}_pAw`,face:`${K}_facePA`,extrudeMethod:j.eLinearOrtho,length:I,rotate:[F,0,3*F],translate:[0,0,0]},{outName:`subpax_${K}_pAe`,face:`${K}_facePA`,extrudeMethod:j.eLinearOrtho,length:J,rotate:[F,0,1*F],translate:[0,0,0]},{outName:`subpax_${K}_pBn`,face:`${K}_facePB`,extrudeMethod:j.eLinearOrtho,length:G,rotate:[F,0,2*F],translate:[0,0,0]},{outName:`subpax_${K}_pBs`,face:`${K}_facePB`,extrudeMethod:j.eLinearOrtho,length:X,rotate:[F,0,0*F],translate:[0,0,0]},{outName:`subpax_${K}_pCn`,face:`${K}_facePC`,extrudeMethod:j.eLinearOrtho,length:Ht,rotate:[F,0,2*F],translate:[Q,0,0]},{outName:`subpax_${K}_pD1s`,face:`${K}_facePD`,extrudeMethod:j.eLinearOrtho,length:ht,rotate:[F,0,0*F],translate:[vt,0,0]},{outName:`subpax_${K}_pD2e`,face:`${K}_facePD`,extrudeMethod:j.eLinearOrtho,length:gt,rotate:[F,0,1*F],translate:[0,ft,0]},{outName:`subpax_${K}_pE1s`,face:`${K}_facePE`,extrudeMethod:j.eLinearOrtho,length:st,rotate:[F,0,0*F],translate:[et,0,0]},{outName:`subpax_${K}_pE2w`,face:`${K}_facePE`,extrudeMethod:j.eLinearOrtho,length:E,rotate:[F,0,3*F],translate:[0,xt,0]},{outName:`subpax_${K}_terras`,face:`${K}_faceTerrasse`,extrudeMethod:j.eLinearOrtho,length:t.Ht,rotate:[0,0,0],translate:[0,0,0]}],volumes:[{outName:`pax_${K}`,boolMethod:ee.eUnion,inList:[`subpax_${K}_pAw`,`subpax_${K}_pAe`,`subpax_${K}_pBn`,`subpax_${K}_pBs`,`subpax_${K}_pCn`,`subpax_${K}_pD1s`,`subpax_${K}_pD2e`,`subpax_${K}_pE1s`,`subpax_${K}_pE2w`,`subpax_${K}_terras`]}]},o.sub={},o.logstr+=`house drawn successfully!
`,o.calcErr=!1}catch(g){o.logstr+=g,console.log(g)}return o}var Ys={pTitle:"house",pDescription:"the envelop of an house with large roof",pDef:Qo,pGeom:Xs},po={partName:"factory",params:[e("onx","office",4,1,50,1),e("ony","office",3,1,50,1),e("olx","mm",5e3,1e3,5e4,10),e("oly","mm",5e3,1e3,5e4,10),e("iwx","mm",2e3,500,1e4,10),e("iwy","mm",2e3,500,1e4,10),Tt("details"),e("ewx","mm",5e3,500,2e4,10),e("ewy","mm",5e3,500,2e4,10),We("officeOrientation",["xdw","xup","xal","ydw","yup","yal"]),e("ith","mm",400,100,2e3,10),e("eth","mm",400,100,2e3,10),e("bw","mm",800,200,1e4,10),Tt("heights and roof"),e("oh1","mm",3e3,2e3,5e3,10),e("oh2","mm",4e3,2e3,1e4,10),e("rtn","triangle",6,1,1e3,1),e("ran","degree",49,20,90,.1),e("ram","degree",90,80,160,.1),e("rth","mm",200,10,1e3,10),Tt("lateral windows"),e("swx1","mm",600,10,5e3,10),e("swx2","mm",1e3,10,5e3,10),e("swh1","mm",1e3,10,5e3,10),e("swh2","mm",1e3,10,5e3,10),e("swh3","mm",200,10,5e3,10),Tt("front windows"),e("fwx1","mm",600,10,5e3,10),e("fwx2","mm",1e3,10,5e3,10),e("fwh1","mm",1e3,10,5e3,10),e("fwh2","mm",1e3,10,5e3,10),e("fwh3","mm",200,10,5e3,10),e("fdx1","mm",1e3,10,5e3,10),e("fdx2","mm",1e3,10,5e3,10),e("fdh2","mm",2e3,10,5e3,10),e("fdh3","mm",200,10,5e3,10),Tt("Openings in 3D"),Te("d3_roof",!0),Te("d3_wall",!1),Te("d3_ground",!1),Te("d3_officeCeiling",!0),Te("d3_bridge",!0)],paramSvg:{onx:"factory_top.svg",ony:"factory_top.svg",olx:"factory_top.svg",oly:"factory_top.svg",iwx:"factory_top.svg",iwy:"factory_top.svg",ewx:"factory_top.svg",ewy:"factory_top.svg",officeOrientation:"factory_top.svg",ith:"factory_top.svg",eth:"factory_top.svg",bw:"factory_top.svg",oh1:"factory_west.svg",oh2:"factory_west.svg",rtn:"factory_west.svg",ran:"factory_west.svg",ram:"factory_west.svg",rth:"factory_west.svg",swx1:"factory_side_window.svg",swx2:"factory_side_window.svg",swh1:"factory_side_window.svg",swh2:"factory_side_window.svg",swh3:"factory_side_window.svg",fwx1:"factory_front_window.svg",fwx2:"factory_front_window.svg",fwh1:"factory_front_window.svg",fwh2:"factory_front_window.svg",fwh3:"factory_front_window.svg",fdx1:"factory_front_window.svg",fdx2:"factory_front_window.svg",fdh2:"factory_front_window.svg",fdh3:"factory_front_window.svg",d3_roof:"factory_top.svg",d3_wall:"factory_top.svg",d3_ground:"factory_top.svg",d3_officeCeiling:"factory_top.svg",d3_bridge:"factory_top.svg"},sim:{tMax:180,tStep:.5,tUpdate:500}};function Zs(c,t,r=""){const o=ae(po.partName+r),s=U(),i=U(),l=U(),d=U(),h=U(),f=U(),a=U(),b=U(),g=U(),S=U(),_=U(),x=U(),A=U(),R=U();o.logstr+=`${o.partName} simTime: ${c}
`;try{let k=function($,Ct){const se=[O,0,0];let Re=Ct;return $>2&&(Re=!Re),Re&&(se[2]=O),se},m=function($,Ct,se,Re){const ge=[0,0,0];let Yt=Re;return $>2&&(Yt=!Yt),Yt?ge[0]=Ct:ge[1]=Ct+se,ge};var v=k,T=m;const O=Math.PI/2,W=t.onx*t.olx+(t.onx-1)*t.iwx+2*t.ewx,F=W+2*t.eth,ct=t.ony*t.oly+(t.ony-1)*t.iwy+2*t.ewy,u=ct+2*t.eth,I=W/1e3,J=F/1e3,G=ct/1e3,X=u/1e3,Ht=t.oh1+t.oh2,Q=t.olx-2*t.ith,ht=t.oly-2*t.ith,vt=t.eth+t.ewx,gt=t.eth+t.ewy,ft=F/t.rtn,st=we(t.ran),et=we(t.ram),E=Math.PI-st-et;if(E<.1)throw`err162: ras ${n(Qt(E))} is too small. Reduce ran ${n(t.ran)} or ram ${n(t.ram)} degree`;const[xt,K,ut]=Cs(E,ft,st);o.logstr+=ut;const nt=xt*Math.sin(st),tt=xt*Math.cos(st),Nt=ft-tt,Pt=100*tt/ft,Ft=100*Nt/ft,V=100*nt/ft;let it=t.ony,wt=t.oly,dt=t.iwy,Y=t.ewy,rt=t.onx,p=t.olx,at=t.iwx,kt=t.ewx;if(t.officeOrientation>2&&(it=t.onx,wt=t.olx,dt=t.iwx,Y=t.ewx,rt=t.ony,p=t.oly,at=t.iwy,kt=t.ewy),t.officeOrientation>5)throw`err189: officeOrientation ${t.officeOrientation} is out of range`;const Ot=2*t.ith+t.fwx1+t.fwx2+t.fdx1+t.fdx2,It=t.ith+t.fwh1+t.fwh2+t.fwh3,w=t.ith+t.fdh1+t.fdh2,Dt=2*t.ith+t.swx1+t.swx2,B=t.ith+t.swh1+t.swh2+t.swh3,bt=[...Array(t.onx).keys()],L=bt.map($=>t.eth+t.ewx+$*(t.olx+t.iwx)),Gt=bt.map($=>t.eth+t.ewx+$*(t.olx+t.iwx)+t.olx-t.ith),Vt=[...Array(t.ony).keys()],q=Vt.map($=>t.eth+t.ewy+$*(t.oly+t.iwy)),H=Vt.map($=>t.eth+t.ewy+$*(t.oly+t.iwy)+t.oly-t.ith);let y=L,C=Gt,P=q,Z=H,D=L;t.officeOrientation==1?(y=Gt,C=L):t.officeOrientation==2?(y=bt.map($=>$%2===0?Gt[$]:L[$]),C=bt.map($=>$%2===0?L[$]:Gt[$])):t.officeOrientation==3?(y=q,C=H):t.officeOrientation==4?(y=H,C=q):t.officeOrientation==5&&(y=Vt.map($=>$%2===0?H[$]:q[$]),C=Vt.map($=>$%2===0?q[$]:H[$])),t.officeOrientation>2&&(P=L,Z=Gt,D=q);const ot=[...P,...Z],Wt=[...Array(t.onx-1).keys()],St=[...Array(t.ony-1).keys()],yt=Wt.map($=>t.eth+t.ewx+t.olx+$*(t.olx+t.iwx)),$t=St.map($=>t.eth+t.ewy+t.oly+$*(t.oly+t.iwy)),lt=(t.olx-t.bw)/2,Lt=(t.oly-t.bw)/2,qt=Vt.map($=>t.eth+t.ewy+Lt+$*(t.oly+t.iwy)),Xt=bt.map($=>t.eth+t.ewx+lt+$*(t.olx+t.iwx)),Zt=t.iwx/2,Et=t.iwy/2,mt=t.ith+Zt,Ut=t.ith+Et;if(Q<0)throw`err158: olix ${n(Q)} is too small compare to ith ${t.ith}`;if(ht<0)throw`err161: oliy ${n(ht)} is too small compare to ith ${t.ith}`;if(wt<Ot)throw`err201: ofW ${wt} is too small compare to fwx1 ${t.fwx1}, fwx2 ${t.fwx2}, fdx1 ${t.fdx1}, fdx2 ${t.fdx2}`;if(t.oh1<It)throw`err204: oh1 ${t.oh1} is too small compare to fwh1 ${t.fwh1}, fwh2 ${t.fwh2}, fwh3 ${t.fwh3}`;if(t.oh1<w)throw`err207: oh1 ${t.oh1} is too small compare to fdh1 ${t.fdh1}, fdh2 ${t.fdh2}`;if(p<Dt)throw`err210: osW ${p} is too small compare to swx1 ${t.swx1} and swx2 ${t.swx2}`;if(t.oh1<B)throw`err213: oh1 ${t.oh1} is too small compare to swh1 ${t.swh1}, swh2 ${t.swh2}, swh3 ${t.swh3}`;if(t.fwx2<2*t.fwh3)throw`err213: fwh3 ${t.fwh3} is too large compare to fwx2 ${t.fwx2}`;if(t.fdx2<2*t.fdh3)throw`err219: fdh3 ${t.fdh3} is too large compare to fdx2 ${t.fdx2}`;if(t.swx2<2*t.swh3)throw`err222: swh3 ${t.swh3} is too large compare to swx2 ${t.swx2}`;if(Math.min(t.olx,t.oly)<t.bw)throw`err172: bw ${t.bw} is too large compare to olx ${t.olx} or oly ${t.oly}`;o.logstr+=`factory size: llex ${n(J)} x lley ${n(X)} m
`,o.logstr+=`factory surface: ext ${n(J*X)}, int ${n(I*G)} m2
`,o.logstr+=`roof: triL ${n(ft)}, Rh ${n(nt)} mm, Rhyp ${n(V)} %
`,o.logstr+=`roof north glass length ${n(xt)} mm, Rhxp ${n(Pt)} %, roof south opaque ${n(K)} mm, Rhxsp ${n(Ft)} %
`;const Kt=[],zt=[],ne=[];for(let $=0;$<it;$++){const Ct=t.eth+Y+$*(wt+dt),se=t.ith+t.fwx1+t.fwx2+t.fdx1,Re=wt-se-t.fdx2,ge=M(Ct,0,wt,t.oh1),Yt=Mt(Ct,0).addSegStrokeR(se,0).addSegStrokeR(0,t.fdh2).addPointR(t.fdx2/2,t.fdh3).addPointR(t.fdx2,0).addSegArc2().addSegStrokeR(0,-t.fdh2).addSegStrokeR(Re,0).addSegStrokeR(0,t.oh1).addSegStrokeR(-wt,0).closeSegStroke(),Me=Mt(Ct+t.ith+t.fwx1,t.fwh1).addSegStrokeR(t.fwx2,0).addSegStrokeR(0,t.fwh2).addPointR(-t.fwx2/2,t.fwh3).addPointR(-t.fwx2,0).addSegArc2().closeSegStroke();Kt.push(ge),zt.push(Yt),ne.push(Me)}const he=[],oe=[];for(let $=0;$<rt;$++){const Ct=t.eth+kt+$*(p+at),se=M(Ct,0,p,t.oh1),Re=Mt(Ct+t.ith+t.swx1,t.swh1).addSegStrokeR(t.swx2,0).addSegStrokeR(0,t.swh2).addPointR(-t.swx2/2,t.swh3).addPointR(-t.swx2,0).addSegArc2().closeSegStroke();he.push(se),oe.push(Re)}const re=[],fe=M(0,0,F,u),$e=M(t.eth,t.eth,W,ct);s.addMainOI([fe,$e]);for(let $=0;$<t.onx;$++)for(let Ct=0;Ct<t.ony;Ct++){const se=vt+$*(t.olx+t.iwx),Re=gt+Ct*(t.oly+t.iwy),ge=M(se,Re,t.olx,t.oly),Yt=M(se+t.ith,Re+t.ith,Q,ht);s.addMainOI([ge,Yt]),re.push(ge)}for(let $=0;$<t.onx-1;$++)for(let Ct=0;Ct<t.ony;Ct++){const se=vt+$*(t.olx+t.iwx)+t.olx,Re=gt+Ct*(t.oly+t.iwy)+(t.oly-t.bw)/2,ge=M(se,Re,t.iwx,t.bw);s.addMainO(ge)}for(let $=0;$<t.onx;$++)for(let Ct=0;Ct<t.ony-1;Ct++){const se=vt+$*(t.olx+t.iwx)+(t.olx-t.bw)/2,Re=gt+Ct*(t.oly+t.iwy)+t.oly,ge=M(se,Re,t.bw,t.iwy);s.addMainO(ge)}i.addMainO(M(0,-t.eth,F,t.eth)),i.addMainO(M(0,0,t.eth,Ht)),i.addMainO(M(F-t.eth,0,t.eth,Ht));for(let $=0;$<t.onx;$++){const Ct=vt+$*(t.olx+t.iwx);i.addMainOI([M(Ct,0,t.olx,t.oh1),M(Ct+t.ith,0,Q,t.oh1-t.ith)])}const ce=Mt(0,Ht);for(let $=0;$<t.rtn;$++)ce.addSegStrokeR(tt,nt).addSegStrokeR(Nt,-nt);ce.addSegStrokeR(0,t.rth);for(let $=0;$<t.rtn;$++)ce.addSegStrokeR(-Nt,nt).addSegStrokeR(-tt,-nt);ce.closeSegStroke(),i.addMainO(ce);const ue=Mt(0,0).addSegStrokeR(F,0).addSegStrokeR(0,Ht);for(let $=0;$<t.rtn;$++)ue.addSegStrokeR(-Nt,nt).addSegStrokeR(-tt,-nt);ue.closeSegStroke(),i.addMainO(ue),l.addMainO(M(0,-t.eth,u,t.eth)),l.addMainO(M(0,0,t.eth,Ht)),l.addMainO(M(u-t.eth,0,t.eth,Ht));for(let $=0;$<t.ony;$++){const Ct=gt+$*(t.oly+t.iwy);l.addMainOI([M(Ct,0,t.oly,t.oh1),M(Ct+t.ith,0,ht,t.oh1-t.ith)])}l.addMainOI([M(0,Ht,u,nt+t.rth),M(0,Ht,u,t.rth),M(0,Ht+nt,u,t.rth)]);const xe=M(0,0,u,Ht);if(l.addMainO(xe),t.officeOrientation<3){for(let $=0;$<it;$++)l.addMainOI([zt[$],ne[$]]),l.addMainO(Kt[$]);for(let $=0;$<rt;$++)i.addMainOI([he[$],oe[$]])}else{for(let $=0;$<it;$++)i.addMainOI([zt[$],ne[$]]),i.addMainO(Kt[$]);for(let $=0;$<rt;$++)l.addMainOI([he[$],oe[$]])}d.mergeFigure(i,!0),d.addMainO(ce),h.mergeFigure(s,!0),h.addMainO(fe),f.mergeFigure(i,!0),f.addMainO(ue),a.mergeFigure(l,!0),a.addMainO(xe),b.mergeFigure(s,!0);for(const $ of re)b.addMainO($);t.officeOrientation<3?(g.mergeFigure(l,!0),S.mergeFigure(l,!0),_.mergeFigure(i,!0)):(g.mergeFigure(i,!0),S.mergeFigure(i,!0),_.mergeFigure(l,!0));for(let $=0;$<it;$++)g.addMainOI([zt[$],ne[$]]),S.addMainO(Kt[$]);for(let $=0;$<rt;$++)_.addMainOI([he[$],oe[$]]);for(const $ of y)for(const Ct of P)x.addMainO(M($,Ct,t.ith,wt));for(const $ of C)for(const Ct of P)x.addSecond(M($,Ct,t.ith,wt));for(const $ of ot)for(const Ct of D)x.addSecond(M(Ct,$,p,t.ith));A.mergeFigure(i,!0);for(const $ of yt){const Ct=Mt($,t.oh1).addSegStrokeR(0,-mt).addPointR(Zt,Zt).addPointR(2*Zt,0).addSegArc2().addSegStrokeR(0,mt).closeSegStroke();A.addMainO(Ct)}for(const $ of Xt)A.addSecond(M($,t.oh1-Ut,t.bw,Ut));R.mergeFigure(l,!0);for(const $ of $t){const Ct=Mt($,t.oh1).addSegStrokeR(0,-Ut).addPointR(Et,Et).addPointR(2*Et,0).addSegArc2().addSegStrokeR(0,Ut).closeSegStroke();R.addMainO(Ct)}for(const $ of qt)R.addSecond(M($,t.oh1-mt,t.bw,mt));o.fig={faceTop:s,faceWest:i,faceNorth:l,faceRoof:d,faceGround:h,faceWallEW:f,faceWallNS:a,faceOCeiling:b,faceOWallF:g,faceOWallB:S,faceOWallS:_,faceOWallTop:x,faceBridgeW:A,faceBridgeN:R};const Rt=o.partName,_e=[];_e.push(`subpax_${Rt}_wallSouth`),_e.push(`subpax_${Rt}_wallEast`),t.d3_roof&&_e.push(`subpax_${Rt}_roof`),t.d3_ground&&_e.push(`subpax_${Rt}_ground`),t.d3_wall&&(_e.push(`subpax_${Rt}_wallNorth`),_e.push(`subpax_${Rt}_wallWest`)),t.d3_officeCeiling&&_e.push(`subpax_${Rt}_officeCeiling`);const He=y.map(($,Ct)=>({outName:`subpax_${Rt}_OWF${Ct}`,face:`${Rt}_faceOWallF`,extrudeMethod:j.eLinearOrtho,length:t.ith,rotate:k(t.officeOrientation,!0),translate:m(t.officeOrientation,$,t.ith,!0)}));_e.push(...y.map(($,Ct)=>`subpax_${Rt}_OWF${Ct}`));const Le=C.map(($,Ct)=>({outName:`subpax_${Rt}_OWB${Ct}`,face:`${Rt}_faceOWallB`,extrudeMethod:j.eLinearOrtho,length:t.ith,rotate:k(t.officeOrientation,!0),translate:m(t.officeOrientation,$,t.ith,!0)}));_e.push(...C.map(($,Ct)=>`subpax_${Rt}_OWB${Ct}`));const pt=ot.map(($,Ct)=>({outName:`subpax_${Rt}_OWS${Ct}`,face:`${Rt}_faceOWallS`,extrudeMethod:j.eLinearOrtho,length:t.ith,rotate:k(t.officeOrientation,!1),translate:m(t.officeOrientation,$,t.ith,!1)}));_e.push(...ot.map(($,Ct)=>`subpax_${Rt}_OWS${Ct}`));const At=qt.map(($,Ct)=>({outName:`subpax_${Rt}_BW${Ct}`,face:`${Rt}_faceBridgeW`,extrudeMethod:j.eLinearOrtho,length:t.bw,rotate:[O,0,0],translate:[0,t.bw+$,0]})),Pe=Xt.map(($,Ct)=>({outName:`subpax_${Rt}_BN${Ct}`,face:`${Rt}_faceBridgeN`,extrudeMethod:j.eLinearOrtho,length:t.bw,rotate:[O,0,O],translate:[$,0,0]}));t.d3_bridge&&(_e.push(...qt.map(($,Ct)=>`subpax_${Rt}_BW${Ct}`)),_e.push(...Xt.map(($,Ct)=>`subpax_${Rt}_BN${Ct}`))),o.vol={extrudes:[{outName:`subpax_${Rt}_ground`,face:`${Rt}_faceGround`,extrudeMethod:j.eLinearOrtho,length:t.eth,rotate:[0,0,0],translate:[0,0,-t.eth]},{outName:`subpax_${Rt}_roof`,face:`${Rt}_faceRoof`,extrudeMethod:j.eLinearOrtho,length:u,rotate:[O,0,0],translate:[0,u,0]},{outName:`subpax_${Rt}_wallNorth`,face:`${Rt}_faceWallNS`,extrudeMethod:j.eLinearOrtho,length:t.eth,rotate:[O,0,O],translate:[0,0,0]},{outName:`subpax_${Rt}_wallSouth`,face:`${Rt}_faceWallNS`,extrudeMethod:j.eLinearOrtho,length:t.eth,rotate:[O,0,O],translate:[t.eth+W,0,0]},{outName:`subpax_${Rt}_wallWest`,face:`${Rt}_faceWallEW`,extrudeMethod:j.eLinearOrtho,length:t.eth,rotate:[O,0,0],translate:[0,t.eth,0]},{outName:`subpax_${Rt}_wallEast`,face:`${Rt}_faceWallEW`,extrudeMethod:j.eLinearOrtho,length:t.eth,rotate:[O,0,0],translate:[0,2*t.eth+ct,0]},{outName:`subpax_${Rt}_officeCeiling`,face:`${Rt}_faceOCeiling`,extrudeMethod:j.eLinearOrtho,length:t.ith,rotate:[0,0,0],translate:[0,0,t.oh1-t.ith]},...He,...Le,...pt,...At,...Pe],volumes:[{outName:`pax_${Rt}`,boolMethod:ee.eUnion,inList:_e}]},o.sub={},o.logstr+=`factory drawn successfully!
`,o.calcErr=!1}catch(k){o.logstr+=k,console.log(k)}return o}var Us={pTitle:"factory",pDescription:"a scalable factory-plan",pDef:po,pGeom:Zs},ts={partName:"springTorqueA",params:[e("D1","mm",20,1,1e3,1),e("N1","hole",16,0,400,1),e("T1","mm",2,.1,50,.1),e("E1","mm",1,.1,50,.1),Tt("External ring"),Te("Ring2",!0),e("D2","mm",80,1,1e3,1),e("N2","hole",16,0,400,1),e("T2","mm",2,.1,50,.1),e("E2","mm",1,.1,50,.1),Tt("Spoke"),e("N3","spoke",5,0,60,1),e("E3","mm",3,.1,100,.1),e("R3","mm",3,0,100,.1),e("Th","mm",3,.1,100,.1)],paramSvg:{D1:"springTorqueA_profile.svg",N1:"springTorqueA_profile.svg",T1:"springTorqueA_profile.svg",E1:"springTorqueA_profile.svg",Ring2:"springTorqueA_profile.svg",D2:"springTorqueA_profile.svg",N2:"springTorqueA_profile.svg",T2:"springTorqueA_profile.svg",E2:"springTorqueA_profile.svg",N3:"springTorqueA_profile.svg",E3:"springTorqueA_profile.svg",R3:"springTorqueA_profile.svg",Th:"springTorqueA_profile.svg"},sim:{tMax:180,tStep:.5,tUpdate:500}};function Vs(c,t,r=""){const o=ae(ts.partName+r),s=U();o.logstr+=`${o.partName} simTime: ${c}
`;try{const i=t.D1/2,l=t.T1/2,d=t.D2/2,h=t.T2/2,f=t.Ring2?d+h+t.E2:i+l+t.E1,a=i-l-t.E1,b=i+l+t.E1,g=d-h-t.E2,S=t.E3/2;if(b+2*t.R3>g)throw`err087: D2 ${t.D2} is too small compare to D1 ${t.D1}, R3 ${t.R3}`;if(a<.1)throw`err093: D1 ${t.D1} is too small compare to T1 ${t.T1}, E1 ${t.E1}`;const _=2*Math.asin((l+.5*t.E1)/i),x=t.N1>0?2*Math.PI/t.N1:3.14;if(x<_)throw`err101: aInt ${n(Qt(x))} is too small compare to aIntMin ${n(Qt(_))} degree`;const A=2*Math.asin((h+.5*t.E2)/d),R=t.N2>0?2*Math.PI/t.N2:3.14;if(R<A)throw`err106: aExt ${n(Qt(R))} is too small compare to aExtMin ${n(Qt(A))} degree`;const v=Math.asin(S/g),T=Math.asin(S/b),k=Math.asin((S+t.R3)/(t.R3+b)),m=t.N3>0?2*Math.PI/t.N3:3.14,O=Math.sin(m/2),W=O>.1?S/O:b/2,F=O>.1?(S+t.R3)/O:b/2,ct=t.N3>1&&F>b+t.R3-.1;if(!ct&&m<2*k)throw`err115: ah0 ${n(Qt(m))} is too small compare to ah1 ${n(Qt(T))}, ahR1 ${n(Qt(k))} degree`;o.logstr+=`Dmax ${n(2*f)}, Dmin ${n(2*a)} mm
`,o.logstr+=`Triangle vs quadri: ${ct?"triangle":"quadri"}
`;const u=z(0,0,f),I=z(0,0,a),J=[];for(let Q=0;Q<t.N1;Q++){const ht=Jt(0,0).translatePolar(Q*x,i);J.push(z(ht.cx,ht.cy,l))}const G=[],X=[];if(t.Ring2){for(let Q=0;Q<t.N2;Q++){const ht=Jt(0,0).translatePolar(Q*R,d);G.push(z(ht.cx,ht.cy,h))}for(let Q=0;Q<t.N3;Q++){const ht=Q*m,vt=Jt(0,0).translatePolar(ht+T,b),gt=Jt(0,0).translatePolar(ht+m/2,W),[ft,st]=ct?[gt.cx,gt.cy]:[vt.cx,vt.cy],et=Mt(ft,st).addCornerRounded(t.R3).addSegStrokeAP(ht+v,g).addCornerRounded(t.R3).addPointAP(ht+m/2,g).addPointAP(ht+m-v,g).addSegArc2().addCornerRounded(t.R3);ct?et.closeSegStroke():et.addSegStrokeAP(ht+m-T,b).addCornerRounded(t.R3).addPointAP(ht+m/2,b).addPointAP(ht+T,b).addSegArc2(),X.push(et)}}s.addMainOI([u,I,...J,...G,...X]),s.addSecond(z(0,0,b)),s.addSecond(z(0,0,b+t.R3,"yellow")),s.addSecond(z(0,0,F,"orange")),o.fig={faceProfile:s};const Ht=o.partName;o.vol={extrudes:[{outName:`subpax_${Ht}_profile`,face:`${Ht}_faceProfile`,extrudeMethod:j.eLinearOrtho,length:t.Th,rotate:[0,0,0],translate:[0,0,0]}],volumes:[{outName:`pax_${Ht}`,boolMethod:ee.eIdentity,inList:[`subpax_${Ht}_profile`]}]},o.sub={},o.logstr+=`springTorqueA drawn successfully!
`,o.calcErr=!1}catch(i){o.logstr+=i,console.log(i)}return o}var zs={pTitle:"springTorqueA",pDescription:"spring disc for torque transmission",pDef:ts,pGeom:Vs};function Po(c,t){let r="";const o=we(c.aM),s=c.Dt/2,i=2*Math.PI/c.Nt,l=c.ate*i/100,d=c.Ht*c.dh/100,h=c.Ht*(c.ah+c.aeh)/100,f=s-d,a=s+h;let b=0,g=l;if(Math.abs(o)>.001){const A=eo(o,s,f),R=eo(Ro(Math.PI+o),s,a),[,,v,,,,T]=A,[,,,,,k,m]=R;r+=T+m,b=-v+k,g=l-2*k}const S=i-2*b-g;if(a>t)throw`err087: RbE ${a} is too large compare to RbEmax ${t}`;const _=1e-4;if(g<_||S<_)throw`err164: aAddE ${n(Qt(g))} or aDedE ${n(Qt(S))} are too small`;const x=Mt(f,0);for(let A=0;A<c.Nt;A++){const R=A*i;x.addSegStrokeAP(R+b,a).addCornerRounded(c.Rae),c.SnAae===1?x.addPointAP(R+b+g/2,a).addPointAP(R+b+g,a).addSegArc2():x.addSegStrokeAP(R+b+g,a),x.addCornerRounded(c.Rae),x.addSegStrokeAP(R+2*b+g,f).addCornerRounded(c.Rde),c.SnAde===1?x.addPointAP(R+i-S/2,f).addPointAP(R+i,f).addSegArc2():x.addSegStrokeAP(R+i,f),x.addCornerRounded(c.Rde)}return[x,r]}var es={partName:"plugTorque",params:[e("Nt","teeth",8,1,1e3,1),e("Dt","mm",22,.1,1e3,.1),e("Ht","mm",2,.1,100,.1),e("Th","mm",1,.1,100,.1),We("make3D",["both","intern","extern"]),Tt("Tooth profile"),e("ati","%",50,1,99,.1),e("ate","%",52,1,99,1),e("ah","%",100,1,400,1),e("dh","%",100,1,400,1),e("aeh","%",10,0,100,1),e("deh","%",10,0,100,1),e("aM","degree",0,-30,30,.1),Tt("Tooth profile details"),We("SnAai",["stroke","arc"]),We("SnAae",["stroke","arc"]),We("SnAdi",["stroke","arc"]),We("SnAde",["stroke","arc"]),e("Rai","mm",1,0,50,.1),e("Rae","mm",1,0,50,.1),e("Rdi","mm",1,0,50,.1),e("Rde","mm",1,0,50,.1),Tt("Internal part"),e("Ni","holes",5,0,1e3,1),e("Di","mm",12,.1,1e3,.1),e("DTi","mm",3,.1,100,.1),e("Ei","mm",1,.1,100,.1),Tt("External part"),e("Ne","holes",8,0,1e3,1),e("De","mm",32,.1,1e3,.1),e("DTe","mm",3,.1,100,.1),e("Ee","mm",1,.1,100,.1)],paramSvg:{Nt:"plugTorque_teeth_radial.svg",Dt:"plugTorque_teeth_radial.svg",Ht:"plugTorque_teeth_radial.svg",Th:"plugTorque_parts.svg",make3D:"plugTorque_parts.svg",ati:"plugTorque_teeth_radial.svg",ate:"plugTorque_teeth_radial.svg",ah:"plugTorque_teeth_radial.svg",dh:"plugTorque_teeth_radial.svg",aeh:"plugTorque_teeth_radial.svg",deh:"plugTorque_teeth_radial.svg",aM:"plugTorque_teeth_adden.svg",SnAai:"plugTorque_teeth_radial.svg",SnAae:"plugTorque_teeth_radial.svg",SnAdi:"plugTorque_teeth_radial.svg",SnAde:"plugTorque_teeth_radial.svg",Rai:"plugTorque_teeth_adden.svg",Rae:"plugTorque_teeth_adden.svg",Rdi:"plugTorque_teeth_deden.svg",Rde:"plugTorque_teeth_deden.svg",Ni:"plugTorque_parts.svg",Di:"plugTorque_parts.svg",DTi:"plugTorque_parts.svg",Ei:"plugTorque_parts.svg",Ne:"plugTorque_parts.svg",De:"plugTorque_parts.svg",DTe:"plugTorque_parts.svg",Ee:"plugTorque_parts.svg"},sim:{tMax:180,tStep:.5,tUpdate:500}};function Ks(c,t,r=""){const o=ae(es.partName+r),s=U(),i=U();o.logstr+=`${o.partName} simTime: ${c}
`;try{const l=we(t.aM),d=t.Dt/2,h=t.Di/2,f=t.De/2,a=t.DTi/2,b=t.DTe/2,g=h-a-t.Ei,S=f+b+t.Ee,_=t.Ni>0?2*Math.PI/t.Ni:3.14,x=t.Ne>0?2*Math.PI/t.Ne:3.14,A=Math.asin((a+.3*t.Ei)/h),R=Math.asin((b+.3*t.Ee)/f),v=t.Dt/t.Nt,T=2*Math.PI/t.Nt,k=t.ati*T/100,m=t.ate*T/100,O=t.Ht*t.ah/100,W=t.Ht*(t.dh+t.deh)/100,F=d+O,ct=d-W,u=t.Ht*t.dh/100,I=t.Ht*(t.ah+t.aeh)/100,J=d-u,G=d+I;let X=0,Ht=0,Q=k,ht=m;if(Math.abs(l)>.001){const V=eo(l,d,ct),it=eo(Ro(Math.PI+l),d,F),wt=eo(l,d,J),dt=eo(Ro(Math.PI+l),d,G),[,,Y,,,,rt]=V,[,,,,,p,at]=it,[,,kt,,,,Ot]=wt,[,,,,,It,w]=dt;o.logstr+=rt+at+Ot+w,X=-Y+p,Ht=-kt+It,Q=k-2*p,ht=m-2*It}const vt=T-2*X-Q,gt=T-2*Ht-ht,ft=(t.ate-t.ati)*T/100,st=f-b-t.Ee;if(g<.1)throw`err087: RminI ${g} is too small because of Di ${t.Di}, DTi ${t.DTi} or Ei ${t.Ei}`;if(_<2*A)throw`err131: adTi ${n(Qt(_))} is too small compare to aMindTi ${n(Qt(A))} degree`;if(x<2*R)throw`err134: adTe ${n(Qt(x))} is too small compare to aMindTe ${n(Qt(R))} degree`;if(t.ati>t.ate)throw`err145: ate ${t.ate} is too small compare to ati ${t.ati} %`;if(ct<h+a+t.Ei)throw`err087: RbI ${ct} is too small compare to Di ${t.Di}, DTi ${t.DTi} or Ei ${t.Ei}`;if(G>st)throw`err087: RbE ${G} is too large compare to De ${t.De}, DTe ${t.DTe} or Ee ${t.Ee}`;const et=1e-4;if(Q<et||vt<et)throw`err161: aAddI ${n(Qt(Q))} or aDedI ${n(Qt(vt))} are too small`;if(ht<et||gt<et)throw`err164: aAddE ${n(Qt(ht))} or aDedE ${n(Qt(gt))} are too small`;o.logstr+=`Extern: Dmax ${n(2*S)}, Dmin ${n(2*J)} mm
`,o.logstr+=`Intern: Dmax ${n(2*F)}, Dmin ${n(2*g)} mm
`,o.logstr+=`aSlack: ${n(Qt(ft))} degree
`,o.logstr+=`Tooth: Ht ${t.Ht}, moduli ${n(v)}, Hti ${n(O+W)}, Hte ${n(I+u)} mm
`,o.logstr+=`Tooth angle intern: aM ${t.aM}, aM[adden] ${n(Qt(-k/2))}, aM[deden] ${n(Qt((T-k)/2))} degree
`,o.logstr+=`Tooth angle extern: aM ${t.aM}, aM[adden] ${n(Qt(-m/2))}, aM[deden] ${n(Qt((T-m)/2))} degree
`;const E=[];E.push(z(0,0,g));for(let V=0;V<t.Ni;V++){const it=Jt(0,0).translatePolar(V*_,h);E.push(z(it.cx,it.cy,a))}const xt=Mt(ct,0);for(let V=0;V<t.Nt;V++){const it=V*T;xt.addSegStrokeAP(it+X,F).addCornerRounded(t.Rai),t.SnAai===1?xt.addPointAP(it+X+Q/2,F).addPointAP(it+X+Q,F).addSegArc2():xt.addSegStrokeAP(it+X+Q,F),xt.addCornerRounded(t.Rai),xt.addSegStrokeAP(it+2*X+Q,ct).addCornerRounded(t.Rdi),t.SnAdi===1?xt.addPointAP(it+T-vt/2,ct).addPointAP(it+T,ct).addSegArc2():xt.addSegStrokeAP(it+T,ct),xt.addCornerRounded(t.Rdi)}const K=[];K.push(z(0,0,S));for(let V=0;V<t.Ne;V++){const it=Jt(0,0).translatePolar(V*x,f);K.push(z(it.cx,it.cy,b))}const[ut,nt]=Po(t,st);o.logstr+=nt,s.addMainOI([xt,...E]),s.addSecond(z(0,0,d)),s.addSecond(ut);for(const V of K)s.addSecond(V);i.addMainOI([...K,ut]),i.addSecond(z(0,0,d)),i.addSecond(xt);for(const V of E)i.addSecond(V);o.fig={faceIntern:s,faceExtern:i};const tt=o.partName,Nt=`subpax_${tt}_intern`,Pt=`subpax_${tt}_extern`,Ft=[];switch(t.make3D){case 1:Ft.push(Nt);break;case 2:Ft.push(Pt);break;default:Ft.push(Nt),Ft.push(Pt);break}o.vol={extrudes:[{outName:Nt,face:`${tt}_faceIntern`,extrudeMethod:j.eLinearOrtho,length:t.Th,rotate:[0,0,0],translate:[0,0,0]},{outName:Pt,face:`${tt}_faceExtern`,extrudeMethod:j.eLinearOrtho,length:t.Th,rotate:[0,0,-ft/2],translate:[0,0,0]}],volumes:[{outName:`pax_${tt}`,boolMethod:ee.eUnion,inList:Ft}]},o.sub={},o.logstr+=`plugTorque drawn successfully!
`,o.calcErr=!1}catch(l){o.logstr+=l,console.log(l)}return o}var Qs={pTitle:"plugTorque",pDescription:"plugable torque transmission",pDef:es,pGeom:Ks},os={partName:"springTorqueB",params:[e("De","mm",80,1,1e3,1),e("Ne","hole",16,0,400,1),e("DTe","mm",2,.1,50,.1),e("Ee","mm",1,.1,50,.1),Te("Teeth",!0),e("Th","mm",3,.1,100,.1),Tt("Internal ring"),e("Di","mm",30,1,1e3,1),e("Ni","hole",8,0,400,1),e("DTi","mm",2,.1,50,.1),e("Ei","mm",1,.1,50,.1),Tt("Spring"),e("Ns","spring",6,4,60,1),e("aEs","%",10,1,90,1),e("Esi","%",10,1,90,1),e("Ese","%",10,1,90,1),e("Nk","zigzag",3,1,100,1),e("Wk","mm",1,.1,20,.1),e("Wc","mm",1,.1,20,.1),e("Rrsi","mm",1,0,20,.1),e("Rrse","mm",1,0,20,.1),Tt("Tooth Profile"),e("Nt","teeth",8,1,1e3,1),e("Dt","mm",20,.1,1e3,.1),e("Ht","mm",2,.1,100,.1),e("ate","%",52,1,99,1),e("ah","%",100,1,400,1),e("dh","%",100,1,400,1),e("aeh","%",10,0,100,1),e("aM","degree",0,-30,30,.1),Tt("Tooth profile details"),We("SnAae",["stroke","arc"]),We("SnAde",["stroke","arc"]),e("Rae","mm",1,0,50,.1),e("Rde","mm",1,0,50,.1)],paramSvg:{De:"springTorqueB_profile.svg",Ne:"springTorqueB_profile.svg",DTe:"springTorqueB_profile.svg",Ee:"springTorqueB_profile.svg",Teeth:"springTorqueB_profile.svg",Th:"springTorqueB_profile.svg",Di:"springTorqueB_profile.svg",Ni:"springTorqueB_profile.svg",DTi:"springTorqueB_profile.svg",Ei:"springTorqueB_profile.svg",Ns:"springTorqueB_profile.svg",aEs:"springTorqueB_profile.svg",Esi:"springTorqueB_profile.svg",Ese:"springTorqueB_profile.svg",Nk:"springTorqueB_profile.svg",Wk:"springTorqueB_profile.svg",Wc:"springTorqueB_profile.svg",Rrsi:"springTorqueB_profile.svg",Rrse:"springTorqueB_profile.svg",Nt:"plugTorque_teeth_radial.svg",Dt:"plugTorque_teeth_radial.svg",Ht:"plugTorque_teeth_radial.svg",ate:"plugTorque_teeth_radial.svg",dh:"plugTorque_teeth_radial.svg",ah:"plugTorque_teeth_radial.svg",aeh:"plugTorque_teeth_radial.svg",aM:"plugTorque_teeth_adden.svg",SnAae:"plugTorque_teeth_radial.svg",SnAde:"plugTorque_teeth_radial.svg",Rae:"plugTorque_teeth_radial.svg",Rde:"plugTorque_teeth_radial.svg"},sim:{tMax:180,tStep:.5,tUpdate:500}};function So(c,t,r,o){let s=Math.PI/2,i=-Math.PI/2;if(t>c){const l=t-c,d=r+o,h=Math.sqrt(d**2+l**2),f=Math.atan2(l,d),a=h*r/d,b=Math.acos(r/a);s=Math.PI/2-f-b,i=-Math.PI/2-f-b}return[s,i]}function _o(c,t,r,o){let s=Math.PI/2,i=-Math.PI/2;if(c>t){const l=c-t,d=o+r,h=Math.sqrt(d**2+l**2),f=Math.atan2(l,d),a=h*r/d,b=Math.acos(r/a);s=Math.PI/2+f+b,i=-Math.PI/2+f+b}return[s,i]}function ps(c,t,r=""){const o=ae(os.partName+r),s=U();o.logstr+=`${o.partName} simTime: ${c}
`;try{const i=t.De/2,l=t.DTe/2,d=t.Di/2,h=t.DTi/2,f=i+l+t.Ee,a=d-h-t.Ei,b=i-l-t.Ee,g=d+h+t.Ei,S=b-g,_=S*t.Esi/100,x=S*t.Ese/100,A=S-_-x,R=2*Math.PI/t.Ns,v=R*t.aEs/100,T=R-v,k=(b-x)*Math.sin(T),m=k/(2*t.Nk),O=m/2,W=m-t.Wk;if(a<.1)throw`err120: Di ${t.Di} is too small compare to DTi ${t.DTi}, Ei ${t.Ei}`;if(A<2*t.Wk)throw`err133: dRLs ${A} is too small compare to Wk ${t.Wk}`;if(_<.6*t.Wk)throw`err136: Esi ${_} is too small compare to Wk ${t.Wk}`;if(x<.6*t.Wk)throw`err139: Ese ${x} is too small compare to Wk ${t.Wk}`;if(W<.1)throw`err145: Ek ${W} is too small`;if(A<2*O)throw`err148: dRLs ${A} is too small compare to Rk ${O}. Increase Nk ${t.Nk}`;const F=2*Math.asin((h+.5*t.Ei)/d),ct=t.Ni>0?2*Math.PI/t.Ni:3.14;if(ct<F)throw`err126: aHI ${n(Qt(ct))} is too small compare to aHMinI ${n(Qt(F))} degree`;const u=2*Math.asin((l+.5*t.Ee)/i),I=t.Ne>0?2*Math.PI/t.Ne:3.14;if(I<u)throw`err131: aHE ${n(Qt(I))} is too small compare to aHMinE ${n(Qt(u))} degree`;const J=[],G=g+_+A-O;for(let w=0;w<t.Nk;w++){const Dt=(w*4+1)*O,B=Math.sqrt(G**2-Dt**2);J.push(Jt(B,Dt))}const X=[],Ht=g+_+O,Q=T<Math.PI/2-1e-4?1/Math.tan(T):0,ht=O/Math.sin(T);for(let w=0;w<t.Nk;w++){const Dt=(w*4+3)*O;let B=Q*Dt+ht;B**2+Dt**2<Ht**2&&(B=Math.sqrt(Ht**2-Dt**2)),X.push(Jt(B,Dt))}const vt=t.Wk/2,gt=Math.asin(vt/g),ft=Math.asin(vt/b),st=Jt(0,0).translatePolar(gt,g),et=Jt(0,0).translatePolar(T+ft,b),E=Jt(0,0).translatePolar(T-ft,b),xt=Jt(0,0).translatePolar(-gt,g),K=O-vt,ut=O+vt;o.logstr+=`Dmax ${n(2*f)}, Dmin1 ${n(2*a)} mm
`,o.logstr+=`Spring area: aSpring ${n(Qt(T))} degree, dRLs ${n(A)}, HLs ${n(k)} mm
`,o.logstr+=`Spring zigzag: Ek ${n(W)}, Rk ${n(O)} mm
`;const nt=z(0,0,f),tt=[];if(t.Teeth===1){const[w,Dt]=Po(t,a);o.logstr+=Dt,tt.push(w)}else tt.push(z(0,0,a));for(let w=0;w<t.Ni;w++){const Dt=Jt(0,0).translatePolar(w*ct,d);tt.push(z(Dt.cx,Dt.cy,h))}for(let w=0;w<t.Ne;w++){const Dt=Jt(0,0).translatePolar(w*I,i);tt.push(z(Dt.cx,Dt.cy,l))}const Nt=Mt(g+_,0).addSegStrokeAP(0,b-x).addPointAP(T/2,b-x).addPointAP(T,b-x).addSegArc2().addSegStrokeAP(T,g+_).addPointAP(T/2,g+_).addPointAP(0,g+_).addSegArc2();s.addSecond(Nt),s.addSecond(Nt.rotate(0,0,R)),s.addSecond(Nt.rotate(0,0,-R));for(let w=0;w<t.Nk;w++)s.addSecond(z(J[w].cx,J[w].cy,O)),s.addSecond(z(X[w].cx,X[w].cy,O));const Pt=Mt(st.cx,st.cy);for(let w=0;w<t.Nk;w++){let Dt=-Math.PI/2;const[B,bt]=So(J[w].cx,X[w].cx,K,ut);let L=Math.PI/2;if(w>0){const[,P]=_o(X[w-1].cx,J[w].cx,ut,K);Dt=P}if(w<t.Nk-1){const[P]=_o(X[w].cx,J[w+1].cx,ut,K);L=P}const Gt=J[w].translatePolar(Dt,K),Vt=J[w].translatePolar(Dt+ao((B-Dt)/2),K),q=J[w].translatePolar(B,K),H=X[w].translatePolar(bt,ut),y=X[w].translatePolar(bt-ao((bt-L)/2),ut),C=X[w].translatePolar(L,ut);Pt.addSegStrokeA(Gt.cx,Gt.cy).addPointA(Vt.cx,Vt.cy).addPointA(q.cx,q.cy).addSegArc2().addSegStrokeA(H.cx,H.cy),w<t.Nk-1&&Pt.addPointA(y.cx,y.cy).addPointA(C.cx,C.cy).addSegArc2()}const[,Ft]=So(J[t.Nk-1].cx,X[t.Nk-1].cx,K,ut),V=Math.PI/2+T,it=Ft-ao((Ft-V)/2),wt=X[t.Nk-1].translatePolar(it,ut),dt=X[t.Nk-1].translatePolar(V,ut),Y=X[t.Nk-1].translatePolar(it,K),rt=X[t.Nk-1].translatePolar(V,K);Pt.addPointA(wt.cx,wt.cy).addPointA(dt.cx,dt.cy).addSegArc2().addSegStrokeA(et.cx,et.cy);const[,p]=So(J[t.Nk-1].cx,X[t.Nk-1].cx,ut,K),at=X[t.Nk-1].translatePolar(p,K),kt=Mt(E.cx,E.cy).addSegStrokeA(rt.cx,rt.cy).addPointA(Y.cx,Y.cy).addPointA(at.cx,at.cy).addSegArc2();for(let w=t.Nk-1;w>=0;w--){let Dt=Math.PI/2,B=-Math.PI/2;const[bt,L]=So(J[w].cx,X[w].cx,ut,K);if(w>0){const[,P]=_o(X[w-1].cx,J[w].cx,K,ut);B=P}if(w<t.Nk-1){const[P]=_o(X[w].cx,J[w+1].cx,K,ut);Dt=P}const Gt=J[w].translatePolar(bt,ut),Vt=J[w].translatePolar(bt-ao((bt-B)/2),ut),q=J[w].translatePolar(B,ut),H=X[w].translatePolar(Dt,K),y=X[w].translatePolar(Dt+ao((L-Dt)/2),K),C=X[w].translatePolar(L,K);w<t.Nk-1&&kt.addSegStrokeA(H.cx,H.cy).addPointA(y.cx,y.cy).addPointA(C.cx,C.cy).addSegArc2(),kt.addSegStrokeA(Gt.cx,Gt.cy).addPointA(Vt.cx,Vt.cy).addPointA(q.cx,q.cy).addSegArc2()}kt.addSegStrokeA(xt.cx,xt.cy);const Ot=Mt(st.cx,st.cy).addCornerRounded(t.Rrsi).addPartial(Pt).addCornerRounded(t.Rrse).addPointAP(T+R/2,b).addPointAP(T+R-ft,b).addSegArc2().addCornerRounded(t.Rrse).addPartial(kt.rotate(0,0,R)).addCornerRounded(t.Rrsi).addPointAP(R/2,g).addPointAP(gt,g).addSegArc2();for(let w=0;w<t.Ns;w++)tt.push(Ot.rotate(0,0,w*R));s.addMainOI([nt,...tt]),o.fig={faceProfile:s};const It=o.partName;o.vol={extrudes:[{outName:`subpax_${It}_profile`,face:`${It}_faceProfile`,extrudeMethod:j.eLinearOrtho,length:t.Th,rotate:[0,0,0],translate:[0,0,0]}],volumes:[{outName:`pax_${It}`,boolMethod:ee.eIdentity,inList:[`subpax_${It}_profile`]}]},o.sub={},o.logstr+=`springTorqueB drawn successfully!
`,o.calcErr=!1}catch(i){o.logstr+=i,console.log(i)}return o}var tn={pTitle:"springTorqueB",pDescription:"spring disc for smooth torque transmission",pDef:os,pGeom:ps},ss={partName:"springTorqueC",params:[e("De","mm",80,1,1e3,1),e("Ne","hole",16,0,400,1),e("DTe","mm",2,.1,50,.1),e("Ee","mm",1,.1,50,.1),Te("Teeth",!0),e("Th","mm",3,.1,100,.1),Tt("Internal ring"),e("Di","mm",30,1,1e3,1),e("Ni","hole",8,0,400,1),e("DTi","mm",2,.1,50,.1),e("Ei","mm",1,.1,50,.1),Tt("Spring"),e("Ns","spring",6,1,60,1),We("zig",["alt","one","two"]),We("zag",["arc","stroke"]),e("aEs","%",20,1,99,1),e("Esi","%",10,0,90,1),e("Ese","%",10,0,90,1),e("Nk","zigzag",4,2,100,1),e("Wk","mm",1,.1,20,.1),e("Rrsi","mm",.1,0,20,.1),e("Rrse","mm",1,0,20,.1),Tt("Tooth Profile"),e("Nt","teeth",8,1,1e3,1),e("Dt","mm",20,.1,1e3,.1),e("Ht","mm",2,.1,100,.1),e("ate","%",52,1,99,1),e("ah","%",100,1,400,1),e("dh","%",100,1,400,1),e("aeh","%",10,0,100,1),e("aM","degree",0,-30,30,.1),Tt("Tooth profile details"),We("SnAae",["stroke","arc"]),We("SnAde",["stroke","arc"]),e("Rae","mm",1,0,50,.1),e("Rde","mm",1,0,50,.1)],paramSvg:{De:"springTorqueC_profile.svg",Ne:"springTorqueC_profile.svg",DTe:"springTorqueC_profile.svg",Ee:"springTorqueC_profile.svg",Teeth:"springTorqueC_profile.svg",Th:"springTorqueC_profile.svg",Di:"springTorqueC_profile.svg",Ni:"springTorqueC_profile.svg",DTi:"springTorqueC_profile.svg",Ei:"springTorqueC_profile.svg",Ns:"springTorqueC_profile.svg",zig:"springTorqueC_profile.svg",zag:"springTorqueC_profile.svg",aEs:"springTorqueC_profile.svg",Esi:"springTorqueC_profile.svg",Ese:"springTorqueC_profile.svg",Nk:"springTorqueC_profile.svg",Wk:"springTorqueC_profile.svg",Rrsi:"springTorqueC_profile.svg",Rrse:"springTorqueC_profile.svg",Nt:"plugTorque_teeth_radial.svg",Dt:"plugTorque_teeth_radial.svg",Ht:"plugTorque_teeth_radial.svg",ate:"plugTorque_teeth_radial.svg",dh:"plugTorque_teeth_radial.svg",ah:"plugTorque_teeth_radial.svg",aeh:"plugTorque_teeth_radial.svg",aM:"plugTorque_teeth_adden.svg",SnAae:"plugTorque_teeth_radial.svg",SnAde:"plugTorque_teeth_radial.svg",Rae:"plugTorque_teeth_radial.svg",Rde:"plugTorque_teeth_radial.svg"},sim:{tMax:180,tStep:.5,tUpdate:500}};function xo(c,t,r,o,s){const i=t.cx-c.cx,l=t.cy-c.cy,d=Math.sqrt(i**2+l**2),h=Math.atan2(l,i),f=r*d/(r+o),a=Math.acos(r/f);return c.translatePolar(h+s*a,r)}function en(c,t,r=""){const o=ae(ss.partName+r),s=U();o.logstr+=`${o.partName} simTime: ${c}
`;try{let _=function(q){const H=Math.asin(et/q),y=q*Math.cos(H),C=Math.atan2(wt,y),P=Math.sqrt(y**2+wt**2);return[C,P]},x=function(q,H,y){const C=H===0?q:st+q;return Jt(0,0).translatePolar(C,y)},A=function(q){return(Ot+q+1)%2},R=function(q,H,y){const C=A(H)===0?q:st+q;return Jt(0,0).translatePolar(C,y)},v=function(q){let H=q%2,y=q<t.Ns-1?(q+1)%2:0;return t.zig===1?(H=0,y=0):t.zig===2&&(H=1,y=1),[H,y]},T=function(q,H){const y=q===0?0:st,C=H===0?gt:gt+st,P=y+(C-y)/2,Z=A(q)===0?0:st,D=A(H)===0?gt:gt+st,ot=Z+(D-Z)/2,Wt=Jt(0,0).translatePolar(P,X),St=Jt(0,0).translatePolar(ot,G);return[Wt,St]},k=function(q){const H=q===0?tt:Nt,y=q===0?-Math.PI/2:Math.PI/2+st,C=q===0?Dt:B,P=H[0].translatePolar(y,C),Z=Mt(P.cx,P.cy);for(let D=0;D<t.Nk;D++){const ot=(D+q)%2,Wt=Math.atan2(H[D].cy,H[D].cx),St=ot===0?Wt-Math.PI/2:Wt+Math.PI/2,yt=ot===0?1:-1,$t=ot===0?Dt:B,lt=ot===0?B:Dt;if(D>0)if(it){const Xt=Jt(0,0).translatePolar(st/2,Pt[D]-$t),Zt=H[D].translatePolar(St-yt*Math.PI/2,$t);Z.addPointA(Xt.cx,Xt.cy).addPointA(Zt.cx,Zt.cy).addSegArc2()}else{const Xt=xo(H[D],H[D-1],$t,lt,yt);Z.addSegStrokeA(Xt.cx,Xt.cy)}let Lt=St,qt=St+yt*Math.PI/2;if(D===0?Lt=St+yt*Math.PI/4:D===t.Nk-1&&(Lt=St-yt*Math.PI/4,qt=ot===0?-Math.PI/2:Math.PI/2+st),D===t.Nk-1){const Xt=H[D].translatePolar(qt,$t);Z.addPointA(Xt.cx,Xt.cy).addSegArc($t,!1,ot===0)}else if(it){const Xt=H[D].translatePolar(Lt,$t),Zt=H[D].translatePolar(qt,$t);Z.addPointA(Xt.cx,Xt.cy).addPointA(Zt.cx,Zt.cy).addSegArc2()}else{const Xt=H[D].translatePolar(Lt,$t),Zt=xo(H[D],H[D+1],$t,lt,-yt);D>0&&st>V?Z.addPointA(Xt.cx,Xt.cy).addPointA(Zt.cx,Zt.cy).addSegArc2():Z.addPointA(Zt.cx,Zt.cy).addSegArc($t,!1,ot===0)}}return Z},m=function(q){const H=q===0?tt:Nt,y=A(q),C=y===0?-Math.PI/2:Math.PI/2+st,P=y===0?B:Dt,Z=H[t.Nk-1].translatePolar(C,P),D=Mt(Z.cx,Z.cy);for(let ot=t.Nk-1;ot>=0;ot--){const Wt=(ot+q)%2,St=Math.atan2(H[ot].cy,H[ot].cx),yt=Wt===0?St-Math.PI/2:St+Math.PI/2,$t=Wt===0?-1:1,lt=Wt===0?B:Dt,Lt=Wt===0?Dt:B;if(ot<t.Nk-1)if(it){const Zt=Jt(0,0).translatePolar(st/2,Pt[ot]+lt),Et=H[ot].translatePolar(yt-$t*Math.PI/2,lt);D.addPointA(Zt.cx,Zt.cy).addPointA(Et.cx,Et.cy).addSegArc2()}else{const Zt=xo(H[ot],H[ot+1],lt,Lt,$t);D.addSegStrokeA(Zt.cx,Zt.cy)}let qt=yt,Xt=yt+$t*Math.PI/2;if(ot===t.Nk-1?qt=yt+$t*Math.PI/4:ot===0&&(qt=yt-$t*Math.PI/4,Xt=Wt===0?-Math.PI/2:Math.PI/2+st),ot===0){const Zt=H[ot].translatePolar(Xt,lt);D.addPointA(Zt.cx,Zt.cy).addSegArc(lt,!1,Wt===1)}else if(it){const Zt=H[ot].translatePolar(qt,lt),Et=H[ot].translatePolar(Xt,lt);D.addPointA(Zt.cx,Zt.cy).addPointA(Et.cx,Et.cy).addSegArc2()}else{const Zt=H[ot].translatePolar(qt,lt),Et=xo(H[ot],H[ot-1],lt,Lt,-$t);ot<t.Nk-1&&st>V?D.addPointA(Zt.cx,Zt.cy).addPointA(Et.cx,Et.cy).addSegArc2():D.addPointA(Et.cx,Et.cy).addSegArc(lt,!1,Wt===1)}}return D},O=function(q){const[H,y]=v(q),C=H===0?It:w,P=y===0?It:w,[Z,D]=T(H,y);return Mt(C[0].cx,C[0].cy).addCornerRounded(t.Rrsi).addSegStrokeA(C[1].cx,C[1].cy).addPartial(k(H)).addSegStrokeA(C[3].cx,C[3].cy).addCornerRounded(t.Rrse).addPointA(D.cx,D.cy).addPointA(P[4].cx,P[4].cy).addSegArc2().addCornerRounded(t.Rrse).addSegStrokeA(P[5].cx,P[5].cy).addPartial(m(y).rotate(0,0,gt)).addSegStrokeA(P[7].cx,P[7].cy).addCornerRounded(t.Rrsi).addPointA(Z.cx,Z.cy).addPointA(C[0].cx,C[0].cy).addSegArc2().rotate(0,0,q*gt)};var i=_,l=x,d=A,h=R,f=v,a=T,b=k,g=m,S=O;const W=t.De/2,F=t.DTe/2,ct=t.Di/2,u=t.DTi/2,I=W+F+t.Ee,J=ct-u-t.Ei,G=W-F-t.Ee,X=ct+u+t.Ei,Ht=G-X,Q=Ht*t.Esi/100,ht=Ht*t.Ese/100,vt=Ht-Q-ht,gt=2*Math.PI/t.Ns,ft=gt*t.aEs/100,st=gt-ft,et=vt/(2*(t.Nk-1)),E=2*et-t.Wk;if(J<.1)throw`err120: Di ${t.Di} is too small compare to DTi ${t.DTi}, Ei ${t.Ei}`;if(vt<2*t.Wk)throw`err133: dRLs ${vt} is too small compare to Wk ${t.Wk}`;if(Q<.2*t.Rrsi)throw`err136: Esi ${Q} is too small compare to Rrsi ${t.Rrsi}`;if(ht<.2*t.Rrse)throw`err139: Ese ${ht} is too small compare to Rrse ${t.Rrse}`;if(E<.1)throw`err145: Ek ${E} is too small`;const xt=2*Math.asin((u+.5*t.Ei)/ct),K=t.Ni>0?2*Math.PI/t.Ni:3.14;if(K<xt)throw`err126: aHI ${n(Qt(K))} is too small compare to aHMinI ${n(Qt(xt))} degree`;const ut=2*Math.asin((F+.5*t.Ee)/W),nt=t.Ne>0?2*Math.PI/t.Ne:3.14;if(nt<ut)throw`err131: aHE ${n(Qt(nt))} is too small compare to aHMinE ${n(Qt(ut))} degree`;const tt=[],Nt=[],Pt=[],Ft=t.zig===2?1:0;for(let q=0;q<t.Nk;q++){const H=t.zig===1?0:1,y=X+Q+2*q*et;Pt.push(y);const C=Math.asin(et/y),P=q%2===Ft?C:st-C;tt.push(Jt(y*Math.cos(P),y*Math.sin(P)));const Z=q%2===H?C:st-C;Nt.push(Jt(y*Math.cos(Z),y*Math.sin(Z)))}const V=Math.asin(et/(X+Q));let it=t.zag===0;const wt=t.Wk/2,dt=Math.asin(wt/X),[Y,rt]=_(X+Q),[p,at]=_(G-ht),kt=Math.asin(wt/G),Ot=t.Nk%2,It=[];It.push(x(dt,0,X)),It.push(x(Y,0,rt)),It.push(R(p,0,at)),It.push(R(kt,0,G)),It.push(R(-kt,0,G).rotateOrig(gt)),It.push(R(-p,0,at).rotateOrig(gt)),It.push(x(-Y,0,rt).rotateOrig(gt)),It.push(x(-dt,0,X).rotateOrig(gt));const w=[];w.push(x(dt,1,X)),w.push(x(Y,1,rt)),w.push(R(p,1,at)),w.push(R(kt,1,G)),w.push(R(-kt,1,G).rotateOrig(gt)),w.push(R(-p,1,at).rotateOrig(gt)),w.push(x(-Y,1,rt).rotateOrig(gt)),w.push(x(-dt,1,X).rotateOrig(gt));const Dt=et-wt,B=et+wt;o.logstr+=`Dmax ${n(2*I)}, Dmin1 ${n(2*J)} mm
`,o.logstr+=`Spring area: aSpring ${n(Qt(st))} degree, dRLs ${n(vt)} mm
`,o.logstr+=`Spring zigzag: Ek ${n(E)}, Rk ${n(et)} mm
`,st<2*V&&(it=!1,o.logstr+=`Spring zigzag forced to stroke because of aArcMin ${n(Qt(V))} degree
`);const bt=z(0,0,I),L=[];if(t.Teeth===1){const[q,H]=Po(t,J);o.logstr+=H,L.push(q)}else L.push(z(0,0,J));for(let q=0;q<t.Ni;q++){const H=Jt(0,0).translatePolar(q*K,ct);L.push(z(H.cx,H.cy,u))}for(let q=0;q<t.Ne;q++){const H=Jt(0,0).translatePolar(q*nt,W);L.push(z(H.cx,H.cy,F))}const Gt=Mt(X+Q,0).addSegStrokeAP(0,G-ht).addPointAP(st/2,G-ht).addPointAP(st,G-ht).addSegArc2().addSegStrokeAP(st,X+Q).addPointAP(st/2,X+Q).addPointAP(0,X+Q).addSegArc2();s.addSecond(Gt),s.addSecond(Gt.rotate(0,0,gt)),s.addSecond(Gt.rotate(0,0,-gt));for(let q=0;q<t.Nk;q++){s.addSecond(z(tt[q].cx,tt[q].cy,et));const H=Nt[q].rotateOrig(gt);s.addSecond(z(H.cx,H.cy,et)),q>0&&s.addSecond(z(0,0,Pt[q]-et))}for(let q=0;q<t.Ns;q++)L.push(O(q));s.addMainOI([bt,...L]),o.fig={faceProfile:s};const Vt=o.partName;o.vol={extrudes:[{outName:`subpax_${Vt}_profile`,face:`${Vt}_faceProfile`,extrudeMethod:j.eLinearOrtho,length:t.Th,rotate:[0,0,0],translate:[0,0,0]}],volumes:[{outName:`pax_${Vt}`,boolMethod:ee.eIdentity,inList:[`subpax_${Vt}_profile`]}]},o.sub={},o.logstr+=`springTorqueC drawn successfully!
`,o.calcErr=!1}catch(_){o.logstr+=_,console.log(_)}return o}var on={pTitle:"springTorqueC",pDescription:"spring disc for smooth torque transmission",pDef:ss,pGeom:en};function Uo(c,t,r,o,s){const i=r/2,l=o-i;return s?Mt(c,t).addSegStrokeR(r,0).addSegStrokeR(0,l).addPointR(-i,i).addPointR(-r,0).addSegArc2().closeSegStroke():Mt(c,t+i).addPointR(i,-i).addPointR(r,0).addSegArc2().addSegStrokeR(0,l).addSegStrokeR(-r,0).closeSegStroke()}var ns={partName:"springWorm",params:[e("D1","mm",30,2,200,1),e("E1","mm",2,.1,50,.1),e("N1","groove",6,2,200,1),e("W2","mm",2,.1,50,.1),e("W3","mm",1,.1,50,.1),e("S1","mm",1,.1,50,.1),Tt("Extremity caps"),We("leftCaps",["ext","int"]),We("rightCaps",["ext","int"]),e("W1","mm",2,.1,50,.1),e("W1b","mm",1,.1,50,.1),Tt("Tooth Profile"),e("Nt","teeth",8,1,1e3,1),e("Dt","mm",20,.1,1e3,.1),e("Ht","mm",2,.1,100,.1),e("ate","%",52,1,99,1),e("ah","%",100,1,400,1),e("dh","%",100,1,400,1),e("aeh","%",10,0,100,1),e("aM","degree",0,-30,30,.1),Tt("Tooth profile details"),We("SnAae",["stroke","arc"]),We("SnAde",["stroke","arc"]),e("Rae","mm",1,0,50,.1),e("Rde","mm",1,0,50,.1)],paramSvg:{D1:"springWorm_mid.svg",E1:"springWorm_mid.svg",S1:"springWorm_mid.svg",W1:"springWorm_side.svg",W1b:"springWorm_side.svg",N1:"springWorm_side.svg",W2:"springWorm_side.svg",W3:"springWorm_side.svg",leftCaps:"springWorm_side.svg",rightCaps:"springWorm_caps.svg",Nt:"plugTorque_teeth_radial.svg",Dt:"plugTorque_teeth_radial.svg",Ht:"plugTorque_teeth_radial.svg",ate:"plugTorque_teeth_radial.svg",dh:"plugTorque_teeth_radial.svg",ah:"plugTorque_teeth_radial.svg",aeh:"plugTorque_teeth_radial.svg",aM:"plugTorque_teeth_adden.svg",SnAae:"plugTorque_teeth_radial.svg",SnAde:"plugTorque_teeth_radial.svg",Rae:"plugTorque_teeth_radial.svg",Rde:"plugTorque_teeth_radial.svg"},sim:{tMax:180,tStep:.5,tUpdate:500}};function sn(c,t,r=""){const o=ae(ns.partName+r),s=U(),i=U(),l=U(),d=U(),h=U(),f=U();o.logstr+=`${o.partName} simTime: ${c}
`;try{const a=t.D1/2,b=a-t.E1,g=1.2*a,S=t.S1/2,_=t.W3/2,x=(t.N1+1)*t.W2+t.N1*t.W3,A=t.leftCaps===0,R=t.rightCaps===0,v=A?t.W1:t.W1+t.W1b,T=R?t.W1:t.W1+t.W1b,k=v+x+T;if(b<.1)throw`err079: D1 ${t.D1} is too small compare to E1 ${t.E1}`;if(a-S<_)throw`err130: R1 ${a} is too small compare to S12 ${S} or W32 ${_}`;o.logstr+=`Dint ${n(2*b)} mm
`,o.logstr+=`Total length ${n(k)} mm
`;const[m,O]=Po(t,a);o.logstr+=O,s.addMainOI([z(0,0,a),z(0,0,b)]),s.addSecond(M(S,-g,a,2*g)),s.addSecond(M(-a-S,-g,a,2*g)),s.addSecond(M(-g,S,2*g,a)),s.addSecond(M(-g,-a-S,2*g,a));const W=[];W.push(M(0,-a,t.W1,t.D1)),A||W.push(M(t.W1,-a,t.W1b,t.D1)),W.push(M(v,-a,x,t.D1)),R||W.push(M(v+x,-a,t.W1b,t.D1)),W.push(M(k-t.W1,-a,t.W1,t.D1));for(const J of W)i.addSecond(J),l.addSecond(J);const F=v+t.W2,ct=t.W3+t.W2;for(let J=0;J<t.N1;J++){const G=Uo(F+J*ct,S,t.W3,a,!1),X=Uo(F+J*ct,-a-S,t.W3,a,!0);J%2===0?(i.addMainO(G),i.addMainO(X),l.addSecond(G),l.addSecond(X)):(i.addSecond(G),i.addSecond(X),l.addMainO(G),l.addMainO(X))}A?d.addMainOI([z(0,0,a),m]):(d.addMainO(m),d.addSecond(z(0,0,a))),d.addSecond(z(0,0,b)),R?h.addMainOI([z(0,0,a),m]):(h.addMainO(m),h.addSecond(z(0,0,a))),h.addSecond(z(0,0,b)),f.addMainO(z(0,0,a)),o.fig={faceTube:s,faceGroove1:i,faceGroove2:l,faceLeft:d,faceRight:h,faceW1b:f};const u=o.partName,I=[`subpax_${u}_tube`,`subpax_${u}_left`,`subpax_${u}_right`];A||I.push(`subpax_${u}_leftB`),R||I.push(`subpax_${u}_rightB`),o.vol={extrudes:[{outName:`subpax_${u}_tube`,face:`${u}_faceTube`,extrudeMethod:j.eLinearOrtho,length:x,rotate:[0,0,0],translate:[0,0,v]},{outName:`subpax_${u}_left`,face:`${u}_faceLeft`,extrudeMethod:j.eLinearOrtho,length:t.W1,rotate:[0,0,0],translate:[0,0,0]},{outName:`subpax_${u}_leftB`,face:`${u}_faceW1b`,extrudeMethod:j.eLinearOrtho,length:t.W1b,rotate:[0,0,0],translate:[0,0,t.W1]},{outName:`subpax_${u}_rightB`,face:`${u}_faceW1b`,extrudeMethod:j.eLinearOrtho,length:t.W1b,rotate:[0,0,0],translate:[0,0,v+x]},{outName:`subpax_${u}_right`,face:`${u}_faceRight`,extrudeMethod:j.eLinearOrtho,length:t.W1,rotate:[0,0,0],translate:[0,0,k-t.W1]},{outName:`subpax_${u}_groove1`,face:`${u}_faceGroove1`,extrudeMethod:j.eLinearOrtho,length:2*g,rotate:[0,-Math.PI/2,0],translate:[g,0,0]},{outName:`subpax_${u}_groove2`,face:`${u}_faceGroove2`,extrudeMethod:j.eLinearOrtho,length:2*g,rotate:[0,-Math.PI/2,-Math.PI/2],translate:[0,-g,0]}],volumes:[{outName:`ipax_${u}_plus`,boolMethod:ee.eUnion,inList:I},{outName:`ipax_${u}_moins`,boolMethod:ee.eUnion,inList:[`subpax_${u}_groove1`,`subpax_${u}_groove2`]},{outName:`pax_${u}`,boolMethod:ee.eSubstraction,inList:[`ipax_${u}_plus`,`ipax_${u}_moins`]}]},o.sub={},o.logstr+=`springWorm drawn successfully!
`,o.calcErr=!1}catch(a){o.logstr+=a,console.log(a)}return o}var nn={pTitle:"springWorm",pDescription:"Flex-part for unperfect coaxial transmission",pDef:ns,pGeom:sn},cs={partName:"springOne",params:[e("D1","mm",16,1,100,.1),e("Dbearing","mm",35,1,100,.1),e("H1","mm",5,1,100,1),e("H2","mm",15,1,100,1),e("R2","mm",15,1,100,1),e("L1","mm",50,1,200,1),e("Rc1","mm",5,0,50,1),Tt("Spring zone"),Te("spring",!0),e("E1","mm",2,1,100,1),e("E2","mm",2,1,100,1),e("smEy","mm",1,.1,10,.1),e("shEy","mm",1,.1,10,.1),e("shPr","%",90,0,99,1),e("sNx","xHoles",2,2,200,1),e("smEx","mm",1,.1,10,.1),e("smExS","mm",.5,.1,10,.1),Tt("Screw holes"),e("D3","mm",6,1,100,1),e("P3","mm",70,1,200,1),e("P4","mm",30,1,200,1),Tt("Borders"),e("L2","mm",20,1,200,1),e("E3","mm",1,0,20,.1),e("W1","mm",20,1,200,1),e("W3","mm",50,1,400,1),e("Rc3","mm",.5,0,10,.1),Te("B2",!0),e("A2","mm",10,1,200,1),e("Rc2","mm",5,0,50,1),Tt("Folding"),e("Th","mm",1,.1,10,.1),e("Jangle","degree",90,0,120,1),e("Jradius","mm",2,.1,10,.1),e("Jneutral","%",50,0,100,1),e("Jmark","mm",1,.1,10,.1)],paramSvg:{D1:"springOne_face.svg",Dbearing:"springOne_face.svg",H1:"springOne_face.svg",H2:"springOne_face.svg",R2:"springOne_face.svg",L1:"springOne_face.svg",Rc1:"springOne_face.svg",spring:"springOne_spring.svg",E1:"springOne_face.svg",E2:"springOne_face.svg",smEy:"springOne_spring.svg",shEy:"springOne_spring.svg",shPr:"springOne_spring.svg",sNx:"springOne_spring.svg",smEx:"springOne_spring.svg",smExS:"springOne_spring.svg",D3:"springOne_top.svg",P3:"springOne_top.svg",P4:"springOne_top.svg",L2:"springOne_top.svg",E3:"springOne_top.svg",W1:"springOne_top.svg",W3:"springOne_top.svg",Rc3:"springOne_top.svg",B2:"springOne_face.svg",A2:"springOne_face.svg",Rc2:"springOne_side.svg",Th:"springOne_side.svg",Jangle:"springOne_face.svg",Jradius:"springOne_face.svg",Jneutral:"springOne_face.svg",Jmark:"springOne_face.svg"},sim:{tMax:180,tStep:.5,tUpdate:500}};function cn(c,t,r=""){const o=ae(cs.partName+r),s=U();o.logstr+=`${o.partName} simTime: ${c}
`;try{let f=function(y){return Mt(0,0).addCornerRounded(it).addSegStrokeR(y,0).addCornerRounded(it).addSegStrokeR(0,t.shEy).addCornerRounded(it).addSegStrokeR(-y,0).addCornerRounded(it).closeSegStroke()},a=function(y,C,P){const Z=C===0?G:st,D=C===0?2*O:2*X,ot=y-k-t.H1,Wt=ot<0?D:D-2*ot*Z,St=t.L1/2-Wt/2+t.smExS,yt=P%2===0?t.sNx+1:t.sNx,$t=(Wt-2*t.smExS+t.smEx)/(t.sNx+1)-t.smEx,lt=$t/2-t.smEx/2,Lt=P%2===0?lt:$t;if(Lt<2*it)throw`err228: lxAZ ${n(Lt)} is too small compare to ${t.sNx} or ${t.smEx}`;return[St,Lt,$t,yt]},b=function(y){return ye(0,k).startJunction(y,de.eB,ie.eABRight).addSegStrokeR(t.L1,0).addSegStrokeR(0,t.H1).addCornerRounded(t.Rc1).addSegStrokeR(-I,J).addPointA(O,x+k).addPointA(I,t.H1+J+k).addSegArc2().addSegStrokeR(-I,-J).addCornerRounded(t.Rc1).closeSegStroke()},g=function(y){return ye(0,0).startJunction(y,de.eB,ie.eABRight).addSegStrokeR(t.W3,0).addSegStrokeR(0,t.A2).addCornerRounded(t.Rc2).addSegStrokeR(-t.W3,0).addCornerRounded(t.Rc2).closeSegStroke()};var i=f,l=a,d=b,h=g;const S=t.D1/2,_=t.D3/2,x=t.H1+t.H2+t.R2,A=we(t.Jangle),R=t.Jneutral/100,v=t.Jradius,T=t.Jmark,k=t.Jradius+(1-R)*t.Th,m=2*t.E3,O=t.L1/2,W=Math.atan2(t.H2,O),F=Math.sqrt(O**2+t.H2**2);if(t.R2>F)throw`err141: R2 ${t.R2} is too large comapre to lAC ${n(F)} mm`;const ct=Math.asin(t.R2/F),u=F*Math.cos(ct),I=u*Math.cos(W+ct),J=u*Math.sin(W+ct),G=I/J,X=O+m,Ht=Math.atan2(t.H2,X),Q=Math.sqrt(X**2+t.H2**2),ht=Math.asin(t.R2/Q),vt=Q*Math.cos(ht),gt=vt*Math.cos(Ht+ht),ft=vt*Math.sin(Ht+ht),st=gt/ft,et=t.L2-t.E3,E=t.L1+2*t.E3,xt=(t.W3-t.W1)/2,K=et+E/2,ut=t.W3/2,nt=t.P3/2,tt=t.P4/2,Nt=t.L1+2*t.L2,Pt=t.H1+t.H2-S-t.E1-t.E2,Ft=t.smEy+t.shEy,V=Math.floor((Pt+t.smEy)/Ft),it=t.shEy*t.shPr/200;if(S<.1)throw`err087: R1 ${n(S)} is too small because of D1 ${t.D1}`;if(et<.1)throw`err165: L2b ${n(et)} is too small because of E3 ${t.E3}`;if(t.E3<t.Rc3)throw`err170: E3 ${t.E3} is too small compare to Rc3 ${t.Rc3}`;if(xt<t.Rc3)throw`err174: W3b ${n(xt)} is too small compare to Rc3 ${t.Rc3}`;if(t.spring===1&&Pt<.1)throw`err189: sHeight ${n(Pt)} is too small because of E1 ${t.E1} or E2 ${t.E2}`;o.logstr+=`Bearing holder wall: Hwall ${n(x)}, Hfoot ${n(k)} mm
`,t.spring===1?o.logstr+=`spring: sNy ${V}, sRc ${n(it)} mm
`:o.logstr+=`No spring
`;const wt=[],dt=[];if(t.spring===1)for(let y=0;y<V;y++){const C=k+t.E1+y*Ft,P=C+t.shEy/2,[Z,D,ot,Wt]=a(P,0,y),[St,yt,$t]=a(P,1,y);let lt=Z,Lt=St;wt.push(f(D).translate(lt,C)),dt.push(f(yt).translate(Lt,C)),lt+=D+t.smEx,Lt+=yt+t.smEx;for(let qt=0;qt<Wt-1;qt++)wt.push(f(ot).translate(lt,C)),dt.push(f($t).translate(Lt,C)),lt+=ot+t.smEx,Lt+=$t+t.smEx;wt.push(f(D).translate(lt,C)),dt.push(f(yt).translate(Lt,C))}const Y=b("J1"),rt=b("J2"),p=z(O,k+t.H1+t.H2,S),at=z(O,k+t.H1+t.H2,t.Dbearing/2),kt=ve([Y,p,...wt]),Ot=ve([rt,p,...wt]),It=ye(0,0).addSegStrokeR(et,0).addSegStrokeR(0,xt).addCornerRounded(t.Rc3).addSegStrokeR(t.E3,0).startJunction("J1",de.eA,ie.eABLeft).addSegStrokeR(t.L1,0).addSegStrokeR(t.E3,0).addCornerRounded(t.Rc3).addSegStrokeR(0,-xt).addSegStrokeR(et,0);t.B2===1&&It.startJunction("J4",de.eA,ie.eABLeft),It.addSegStrokeR(0,t.W3).addSegStrokeR(-et,0).addSegStrokeR(0,-xt).addCornerRounded(t.Rc3).addSegStrokeR(-t.E3,0).startJunction("J2",de.eA,ie.eABLeft).addSegStrokeR(-t.L1,0).addSegStrokeR(-t.E3,0).addCornerRounded(t.Rc3).addSegStrokeR(0,xt).addSegStrokeR(-et,0),t.B2===1&&It.startJunction("J3",de.eA,ie.eABLeft),It.closeSegStroke();const w=[];w.push(z(K-nt,ut-tt,_)),w.push(z(K-nt,ut+tt,_)),w.push(z(K+nt,ut-tt,_)),w.push(z(K+nt,ut+tt,_));const Dt=ve([It,...w]),B=[],bt={};t.B2===1&&(B.push(ve([g("J3")])),B.push(ve([g("J4")])),bt.J3={angle:A,radius:v,neutral:R,mark:T},bt.J4={angle:A,radius:v,neutral:R,mark:T});let L=[],Gt=[];t.B2===1&&(L=["J3",t.A2],Gt=["J4",t.A2]);const Vt=vo([Dt,kt,Ot,...B],{J1:{angle:A,radius:v,neutral:R,mark:T},J2:{angle:A,radius:v,neutral:R,mark:T},...bt},[{x1:0,y1:0,a1:0,l1:t.W1,ante:["J1",x],post:["J2",x]},{x1:0,y1:k+1.5*x,a1:0,l1:Nt,ante:L,post:Gt}],t.Th,o.partName),q=ye(0,0).addSegStrokeR(t.L1,0).addSegStrokeR(0,k).addSegStrokeR(m,0).addSegStrokeR(0,t.H1).addCornerRounded(t.Rc1).addSegStrokeR(-gt,ft).addPointA(O,x+k).addPointA(gt-m,t.H1+ft+k).addSegArc2().addSegStrokeR(-gt,-ft).addCornerRounded(t.Rc1).addSegStrokeR(0,-t.H1).addSegStrokeR(m,0).closeSegStroke();s.addMainOI([q,p,...dt]),s.addSecond(at),s.mergeFigure(ms(kt),!0),o.fig={faceWallB:s};const H=Vt.makeFigures();for(const y of Object.keys(H))o.fig[y]=H[y];o.vol=Vt.makeVolume(),o.sub={},o.logstr+=`springOne drawn successfully!
`,o.calcErr=!1}catch(f){o.logstr+=f,console.log(f)}return o}var dn={pTitle:"springOne",pDescription:"bearing-holder with integrated spring",pDef:cs,pGeom:cn},ds={partName:"springSide",params:[e("D5","mm",100,10,5e3,1),e("N5","unit",8,3,100,1),e("W2","mm",20,1,200,1),Tt("One unit"),e("D1","mm",16,1,100,.1),e("H1","mm",5,1,100,1),e("H2","mm",15,1,100,1),e("R2","mm",15,1,100,1),Tt("Spring zone"),Te("spring",!0),e("E1","mm",2,1,100,1),e("E2","mm",2,1,100,1),e("smEy","mm",1,.1,10,.1),e("shEy","mm",1,.1,10,.1),e("shPr","%",90,0,99,1),e("sNx","xHoles",2,2,200,1),e("smEx","mm",1,.1,10,.1),e("smExS","mm",.5,.1,10,.1),Tt("Folding"),e("Th","mm",1,.1,10,.1),e("Jradius","mm",2,.1,10,.1),e("Jneutral","%",50,0,100,1),e("Jmark","mm",1,.1,10,.1)],paramSvg:{D5:"springSide_top.svg",N5:"springSide_top.svg",W2:"springSide_top.svg",D1:"springSide_face.svg",H1:"springSide_face.svg",H2:"springSide_face.svg",R2:"springSide_face.svg",spring:"springSide_spring.svg",E1:"springSide_face.svg",E2:"springSide_face.svg",smEy:"springSide_spring.svg",shEy:"springSide_spring.svg",shPr:"springSide_spring.svg",sNx:"springSide_spring.svg",smEx:"springSide_spring.svg",smExS:"springSide_spring.svg",Th:"springSide_section.svg",Jradius:"springSide_face.svg",Jneutral:"springSide_face.svg",Jmark:"springSide_face.svg"},sim:{tMax:180,tStep:.5,tUpdate:500}};function rn(c,t,r=""){const o=ae(ds.partName+r);o.logstr+=`${o.partName} simTime: ${c}
`;try{let d=function(y){return Mt(0,0).addCornerRounded(dt).addSegStrokeR(y,0).addCornerRounded(dt).addSegStrokeR(0,t.shEy).addCornerRounded(dt).addSegStrokeR(-y,0).addCornerRounded(dt).closeSegStroke()},h=function(y,C,P){const Z=C===0?xt:Ft,D=C===0?W:F,ot=y-_-t.H1,Wt=ot<0?D:D-2*ot*Z,St=D/2-Wt/2+t.smExS,yt=P%2===0?t.sNx+1:t.sNx,$t=(Wt-2*t.smExS+t.smEx)/(t.sNx+1)-t.smEx,lt=$t/2-t.smEx/2,Lt=P%2===0?lt:$t;if(Lt<2*dt)throw`err228: lxAZ ${n(Lt)} is too small compare to ${t.sNx} or ${t.smEx}`;return[St,Lt,$t,yt]},f=function(y,C,P,Z,D,ot,Wt){const St=Wt?Nt:et,yt=Wt?Pt:E,$t=ye(0,_);return D>0&&$t.addSegStrokeR(D,0),$t.startJunction(P,de.eB,ie.eABRight).addSegStrokeR(W,0),D>0&&$t.addSegStrokeR(D,0),Wt?$t.startJunction(y,de.eA,ie.eABLeft):ot&&$t.startJunction(C,de.eB,ie.eABRight),$t.addSegStrokeR(0,t.H1).addSegStrokeR(-St,yt).addPointA(D+Z/2,ht+_).addPointA(St,t.H1+yt+_).addSegArc2().addSegStrokeR(-St,-yt),Wt?ot&&$t.startJunction(C,de.eB,ie.eABRight):$t.startJunction(y,de.eA,ie.eABLeft),$t.closeSegStroke(),$t};var s=d,i=h,l=f;const a=Math.PI/2,b=t.Jneutral/100,g=t.Jradius,S=t.Jmark,_=g+(1-b)*t.Th,x=t.D5/2,A=2*Math.PI/t.N5,R=A/2,v=(t.W2+t.Th)/2,T=x-v,k=2*T*Math.tan(R),m=2*(x+v)*Math.tan(R),O=g*Math.tan(R),W=k-2*O,F=m-2*O,ct=t.W2+2*t.Th-2*_,u=ct/2,I=(F-W)/2,J=ct/8,G=2*J,X=W/2,Ht=F/2,Q=t.D1/2,ht=t.H1+t.H2+t.R2,vt=Math.atan2(t.H2,X),gt=Math.sqrt(X**2+t.H2**2);if(t.R2>gt)throw`err141: R2 ${t.R2} is too large comapre to lAC ${n(gt)} mm`;const ft=Math.asin(t.R2/gt),st=gt*Math.cos(ft),et=st*Math.cos(vt+ft),E=st*Math.sin(vt+ft),xt=et/E,K=Math.atan2(t.H2,Ht),ut=Math.sqrt(Ht**2+t.H2**2),nt=Math.asin(t.R2/ut),tt=ut*Math.cos(nt),Nt=tt*Math.cos(K+nt),Pt=tt*Math.sin(K+nt),Ft=Nt/Pt,V=t.H1+t.H2-Q-t.E1-t.E2,it=t.smEy+t.shEy,wt=Math.floor((V+t.smEy)/it),dt=t.shEy*t.shPr/200;if(Q<.1)throw`err087: R1 ${n(Q)} is too small because of D1 ${t.D1}`;if(T<.1)throw`err168: R5 ${n(x)} is too small compare to W2 ${n(v)} or Th ${t.Th} mm`;if(W<.1)throw`err171: Li ${n(W)} is too small because of aJr ${g} mm`;if(ct<.1)throw`err174: W1 ${n(ct)} is too small because of Hfoot ${n(_)} mm`;if(t.spring===1&&V<.1)throw`err189: sHeight ${n(V)} is too small because of E1 ${t.E1} or E2 ${t.E2}`;o.logstr+=`Bearing holder wall: Hwall ${n(ht)}, Hfoot ${n(_)} mm
`,o.logstr+=`Width of one unit interior: Lii ${n(k)}, Li ${n(W)} mm
`,o.logstr+=`Width of one unit exterior: Lee ${n(m)}, Le ${n(F)} mm
`,o.logstr+=`Ratio R2/Li ${n(100*t.R2/X)} %
`,o.logstr+=`Width of bottom: W1 ${n(ct)}, D3 ${n(G)} mm
`,t.spring===1?o.logstr+=`spring: sNy ${wt}, sRc ${n(dt)} mm
`:o.logstr+=`No spring
`;const Y=[],rt=[];if(t.spring===1)for(let y=0;y<wt;y++){const C=_+t.E1+y*it,P=C+t.shEy/2,[Z,D,ot,Wt]=h(P,0,y),[St,yt,$t]=h(P,1,y);let lt=Z,Lt=St;Y.push(d(D).translate(lt,C)),rt.push(d(yt).translate(Lt,C)),lt+=D+t.smEx,Lt+=yt+t.smEx;for(let qt=0;qt<Wt-1;qt++)Y.push(d(ot).translate(lt,C)),rt.push(d($t).translate(Lt,C)),lt+=ot+t.smEx,Lt+=$t+t.smEx;Y.push(d(D).translate(lt,C)),rt.push(d(yt).translate(Lt,C))}const p=z(X,_+t.H1+t.H2,Q),at=z(Ht,_+t.H1+t.H2,Q),kt=ye(0,0).startJunction("Jbi0",de.eA,ie.eABLeft).addSegStrokeR(W,0).addSegStrokeR(0,ct).startJunction("Jbe0",de.eA,ie.eABLeft).addSegStrokeR(-W,0).closeSegStroke(),Ot=[];Ot.push(z(G,G,J)),Ot.push(z(W-G,G,J)),Ot.push(z(G,ct-G,J)),Ot.push(z(W-G,ct-G,J));const It=ve([kt,...Ot]),w=[],Dt={};for(let y=0;y<t.N5;y++){const C=y<t.N5-1,P=f(`Ji${y}`,`Ji${y+1}`,`Jbi${y}`,W,0,C,!1);if(w.push(ve([P,p,...Y])),Dt[`Ji${y}`]={angle:-A,radius:g,neutral:b,mark:S},Dt[`Jbi${y}`]={angle:a,radius:g,neutral:b,mark:S},y>0){const Z=ye(0,0).startJunction(`Jbi${y}`,de.eA,ie.eABLeft).addSegStrokeR(W,0).addSegStrokeR(0,u).addSegStrokeR(-W,0).closeSegStroke(),D=[];D.push(z(G,G,J)),D.push(z(W-G,G,J)),w.push(ve([Z,...D]))}}const B=[],bt={};for(let y=0;y<t.N5;y++){const C=y<t.N5-1,P=f(`Je${y}`,`Je${y+1}`,`Jbe${y}`,W,I,C,!0);if(B.push(ve([P,at,...rt])),bt[`Je${y}`]={angle:A,radius:g,neutral:b,mark:S},bt[`Jbe${y}`]={angle:a,radius:g,neutral:b,mark:S},y>0){const Z=ye(0,0).addSegStrokeR(W,0).addSegStrokeR(0,u).startJunction(`Jbe${y}`,de.eA,ie.eABLeft).addSegStrokeR(-W,0).closeSegStroke(),D=[];D.push(z(G,G,J)),D.push(z(W-G,G,J)),B.push(ve([Z,...D]))}}const L=[],Gt=[];for(let y=1;y<t.N5;y++)L.push(`Ji${y}`,W),Gt.push(`Je${y}`,F);const Vt=t.Th+t.W2,q=vo([It,...w,...B],{Jbi0:{angle:a,radius:g,neutral:b,mark:S},Jbe0:{angle:a,radius:g,neutral:b,mark:S},...Dt,...bt},[{x1:0,y1:Vt,a1:0,l1:ct,ante:["Jbi0",ht],post:["Jbe0",ht]},{x1:-I,y1:0,a1:0,l1:F,ante:["Je0"],post:Gt},{x1:0,y1:-Vt,a1:0,l1:W,ante:["Ji0"],post:L}],t.Th,o.partName),H=q.makeFigures();for(const y of Object.keys(H))o.fig[y]=H[y];o.vol=q.makeVolume(),o.sub={},o.logstr+=`springSide drawn successfully!
`,o.calcErr=!1}catch(d){o.logstr+=d,console.log(d)}return o}var ln={pTitle:"springSide",pDescription:"bearing-holder on the side of a ring",pDef:ds,pGeom:rn},is={partName:"springInt",params:[e("D5","mm",140,10,5e3,1),e("N5","unit",8,3,100,1),e("W2","mm",20,1,200,1),Tt("One unit"),e("D1","mm",16,1,100,.1),e("H1","mm",5,1,100,1),e("H2","mm",15,1,100,1),e("R2","mm",15,1,100,1),Tt("Spring zone"),Te("spring",!0),e("E1","mm",2,1,100,1),e("E2","mm",2,1,100,1),e("smEy","mm",1,.1,10,.1),e("shEy","mm",1,.1,10,.1),e("shPr","%",90,0,99,1),e("sNx","xHoles",2,2,200,1),e("smEx","mm",1,.1,10,.1),e("smExS","mm",.5,.1,10,.1),Tt("Folding"),e("Th","mm",1,.1,10,.1),e("Jangle","degree",90,0,120,1),e("Jradius","mm",2,.1,10,.1),e("Jneutral","%",50,0,100,1),e("Jmark","mm",1,.1,10,.1)],paramSvg:{D5:"springInt_global.svg",N5:"springInt_global.svg",W2:"springInt_global.svg",D1:"springInt_face.svg",H1:"springInt_face.svg",H2:"springInt_face.svg",R2:"springInt_face.svg",spring:"springInt_spring.svg",E1:"springInt_face.svg",E2:"springInt_face.svg",smEy:"springInt_spring.svg",shEy:"springInt_spring.svg",shPr:"springInt_spring.svg",sNx:"springInt_spring.svg",smEx:"springInt_spring.svg",smExS:"springInt_spring.svg",Th:"springInt_section.svg",Jangle:"springInt_face.svg",Jradius:"springInt_face.svg",Jneutral:"springInt_face.svg",Jmark:"springInt_face.svg"},sim:{tMax:180,tStep:.5,tUpdate:500}};function gn(c,t,r=""){const o=ae(is.partName+r);o.logstr+=`${o.partName} simTime: ${c}
`;try{let h=function(V){return Mt(0,0).addCornerRounded(xt).addSegStrokeR(V,0).addCornerRounded(xt).addSegStrokeR(0,t.shEy).addCornerRounded(xt).addSegStrokeR(-V,0).addCornerRounded(xt).closeSegStroke()},f=function(V,it){const wt=ft,dt=W,Y=V-A-t.H1,rt=Y<0?dt:dt-2*Y*wt,p=dt/2-rt/2+t.smExS,at=it%2===0?t.sNx+1:t.sNx,kt=(rt-2*t.smExS+t.smEx)/(t.sNx+1)-t.smEx,Ot=kt/2-t.smEx/2,It=it%2===0?Ot:kt;if(It<2*xt)throw`err228: lxAZ ${n(It)} is too small compare to ${t.sNx} or ${t.smEx}`;return[p,It,kt,at]},a=function(V){const it=vt,wt=gt;return ye(0,A).startJunction(V,de.eB,ie.eABRight).addSegStrokeR(W,0).addSegStrokeR(0,t.H1).addSegStrokeR(-it,wt).addPointA(W/2,G+A).addPointA(it,t.H1+wt+A).addSegArc2().addSegStrokeR(-it,-wt).closeSegStroke()},b=function(V,it,wt,dt,Y){const rt=ye(0,0).startJunction(wt,de.eA,ie.eABLeft).addSegStrokeR(W,0).startJunction(V,de.eA,ie.eABLeft).addSegStrokeR(0,F).startJunction(dt,de.eA,ie.eABLeft).addSegStrokeR(-W,0);Y&&rt.startJunction(it,de.eB,ie.eABRight),rt.closeSegStroke();const p=[];return p.push(z(u,u,ct)),p.push(z(W-u,u,ct)),p.push(z(u,F-u,ct)),p.push(z(W-u,F-u,ct)),ve([rt,...p])};var s=h,i=f,l=a,d=b;const g=we(t.Jangle),S=t.Jneutral/100,_=t.Jradius,x=t.Jmark,A=_+(1-S)*t.Th,v=t.D5/2-(A+t.H1+t.H2),T=2*Math.PI/t.N5,k=T/2,m=2*v*Math.tan(k),O=_*Math.tan(k),W=m-2*O,F=t.W2+2*t.Th-2*A,ct=F/8,u=2*ct,I=W/2,J=t.D1/2,G=t.H1+t.H2+t.R2,X=Math.atan2(t.H2,I),Ht=Math.sqrt(I**2+t.H2**2);if(t.R2>Ht)throw`err141: R2 ${t.R2} is too large comapre to lAC ${n(Ht)} mm`;const Q=Math.asin(t.R2/Ht),ht=Ht*Math.cos(Q),vt=ht*Math.cos(X+Q),gt=ht*Math.sin(X+Q),ft=vt/gt,st=t.H1+t.H2-J-t.E1-t.E2,et=t.smEy+t.shEy,E=Math.floor((st+t.smEy)/et),xt=t.shEy*t.shPr/200;if(J<.1)throw`err087: R1 ${n(J)} is too small because of D1 ${t.D1}`;if(t.R2<J+.1)throw`err150: R2 ${n(t.R2)} is too small compare to R1 ${J} mm`;if(v<_)throw`err154: R5b ${n(v)} is too small because of H2 ${t.D2}, H1 ${t.H1} or Hfoot ${n(A)}`;if(W<.1)throw`err158: Li ${n(W)} is too small because of aJr ${n(_)} radian`;if(F<.1)throw`err161: W1 ${n(F)} is too small because of Hfoot ${n(A)} mm`;if(W<3*u)throw`err166: D3 ${n(u)} is too large compare to Li ${n(W)} mm`;if(t.spring===1&&st<.1)throw`err189: sHeight ${n(st)} is too small because of E1 ${t.E1} or E2 ${t.E2}`;o.logstr+=`Bearing holder wall: Hwall ${n(G)}, Hfoot ${n(A)} mm
`,o.logstr+=`Width of one unit: Lii ${n(m)}, Li ${n(W)} mm
`,o.logstr+=`Ratio R2/Li ${n(100*t.R2/I)} %
`,o.logstr+=`Width of bottom: W1 ${n(F)}, D3 ${n(u)} mm
`,t.spring===1?o.logstr+=`spring: sNy ${E}, sRc ${n(xt)} mm
`:o.logstr+=`No spring
`;const K=[];if(t.spring===1)for(let V=0;V<E;V++){const it=A+t.E1+V*et,wt=it+t.shEy/2,[dt,Y,rt,p]=f(wt,V);let at=dt;K.push(h(Y).translate(at,it)),at+=Y+t.smEx;for(let kt=0;kt<p-1;kt++)K.push(h(rt).translate(at,it)),at+=rt+t.smEx;K.push(h(Y).translate(at,it))}const ut=z(I,A+t.H1+t.H2,J),nt=[],tt={};for(let V=0;V<t.N5;V++){const it=V<t.N5-1;nt.push(b(`Jb${V}`,`Jb${V+1}`,`Jl${V}`,`Jr${V}`,it));const wt=a(`Jl${V}`),dt=a(`Jr${V}`);nt.push(ve([wt,ut,...K])),nt.push(ve([dt,ut,...K])),tt[`Jb${V}`]={angle:-T,radius:_,neutral:S,mark:x},tt[`Jl${V}`]={angle:g,radius:_,neutral:S,mark:x},tt[`Jr${V}`]={angle:g,radius:_,neutral:S,mark:x}}const Nt=[];for(let V=1;V<t.N5;V++)Nt.push(`Jb${V}`,W);const Pt=vo([...nt],{...tt},[{x1:0,y1:0,a1:0,l1:F,ante:["Jl0",G],post:["Jr0",G]},{x1:0,y1:-t.Th-t.W2,a1:0,l1:W,ante:["Jb0"],post:Nt}],t.Th,o.partName),Ft=Pt.makeFigures();for(const V of Object.keys(Ft))o.fig[V]=Ft[V];o.vol=Pt.makeVolume(),o.sub={},o.logstr+=`springInt drawn successfully!
`,o.calcErr=!1}catch(h){o.logstr+=h,console.log(h)}return o}var an={pTitle:"springInt",pDescription:"bearing-holder in the interior of a ring",pDef:is,pGeom:gn},rs={partName:"heliostat",params:[e("L1","mm",4e3,1e3,2e4,1),e("D1","mm",1e3,100,4e3,1),e("D3","mm",600,100,2e3,1),e("L9","mm",8e3,1e3,2e4,1),Tt("Bottom details"),e("E1","mm",10,1,100,1),e("E2","mm",10,1,100,1),e("E3","mm",10,1,100,1),e("S1","mm",100,1,500,1),e("S3","mm",100,1,500,1),Tt("Fixation"),e("N2","holes",24,1,500,1),e("D2","mm",40,1,400,1),e("W1","mm",20,1,400,1),Tt("Door"),e("H1H","mm",1500,100,3e3,1),e("H1W","mm",600,100,1e3,1),e("H1P","mm",300,100,2e3,1),Tt("Junction"),e("Z3","mm",200,1,500,1),e("Z4","mm",200,1,500,1),We("gen3D",["Both","Top","Bottom"]),Tt("Top-trunk"),e("L4","mm",2e3,100,2e4,1),e("E4","mm",10,1,100,1),e("E5","mm",10,1,100,1),e("H6","mm",600,100,2e3,1),e("E7","mm",10,1,100,1),e("D7","mm",200,10,2e3,1),Tt("Top-branch"),e("E6","mm",10,1,100,1),e("D6","mm",400,100,2e3,1),e("W8","mm",300,100,2e3,1),e("L8","mm",2e3,100,2e4,1),e("H8","mm",1e3,100,3e3,1),e("G8","mm",500,100,2e3,1),e("F8","mm",200,10,1e3,1),e("a8","degre",140,30,200,1),Tt("Top-diagonal"),e("D4","mm",300,10,2e3,1),e("EE4","mm",10,1,100,1),e("R4v","mm",400,10,5e3,1),e("R4h","mm",400,10,5e3,1)],paramSvg:{L1:"heliostat_bottom.svg",D1:"heliostat_bottom.svg",D3:"heliostat_bottom.svg",L9:"heliostat_junction.svg",E1:"heliostat_bottom.svg",E2:"heliostat_bottom.svg",E3:"heliostat_bottom.svg",S1:"heliostat_bottom.svg",S3:"heliostat_bottom.svg",N2:"heliostat_fixation.svg",D2:"heliostat_fixation.svg",W1:"heliostat_fixation.svg",H1H:"heliostat_bottom.svg",H1W:"heliostat_bottom.svg",H1P:"heliostat_bottom.svg",Z3:"heliostat_junction.svg",Z4:"heliostat_junction.svg",gen3D:"heliostat_junction.svg",L4:"heliostat_top.svg",E4:"heliostat_top.svg",E5:"heliostat_top.svg",E6:"heliostat_top.svg",D6:"heliostat_top.svg",H6:"heliostat_top.svg",E7:"heliostat_top.svg",D7:"heliostat_top.svg",W8:"heliostat_top.svg",L8:"heliostat_top.svg",H8:"heliostat_hand.svg",G8:"heliostat_hand.svg",F8:"heliostat_hand.svg",a8:"heliostat_hand.svg",D4:"heliostat_top.svg",EE4:"heliostat_top.svg",R4v:"heliostat_top.svg",R4h:"heliostat_top.svg"},sim:{tMax:180,tStep:.5,tUpdate:500}};function hn(c,t,r=""){const o=ae(rs.partName+r),s=U(),i=U(),l=U(),d=U(),h=U(),f=U(),a=U(),b=U(),g=U(),S=U(),_=U();o.logstr+=`${o.partName} simTime: ${c}
`;try{let T=function($){return Mt($*u,0).addSegStrokeR(0,t.E1).addSegStrokeR($*(I-u),J).addSegStrokeR(-$*gt,0).addSegStrokeR(0,-t.E3).addSegStrokeR($*t.S3,0).addSegStrokeA($*(u-X),t.E1).addSegStrokeR(0,-t.E1).closeSegStroke()},k=function($){return Mt(-$*V,it).addSegStrokeR($*Ft,0).addSegStrokeR($*(Pt-tt),t.L4).addSegStrokeR($*(tt-ft),0).addSegStrokeR(0,t.E5).addSegStrokeR($*(ft-Nt),0).addSegStrokeR($*(Nt-wt),t.H6).addSegStrokeR($*(wt-Y),0).addSegStrokeR(0,t.E7).addSegStrokeR($*(Y-dt),0).closeSegStroke()},m=function($,Ct,se){return M($-Ct,it,2*Ct,St).rotate($,it,se)},O=function($){return Mt(-$*Pt,it).addSegStrokeR($*(Pt-tt),t.L4).addSegStrokeR($*tt,0).addSegStrokeR(0,-t.L4-2*t.D6).addSegStrokeR(-$*Pt,0).closeSegStroke()};var x=T,A=k,R=m,v=O;const W=Math.PI/2,F=t.H1W/2,ct=t.H1H-2*F,u=t.D1/2,I=t.D3/2,J=t.L1-t.E1,G=Math.atan2(J,u-I),X=t.E2/Math.cos(W-G),Ht=t.S1+X,Q=u-Ht,ht=u-X,vt=t.E3/Math.tan(G),gt=t.S3+X-vt,ft=I-gt,st=t.D2/2,et=Q+t.W1+st,E=2*Math.PI/t.N2,xt=t.Z3/Math.tan(G),K=gt+t.Z4-xt,ut=K-t.E5/Math.tan(G),nt=t.L4/Math.tan(G),tt=ft+K,Nt=ft+ut,Pt=tt+nt,Ft=t.E4/Math.sin(G),V=Pt+Ft,it=t.L1+t.Z3-t.L4,wt=Nt-t.H6/Math.tan(G),dt=wt-t.E7/Math.tan(G)+Ft,Y=t.D7/2,rt=t.gen3D!==2,p=t.gen3D!==1,at=t.D6/2,kt=at-t.E6,Ot=t.L1+t.Z3+t.E5+t.H6/2,It=t.L9/2,w=t.L4+t.E5+t.H6/2,Dt=w-at,B=Dt/Math.sin(G),L=It-(V-Dt/Math.tan(G))-t.R4h,Gt=B-t.R4v,[Vt,q]=Ue(L,G,Gt),[H,y]=Xe(L,Gt,Vt);o.logstr+=q+y;const C=W-H,P=Dt/Math.tan(H),Z=t.D4/2,D=Z-t.EE4,ot=Z/Math.cos(C),Wt=-It+t.R4h+P+ot,St=w/Math.cos(C),yt=t.G8/2,$t=yt+t.F8,lt=we(t.a8)/2,Lt=Ot+t.H8,[qt,Xt]=Ue(t.H8,lt,$t),[Zt,Et]=Xe(t.H8,$t,qt);o.logstr+=Xt+Et;const mt=Math.acos(at/qt),Ut=Zt+mt,Kt=Math.min(W,Ut),zt=t.L8/2,ne=[-It,-zt-t.W8,zt,It-t.W8];if(u<I)throw`err176: D1 ${n(t.D1)} is too small compare to D3 ${n(t.D3)} mm`;if(Q<.1)throw`err183: R1b ${n(Q)} is too small because of ${n(t.E2)} or ${n(t.S1)} mm`;if(t.S1<2*(t.W1+st))throw`err142: S1 ${n(t.S1)} is too small compare to W1 ${n(t.W1)} and D2 ${n(2*st)} mm`;if(ct<.1)throw`err167: H1H ${n(t.H1H)} is too small compare to H1W ${n(t.H1W)} mm`;if(t.Z4<xt)throw`err154: Z4 ${n(t.Z4)} is too small compare to d5b ${n(xt)} mm`;if(wt<Y)throw`err169: R7b ${n(2*wt)} is too small because to D7 ${n(2*Y)} mm`;if(kt<.1)throw`err185: R6i ${n(kt)} is too small because to E6 ${n(t.E6)} mm`;if(t.H6<t.D6)throw`err200: H6 ${n(t.H6)} is too small compare to D6 ${n(t.D6)} mm`;o.logstr+=`Cone inclination ${n(Qt(G))}, diagonal ${n(Qt(C))} deg
`,o.logstr+=`Diameters: D1 ${n(2*u)}, D1b ${n(2*u)}, D3 ${n(2*I)}, D5 ${n(2*ft)} mm
`,o.logstr+=`TopPole: posY4 ${n(it)}, D4 ${n(2*V)} mm
`;const he=[];for(let $=0;$<t.N2;$++){const Ct=Jt(0,0).translatePolar($*E,et);he.push(z(Ct.cx,Ct.cy,st))}s.addMainOI([z(0,0,u),z(0,0,Q),...he]),s.addSecond(z(0,0,ht)),s.addSecond(z(0,0,I)),s.addSecond(z(0,0,ft)),i.addMainO(T(-1)),i.addSecond(T(1));const oe=Mt(F,t.H1P+F).addSegStrokeR(0,ct).addPointR(-F,F).addPointR(-2*F,0).addSegArc2().addSegStrokeR(0,-ct).addPointR(F,-F).addPointR(2*F,0).addSegArc2();l.addMainO(oe),l.addSecond(T(1)),l.addSecond(T(-1)),i.addSecond(oe),d.addMainO(k(1)),d.addSecond(k(-1)),d.addSecond(T(1)),d.addSecond(T(-1)),d.addSecond(oe),i.addSecond(k(-1)),i.addSecond(k(1));const re=z(0,Ot,at),fe=z(0,Ot,kt);h.addMainOI([re,fe]),h.addSecond(k(-1)),h.addSecond(k(1)),f.addMainO(fe),f.addSecond(re),f.addSecond(k(-1)),f.addSecond(k(1)),a.addMainOI([M(-It,Ot-at,2*It,2*at),M(-It,Ot-kt,2*It,2*kt)]),a.addSecond(k(-1)),a.addSecond(k(1)),a.addSecond(m(Wt,Z,C)),a.addSecond(m(Wt,D,C)),a.addSecond(m(-Wt,Z,-C)),a.addSecond(m(-Wt,D,-C));for(let $=0;$<4;$++)a.addSecond(M(ne[$],Ot,t.W8,t.H8));const $e=z(0,0,Z),ce=z(0,0,D);b.addMainOI([$e,ce]),g.addMainO(ce),g.addSecond($e),S.addMainO(O(1)),S.addSecond(k(1)),S.addSecond(k(-1));const ue=Jt(0,Lt).translatePolar(lt-W,$t),xe=Jt(0,Lt).translatePolar(lt-W,yt),Rt=Jt(0,Lt).translatePolar(-lt-W,yt),_e=Jt(0,Lt).translatePolar(-lt-W,$t),He=Jt(0,Ot).translatePolar(W+Kt,at),Le=Jt(0,Ot).translatePolar(W-Kt,at),pt=Mt(ue.cx,ue.cy).addSegStrokeA(xe.cx,xe.cy).addPointA(0,Lt-yt).addPointA(Rt.cx,Rt.cy).addSegArc2().addSegStrokeA(_e.cx,_e.cy).addSegStrokeA(He.cx,He.cy).addPointA(0,Ot+at).addPointA(Le.cx,Le.cy).addSegArc2().closeSegStroke();_.addMainO(pt),_.addSecond(z(0,Ot,at)),_.addSecond(z(0,Ot,kt)),_.addSecond(z(0,Lt,yt)),_.addSecond(z(0,Lt,$t)),_.addSecond(k(1)),_.addSecond(k(-1)),o.fig={faceBottomPole:i,faceDoor:l,faceBottomDisc:s,faceTopPole:d,faceHorizPole:h,faceHorizPoleInt:f,faceDiag3:a,faceDiagE:b,faceDiagI:g,faceCleanDiag:S,faceHand:_};const At=o.partName,Pe=[];rt&&Pe.push(`ipax_${At}_topPart`),p&&Pe.push(`ipax_${At}_bottomPart`),o.vol={extrudes:[{outName:`subpax_${At}_bottomPole`,face:`${At}_faceBottomPole`,extrudeMethod:j.eRotate,rotate:[0,0,0],translate:[0,0,0]},{outName:`subpax_${At}_door`,face:`${At}_faceDoor`,extrudeMethod:j.eLinearOrtho,length:2*u,rotate:[W,0,0],translate:[0,0,0]},{outName:`subpax_${At}_bottomDisc`,face:`${At}_faceBottomDisc`,extrudeMethod:j.eLinearOrtho,length:t.E1,rotate:[0,0,0],translate:[0,0,0]},{outName:`subpax_${At}_topPole`,face:`${At}_faceTopPole`,extrudeMethod:j.eRotate,rotate:[0,0,0],translate:[0,0,0]},{outName:`subpax_${At}_horizPole`,face:`${At}_faceHorizPole`,extrudeMethod:j.eLinearOrtho,length:t.L9,rotate:[W,0,0],translate:[0,It,0]},{outName:`subpax_${At}_horizPoleInt`,face:`${At}_faceHorizPoleInt`,extrudeMethod:j.eLinearOrtho,length:t.L9,rotate:[W,0,0],translate:[0,It,0]},{outName:`subpax_${At}_diag1e`,face:`${At}_faceDiagE`,extrudeMethod:j.eLinearOrtho,length:St,rotate:[C,0,0],translate:[0,Wt,it]},{outName:`subpax_${At}_diag1i`,face:`${At}_faceDiagI`,extrudeMethod:j.eLinearOrtho,length:St,rotate:[C,0,0],translate:[0,Wt,it]},{outName:`subpax_${At}_diag2e`,face:`${At}_faceDiagE`,extrudeMethod:j.eLinearOrtho,length:St,rotate:[-C,0,0],translate:[0,-Wt,it]},{outName:`subpax_${At}_diag2i`,face:`${At}_faceDiagI`,extrudeMethod:j.eLinearOrtho,length:St,rotate:[-C,0,0],translate:[0,-Wt,it]},{outName:`subpax_${At}_cleanDiag`,face:`${At}_faceCleanDiag`,extrudeMethod:j.eRotate,rotate:[0,0,0],translate:[0,0,0]},{outName:`subpax_${At}_hand1`,face:`${At}_faceHand`,extrudeMethod:j.eLinearOrtho,length:t.W8,rotate:[W,0,0],translate:[0,ne[0]+t.W8,0]},{outName:`subpax_${At}_hand2`,face:`${At}_faceHand`,extrudeMethod:j.eLinearOrtho,length:t.W8,rotate:[W,0,0],translate:[0,ne[1]+t.W8,0]},{outName:`subpax_${At}_hand3`,face:`${At}_faceHand`,extrudeMethod:j.eLinearOrtho,length:t.W8,rotate:[W,0,0],translate:[0,ne[2]+t.W8,0]},{outName:`subpax_${At}_hand4`,face:`${At}_faceHand`,extrudeMethod:j.eLinearOrtho,length:t.W8,rotate:[W,0,0],translate:[0,ne[3]+t.W8,0]}],volumes:[{outName:`ipax_${At}_bottomPolePlus`,boolMethod:ee.eUnion,inList:[`subpax_${At}_bottomDisc`,`subpax_${At}_bottomPole`]},{outName:`ipax_${At}_bottomPart`,boolMethod:ee.eSubstraction,inList:[`ipax_${At}_bottomPolePlus`,`subpax_${At}_door`]},{outName:`ipax_${At}_topPlus`,boolMethod:ee.eUnion,inList:[`subpax_${At}_topPole`,`subpax_${At}_horizPole`,`subpax_${At}_diag1e`,`subpax_${At}_diag2e`,`subpax_${At}_hand1`,`subpax_${At}_hand2`,`subpax_${At}_hand3`,`subpax_${At}_hand4`]},{outName:`ipax_${At}_topMinus`,boolMethod:ee.eUnion,inList:[`subpax_${At}_horizPoleInt`,`subpax_${At}_diag1i`,`subpax_${At}_diag2i`,`subpax_${At}_cleanDiag`]},{outName:`ipax_${At}_topPart`,boolMethod:ee.eSubstraction,inList:[`ipax_${At}_topPlus`,`ipax_${At}_topMinus`]},{outName:`pax_${At}`,boolMethod:ee.eUnion,inList:Pe}]},o.sub={},o.logstr+=`heliostat drawn successfully!
`,o.calcErr=!1}catch(T){o.logstr+=T,console.log(T)}return o}var fn={pTitle:"heliostat",pDescription:"the structure of an heliostat",pDef:rs,pGeom:hn},ls={partName:"minifoot",params:[e("D1","mm",31,2,500,.1),e("D3","mm",30,2,500,1),e("D4","mm",200,2,500,1),e("D5","mm",3,0,100,1),e("N1","foot",5,0,12,1),Tt("Heights and details"),e("S1","mm",1,.1,5,.1),e("S5","mm",2,1,20,1),e("R3","mm",10,0,100,1),e("H1","mm",2,.1,10,.1),e("H2","mm",40,0,100,1)],paramSvg:{D1:"minifoot_top.svg",D3:"minifoot_top.svg",D4:"minifoot_top.svg",D5:"minifoot_top.svg",N1:"minifoot_top.svg",S1:"minifoot_side.svg",S5:"minifoot_top.svg",R3:"minifoot_top.svg",H1:"minifoot_side.svg",H2:"minifoot_side.svg"},sim:{tMax:180,tStep:.5,tUpdate:500}};function un(c,t,r=""){const o=ae(ls.partName+r),s=U(),i=U();o.logstr+=`${o.partName} simTime: ${c}
`;try{let h=function(){const tt=Mt(g,0);for(let Nt=0;Nt<t.N1;Nt++){const Pt=Nt*A*2;tt.addCornerRounded(t.R3).addSegStrokeAP(Pt+A-ct,W).addPointAP(Pt+A,S+x).addPointAP(Pt+A+ct,W).addSegArc2().addSegStrokeAP(Pt+2*A,g)}return tt},f=function(){const tt=A-st,Nt=Jt(0,0).translatePolar(tt,g),Pt=Mt(Nt.cx,Nt.cy);for(let Ft=0;Ft<t.N1;Ft++){const V=Ft*A*2+tt;Pt.addSegStrokeAP(V+gt,X).addPointAP(V+st,S+x).addPointAP(V+st+Q,X).addSegArc2().addSegStrokeAP(V+2*st,g).addPointAP(V+A+st,g).addPointAP(V+2*A,g).addSegArc2()}return Pt};var l=h,d=f;const a=t.D1/2,b=a+t.S1,g=t.D3/2,S=t.D4/2,_=t.D5/2,x=_+t.S5,A=t.N1>0?Math.PI/t.N1:1,[R,v]=Ue(g,A,S),T=Math.acos(x/R),[k,m]=Xe(R,g,S),O=k+T,[W,F]=Ue(S,O,x),[ct,u]=Xe(W,x,S);o.logstr+=v+m+F+u;const I=g-x,J=Math.asin(I/S),G=Math.PI/2+J,[X,Ht]=Ue(S,G,x),[Q,ht]=Xe(S,x,X),vt=Math.sqrt(S**2-I**2),[gt,ft]=Xe(X,vt,g),st=Q+gt;o.logstr+=Ht+ht+ft;const et=t.N1>2||t.N1===2&&st>Math.PI/2-.001;if(S<g)throw`err101: D4 ${t.D4} is too small compare to D3 ${t.D3}`;o.logstr+=`aCAD ${n(Qt(O))}, aDCA ${n(Qt(ct))} degree
`,o.logstr+=`selFoot: ${et?"ctrFoot3":"ctrFoot2"}
`;let E=z(0,0,g);t.N1>0&&(et?E=h():E=f());const xt=z(0,0,a),K=z(0,0,b),ut=[];if(_>0)for(let tt=0;tt<t.N1;tt++){const Nt=tt*A*2+A,Pt=Jt(0,0).translatePolar(Nt,S);ut.push(z(Pt.cx,Pt.cy,_))}s.addMainOI([E,xt,...ut]),s.addSecond(K),i.addMainOI([K,xt]),i.addSecond(E),o.fig={faceFoot:s,faceCylinder:i};const nt=o.partName;o.vol={extrudes:[{outName:`subpax_${nt}_foot`,face:`${nt}_faceFoot`,extrudeMethod:j.eLinearOrtho,length:t.H1,rotate:[0,0,0],translate:[0,0,0]},{outName:`subpax_${nt}_cylinder`,face:`${nt}_faceCylinder`,extrudeMethod:j.eLinearOrtho,length:t.H1+t.H2,rotate:[0,0,0],translate:[0,0,0]}],volumes:[{outName:`pax_${nt}`,boolMethod:ee.eUnion,inList:[`subpax_${nt}_foot`,`subpax_${nt}_cylinder`]}]},o.sub={},o.logstr+=`minifoot drawn successfully!
`,o.calcErr=!1}catch(h){o.logstr+=h,console.log(h)}return o}var Sn={pTitle:"minifoot",pDescription:"holder of the heliostat model",pDef:ls,pGeom:un},gs={partName:"minihelio",params:[e("N1","mirror",3,1,20,1),e("W1","mm",100,5,2e3,1),e("W2","mm",5,1,200,1),e("H4","mm",30,1,2e3,1),e("H5","mm",10,1,2e3,1),e("H6","mm",70,5,2e3,1),e("H7","mm",10,1,2e3,1),e("H8","mm",32,1,2e3,1),e("D8","mm",3,1,50,1),Tt("Frame side"),e("T1","mm",1,.5,10,.1),e("T2","mm",1,.5,10,.1),e("W3","mm",50,1,500,1),e("W4","mm",10,1,500,1),e("W5","mm",30,1,500,1),e("HW3","mm",40,1,2e3,1),e("HW53","mm",60,1,2e3,1),Tt("Foot"),e("D1","mm",30,5,1e3,1),e("D2","mm",40,5,1e3,1),e("D3","mm",20,5,1e3,1),e("H1","mm",40,5,2e3,1),e("H2","mm",40,5,2e3,1),e("H3","mm",80,5,2e3,1),Tt("Mirror"),e("Wm","mm",60,5,2e3,1),e("Hm","mm",60,5,2e3,1),e("Tm","mm",1,.5,10,.1),e("Dm","mm",2,.1,50,.1),e("Sm","mm",5,1,200,1),e("Em","mm",1,.5,5,.1),Tt("Simulation"),e("aSunMin","degree",0,-10,120,1),e("aSunMax","degree",80,-10,120,1),e("aSolidSun","degree",.54,.1,1,.01),e("Lt","m",.5,.1,200,.1),e("Ht1","m",.2,.1,20,.1),e("Ht2","m",.1,.1,20,.1),Tt("3D parts"),Te("d3_foot",!0),Te("d3_frame",!0),Te("d3_mirrors",!1),Te("d3_one_mirror",!1)],paramSvg:{N1:"minihelio_front.svg",W1:"minihelio_front.svg",W2:"minihelio_front.svg",H4:"minihelio_front.svg",H5:"minihelio_front.svg",H6:"minihelio_front.svg",H7:"minihelio_front.svg",H8:"minihelio_front.svg",D8:"minihelio_front.svg",T1:"minihelio_side.svg",T2:"minihelio_side.svg",W3:"minihelio_side.svg",W4:"minihelio_side.svg",W5:"minihelio_side.svg",HW3:"minihelio_side.svg",HW53:"minihelio_side.svg",D1:"minihelio_front.svg",D2:"minihelio_front.svg",D3:"minihelio_front.svg",H1:"minihelio_front.svg",H2:"minihelio_front.svg",H3:"minihelio_front.svg",Wm:"minihelio_mirror.svg",Hm:"minihelio_mirror.svg",Tm:"minihelio_mirror.svg",Dm:"minihelio_mirror.svg",Sm:"minihelio_mirror.svg",Em:"minihelio_mirror.svg",aSunMin:"minihelio_side.svg",aSunMax:"minihelio_side.svg",aSolidSun:"minihelio_side.svg",Lt:"minihelio_side.svg",Ht1:"minihelio_side.svg",Ht2:"minihelio_side.svg",d3_foot:"minihelio_side.svg",d3_frame:"minihelio_side.svg",d3_mirrors:"minihelio_side.svg",d3_one_mirror:"minihelio_side.svg"},sim:{tMax:100,tStep:.5,tUpdate:500}};function _n(c,t,r=""){const o=ae(gs.partName+r),s=U(),i=U(),l=U(),d=U(),h=U(),f=U(),a=U(),b=U(),g=U();o.logstr+=`${o.partName} simTime: ${c}
`;try{let v=function(Et){return Mt(Et*I,0).addSegStrokeR(0,t.H1).addSegStrokeR(Et*ht,0).addSegStrokeR(0,t.H2).addSegStrokeR(-Et*vt,t.H3).addSegStrokeR(-Et*t.T1,0).addSegStrokeR(Et*vt,-t.H3).addSegStrokeR(0,-t.H2+t.T1).addSegStrokeR(-Et*ht,0).addSegStrokeR(0,-t.H1-t.T1).closeSegStroke()},T=function(Et){const mt=t.H4-Et,Ut=et-Et;return Mt(gt,ft+Et).addPointR(mt,mt).addSegArc(mt,!1,!0).addSegStrokeR(0,st).addPointR(-Ut,Ut).addPointR(-2*Ut,0).addSegArc2().addSegStrokeR(0,-st).addPointR(mt,-mt).addSegArc(mt,!1,!0).closeSegStroke()},k=function(Et,mt,Ut,Kt,zt,ne,he){const oe=he-zt,re=zt-oe,fe=ne*Math.cos(zt+Math.PI/2),$e=ne*Math.sin(zt+Math.PI/2),ce=Kt*Math.cos(zt),ue=Kt*Math.sin(zt),xe=-fe-ce+mt,Rt=$e+ue+Et-Ut,He=xe*Math.tan(re)+Rt,Le=100+10*(Et+Ut),pt=oe<Math.PI/2?He:Math.sign(oe)*Le,At=fe+ce,Pe=$e+ue;return[pt,At,Pe]},m=function(Et,mt,Ut,Kt,zt,ne,he,oe){const[re,fe,$e]=k(Et,mt,Ut,Kt,zt,ne,he),ce=Jt(fe,Et+$e),ue=ce.translatePolar(he,20*Kt),xe=Mt(ue.cx,ue.cy,oe).addSegStrokeA(ce.cx,ce.cy),Rt=2*(Et+Ut);return Math.abs(re)<Rt&&xe.addSegStrokeA(mt,Ut+re),xe},O=function(Et,mt,Ut,Kt,zt,ne){let he=ne/2,oe=0,[re,fe,$e]=k(Et,mt,Ut,Kt,he,zt,ne);for(;Math.abs(re)>.5&&oe<100;){const ce=Math.atan((Et+$e-Ut+re)/(mt-fe))-Math.atan((Et+$e-Ut)/(mt-fe)),ue=.5*Math.abs(ce);he-=Math.sign(re)*ue,oe+=1,[re,fe,$e]=k(Et,mt,Ut,Kt,he,zt,ne)}return[he,oe]};var S=v,_=T,x=k,A=m,R=O;const W=Math.PI/2,F=we(t.aSunMin),ct=we(t.aSunMax),u=F+c*(ct-F)/100,I=t.D1/2,J=t.D2/2,G=t.D3/2,X=t.D8/2,Ht=t.Dm/2,Q=Ht+t.Em,ht=J-I,vt=J-G,gt=t.W1/2-t.H4,ft=t.H1+t.H2+t.H3,st=t.H5+t.T2+t.N1*(t.H6+t.T2)+t.H7,et=t.W1/2,E=t.W1-2*t.T2,xt=E/2,K=ft+t.H4+t.H5,ut=t.H6+t.T2,nt=K+t.T2+t.H8,tt=nt-Ht,Nt=nt-t.Hm/2,Pt=(t.W1-t.Wm)/2,Ft=K+t.T2+t.N1*(t.H6+t.T2)+t.H7,V=t.H4-t.T2,it=t.H4+t.H5+t.T2+t.N1*(t.H6+t.T2)+t.H7+et,wt=it-2*t.T2,dt=(t.W3-t.W5)/2,Y=it-et-t.H4,rt=t.HW3-t.H4,p=Y-rt-t.HW53,at=t.Lt*1e3,kt=t.Ht1*1e3,Ot=t.Ht2*1e3,It=t.Hm/2-Q,w=t.Hm*t.Wm,Dt=t.N1*w,B=t.Hm/2,bt=we(t.aSolidSun)/2;if(ht<.1)throw`err134: D2 ${n(t.D2)} is too small compare to D1 ${n(t.D1)} mm`;if(vt<.1)throw`err139: D2 ${n(t.D2)} is too small compare to D3 ${n(t.D3)} mm`;if(t.H2<t.T1)throw`err142: H2 ${n(t.H2)} is too small compare to T1 ${n(t.T1)} mm`;if(gt<G)throw`err151: W1 ${n(t.W1)} is too small compare to H4 ${n(t.H4)} mm`;if(E<0)throw`err158: W1 ${n(t.W1)} is too small compare to T2 ${n(t.T2)} mm`;if(t.W3<t.D3)throw`err172: W3 ${n(t.W3)} is too small compare to D3 ${n(t.D3)} mm`;if(dt<.1)throw`err175: W3 ${n(t.W3)} is too small compare to W5 ${n(t.W5)} mm`;if(t.W5<t.W4+2*t.T2)throw`err178: W5 ${n(t.W5)} is too small compare to W4 ${n(t.W4)} mm`;if(rt<.1)throw`err182: HW3 ${n(t.HW3)} is too small compare to H4 ${n(t.H4)} mm`;if(p<.1)throw`err192: Hside2 ${n(p)} is too small because of HW3 ${n(t.HW3)} or HW53 ${n(t.HW53)} mm`;if(It<0)throw`err096: Hm ${n(t.Hm)} is too small compare to Dm ${n(t.Dm)} and Em ${n(t.Em)} mm`;if(t.Sm<Ht)throw`err099: Sm ${n(t.Sm)} is too small compare to Dm ${n(t.Dm)} mm`;if(t.D8<t.Dm)throw`err102: D8 ${n(t.D8)} is too small compare to Dm ${n(t.Dm)} mm`;o.logstr+=`Mirror surface: One: ${n(w)}, N: ${t.N1} : ${n(Dt)} mm2
`,o.logstr+=`Height: Foot: ${n(ft)}, Frame: ${n(it)}, Total : ${n(ft+it)} mm
`,o.logstr+=`aSun: ${n(Qt(u))} degree
`,s.addMainO(v(1)),s.addSecond(v(-1)),s.addSecond(T(0)),s.addSecond(T(t.T2)),s.addSecond(T(t.T2+t.W2)),i.addMainOI([T(t.T2),T(t.T2+t.W2)]),i.addSecond(T(0)),i.addSecond(v(1)),i.addSecond(v(-1)),f.mergeFigure(s,!0);for(let Et=0;Et<t.N1+1;Et++)f.addMainO(M(-E/2,K+Et*ut,E,t.T2));for(let Et=0;Et<t.N1;Et++)f.addSecond(M(-t.Wm/2,Nt+Et*ut,t.Wm,t.Hm)),f.addSecond(M(-t.W1/2,tt+Et*ut,Pt,t.Dm)),f.addSecond(M(t.Wm/2,tt+Et*ut,Pt,t.Dm));d.mergeFigure(f,!0);const L=Mt(-xt,Ft).addPointR(xt,xt).addPointR(2*xt,0).addSegArc2().addSegStrokeR(t.T2,0).addPointR(-et,et).addPointR(-2*et,0).addSegArc2().closeSegStroke();d.addMainO(L),l.mergeFigure(f,!0);const Gt=Mt(gt,ft).addPointR(t.H4,t.H4).addSegArc(t.H4,!1,!0).addSegStrokeR(-t.T2,0).addPointR(-V,-V).addSegArc(V,!1,!1).addSegStrokeR(-2*gt,0).addPointR(-V,V).addSegArc(V,!1,!1).addSegStrokeR(-t.T2,0).addPointR(t.H4,-t.H4).addSegArc(t.H4,!1,!0).closeSegStroke();l.addMainO(Gt),h.addSecond(v(1)),h.addSecond(v(-1)),h.addSecond(M(-t.W3/2,ft,t.W3,t.H4)),h.addSecond(M(-t.W3/2,ft,t.W3,t.T2)),h.addSecond(M(-t.W5/2,Ft,t.W5,et)),h.addSecond(M(-t.W5/2,Ft+et-t.T2,t.W5,t.T2)),h.addSecond(M(-t.W4/2-t.T2,ft+t.T2,t.T2,wt)),h.addSecond(M(t.W4/2,ft+t.T2,t.T2,wt));for(let Et=0;Et<t.N1+1;Et++)h.addSecond(M(-t.W4/2,K+Et*ut,t.W4,t.T2));const Vt=[];for(let Et=0;Et<t.N1;Et++)h.addSecond(z(0,nt+Et*ut,Ht)),Vt.push(z(0,nt+Et*ut,X));h.addSecond(M(at,kt,Ot*.05,Ot));const q=Mt(t.W3/2,ft+t.H4).addSegStrokeR(0,rt).addPointR(-dt,t.HW53).addSegArc3(-Math.PI/2,!1).addSegStrokeR(0,p).addSegStrokeR(-t.W5,0).addSegStrokeR(0,-p).addPointR(-dt,-t.HW53).addSegArc3(-Math.PI/2,!0).addSegStrokeR(0,-rt).closeSegStroke();h.addMainOI([q,...Vt]);const H=Mt(-Q,0).addPointR(Q,-Q).addPointR(2*Q,0).addSegArc2().addSegStrokeR(0,t.Sm).addSegStrokeR(It,0).addSegStrokeR(0,t.Tm).addSegStrokeR(-t.Hm,0).addSegStrokeR(0,-t.Tm).addSegStrokeR(It,0).closeSegStroke(),y=z(0,0,Ht);a.mergeFigure(h,!0),b.mergeFigure(h,!0),g.addMainOI([H,y]);let C=0,P=0,Z=Ot,D=-Ot,ot=0,Wt=Math.PI/2,St=-Math.PI/2;for(let Et=0;Et<t.N1;Et++){const mt=nt+Et*ut,Ut=kt+Ot/2,Kt=t.Sm+t.Tm,[zt,ne]=O(mt,at,Ut,Kt,0,u);h.addSecond(H.rotate(0,0,zt-Math.PI/2).translate(0,mt));const[he]=k(mt,at,Ut,Kt,zt,0,u),[oe]=k(mt,at,Ut,Kt,zt,B,u-bt),[re]=k(mt,at,Ut,Kt,zt,B,u+bt),[fe]=k(mt,at,Ut,Kt,zt,-B,u+bt),[$e]=k(mt,at,Ut,Kt,zt,-B,u-bt);h.addDynamics(m(mt,at,Ut,Kt,zt,0,u,"yellow")),h.addDynamics(m(mt,at,Ut,Kt,zt,B,u-bt,"red")),h.addDynamics(m(mt,at,Ut,Kt,zt,B,u+bt,"orange")),h.addDynamics(m(mt,at,Ut,Kt,zt,-B,u+bt,"red")),h.addDynamics(m(mt,at,Ut,Kt,zt,-B,u-bt,"orange"));const ce=2*B*Math.cos(u-zt),ue=re-$e,xe=oe-fe;o.logstr+=`Mirror ${Et+1}: yS ${n(he)} mm, ia ${n(Qt(zt))} degree, cycleCnt ${ne}, linear ${n(ce)} mm, target: ${n(ue)} ${n(xe)} mm ${n(100*ue/xe)} %
`,C+=ce,P=Math.max(P,oe),Z=Math.min(Z,re),D=Math.max(D,$e),ot=Math.min(ot,fe),Wt=Math.min(Wt,zt),St=Math.max(St,zt),a.addMainO(H.rotate(0,0,zt-Math.PI/2).translate(0,mt)),a.addSecond(y.translate(0,mt)),b.addMainO(y.translate(0,mt)),b.addSecond(H.rotate(0,0,zt-Math.PI/2).translate(0,mt))}o.logstr+=`mirror angles: min ${n(Qt(Wt))} max ${n(Qt(St))} diff ${n(Qt(St-Wt))} degree
`;const yt=Z-D,$t=P-ot;o.logstr+=`sunLinearAcc: ${n(C)} mm, target: ${n(yt)} ${n($t)} mm ${n(100*yt/$t)} %
`,o.logstr+=`sun concentration: ${n(100*C/$t)} %
`,o.logstr+=`target usage: bottom ${n(ot+Ot/2)} top ${n(Ot/2-P)} mm, ${n(100*$t/Ot)} %
`,o.fig={faceFoot:s,faceFrameBand:i,faceFrameTop:d,faceFrameBottom:l,faceFrameSide:h,faceFrameMid:f,faceMirrorSide:a,faceMirrorAxis:b,faceOneMirror:g};const lt=o.partName,Lt=[],qt=[],Xt=[],Zt=[];t.d3_foot===1&&Lt.push(`subpax_${lt}_foot`),t.d3_frame===1&&(qt.push(`subpax_${lt}_frameBand1`),qt.push(`subpax_${lt}_frameBand2`),qt.push(`subpax_${lt}_frameTop`),qt.push(`subpax_${lt}_frameBottom`),qt.push(`subpax_${lt}_frameMid`),qt.push(`subpax_${lt}_frameSide1`),qt.push(`subpax_${lt}_frameSide2`)),t.d3_mirrors===1&&(Xt.push(`subpax_${lt}_mirrorSide`),Xt.push(`subpax_${lt}_mirrorAxis`)),t.d3_one_mirror===1&&Zt.push(`subpax_${lt}_oneMirror`),o.vol={extrudes:[{outName:`subpax_${lt}_foot`,face:`${lt}_faceFoot`,extrudeMethod:j.eRotate,rotate:[0,0,0],translate:[0,0,0]},{outName:`subpax_${lt}_frameBand1`,face:`${lt}_faceFrameBand`,extrudeMethod:j.eLinearOrtho,length:t.T2,rotate:[W,0,0],translate:[0,-t.W4/2,0]},{outName:`subpax_${lt}_frameBand2`,face:`${lt}_faceFrameBand`,extrudeMethod:j.eLinearOrtho,length:t.T2,rotate:[W,0,0],translate:[0,t.W4/2+t.T2,0]},{outName:`subpax_${lt}_frameTop`,face:`${lt}_faceFrameTop`,extrudeMethod:j.eLinearOrtho,length:t.W5,rotate:[W,0,0],translate:[0,t.W5/2,0]},{outName:`subpax_${lt}_frameBottom`,face:`${lt}_faceFrameBottom`,extrudeMethod:j.eLinearOrtho,length:t.W3,rotate:[W,0,0],translate:[0,t.W3/2,0]},{outName:`subpax_${lt}_frameMid`,face:`${lt}_faceFrameMid`,extrudeMethod:j.eLinearOrtho,length:t.W4,rotate:[W,0,0],translate:[0,t.W4/2,0]},{outName:`subpax_${lt}_frameSide1`,face:`${lt}_faceFrameSide`,extrudeMethod:j.eLinearOrtho,length:t.T2,rotate:[W,0,W],translate:[xt,0,0]},{outName:`subpax_${lt}_frameSide2`,face:`${lt}_faceFrameSide`,extrudeMethod:j.eLinearOrtho,length:t.T2,rotate:[W,0,W],translate:[-xt-t.T2,0,0]},{outName:`subpax_${lt}_mirrorSide`,face:`${lt}_faceMirrorSide`,extrudeMethod:j.eLinearOrtho,length:t.Wm,rotate:[W,0,W],translate:[-t.Wm/2,0,0]},{outName:`subpax_${lt}_mirrorAxis`,face:`${lt}_faceMirrorAxis`,extrudeMethod:j.eLinearOrtho,length:t.W1,rotate:[W,0,W],translate:[-t.W1/2,0,0]},{outName:`subpax_${lt}_oneMirror`,face:`${lt}_faceOneMirror`,extrudeMethod:j.eLinearOrtho,length:t.Wm,rotate:[0,0,0],translate:[0,0,0]}],volumes:[{outName:`pax_${lt}`,boolMethod:ee.eUnion,inList:[...Lt,...qt,...Xt,...Zt]}]},o.sub={},o.logstr+=`minihelio drawn successfully!
`,o.calcErr=!1}catch(v){o.logstr+=v,console.log(v)}return o}var xn={pTitle:"minihelio",pDescription:"table-top model of an heliostat",pDef:gs,pGeom:_n},as={partName:"minimir",params:[e("L1","mm",50,10,2e3,1),e("G1","mm",50,10,2e3,1),e("G2","mm",5,1,500,1),e("G3","mm",5,1,500,1),Tt("Wheel"),e("D1","mm",1,0,200,.5),e("D2","mm",2,.5,200,.5),e("D3","mm",5,1,2e3,1),e("D4","mm",40,1,2e3,1),e("D5","mm",50,1,2e3,1),e("N1","arms",6,0,20,1),e("S1","mm",4,1,200,1),e("R6","mm",1,0,200,1),Tt("Frame"),e("W1","mm",5,1,200,1),e("W2","mm",5,1,200,1),e("W3","mm",5,1,200,1),e("R7","mm",5,0,200,1),e("R8","mm",5,0,200,1),Tt("Transversal and thickness"),e("S2","mm",2,1,50,1),e("S3","mm",10,1,200,1),e("T1","mm",1,1,50,1),e("T2","mm",2,1,200,1),e("T3","mm",1,1,50,1),Te("d3_rod",!0)],paramSvg:{L1:"minimir_top.svg",G1:"minimir_top.svg",G2:"minimir_top.svg",G3:"minimir_top.svg",D1:"minimir_wheel.svg",D2:"minimir_wheel.svg",D3:"minimir_wheel.svg",D4:"minimir_wheel.svg",D5:"minimir_wheel.svg",N1:"minimir_wheel.svg",S1:"minimir_wheel.svg",R6:"minimir_wheel.svg",W1:"minimir_top.svg",W2:"minimir_top.svg",W3:"minimir_top.svg",R7:"minimir_top.svg",R8:"minimir_top.svg",S2:"minimir_wheel.svg",S3:"minimir_wheel.svg",T1:"minimir_wheel.svg",T2:"minimir_wheel.svg",T3:"minimir_wheel.svg",d3_rod:"minimir_wheel.svg"},sim:{tMax:180,tStep:.5,tUpdate:500}};function $n(c,t,r=""){const o=ae(as.partName+r),s=U(),i=U(),l=U(),d=U(),h=U();o.logstr+=`${o.partName} simTime: ${c}
`;try{const f=Math.PI/2,a=t.D1/2,b=t.D2/2,g=t.D3/2,S=t.D4/2,_=t.D5/2,x=2*t.T1+2*t.G2+t.G1,A=x+2*t.G3,R=t.N1>0?Math.PI/t.N1:1,v=t.S1/2,T=t.S2/2,k=g,m=Math.asin(v/k),O=Math.asin(v/S),W=v/Math.sin(R),F=t.R6/Math.sin(R),u=Math.asin(t.R6/(W+F))>R-m,I=S-g,J=t.G1-2*t.W2,G=t.L1/2-t.W1/2-t.W3;if(t.D2<t.D1+.1)throw`err114: D2 ${t.D2} is too small compare to D1 ${t.D1}`;if(g<v)throw`err132: D3 ${t.D3} is too small compare to S1 ${t.S1}`;if(t.S1<t.S2)throw`err141: S1 ${t.S1} is too small compare to S2 ${t.S2}`;if(I<2*t.R6)throw`err145: l34 ${n(I)} is too small compare to R6 ${t.R6}`;if(I<t.S3)throw`err148: l34 ${n(I)} is too small compare to S3 ${t.S3}`;if(J<2*t.R8)throw`err153: lFI ${n(J)} is too small compare to R8 ${t.R8}`;if(G<2*t.R8)throw`err156: hFI ${n(G)} is too small compare to R8 ${t.R8}`;o.logstr+=`Lww: ${n(x)} mm, Laxis: ${n(A)} mm
`;const Ht=z(0,0,a),Q=z(0,0,b),ht=z(0,0,k),vt=z(0,0,S),gt=z(0,0,_),ft=[];for(let Nt=0;Nt<t.N1;Nt++){const Pt=Nt*2*R,Ft=Jt(0,0).translatePolar(Pt+O,S),V=Mt(Ft.cx,Ft.cy).addCornerRounded(t.R6).addPointAP(Pt+R,S).addPointAP(Pt+2*R-O,S).addSegArc2().addCornerRounded(t.R6);u?V.addSegStrokeAP(Pt+R,W).addCornerRounded(t.R6):V.addSegStrokeAP(Pt+2*R-m,k).addCornerRounded(t.R6).addPointAP(Pt+R,k).addPointAP(Pt+m,k).addSegArc2().addCornerRounded(t.R6),V.closeSegStroke(),ft.push(V)}s.addMainOI([gt,Q,...ft]),s.addSecond(vt),s.addSecond(ht),s.addSecond(Ht),i.addMainOI([Q,Ht]),i.mergeFigure(s,!0);const st=M(-S,-T,t.S3,t.S2),et=M(S-t.S3,-T,t.S3,t.S2);l.addMainO(st),l.addMainO(et),l.mergeFigure(s,!0),s.addSecond(st),s.addSecond(et);const E=Mt(-t.G1/2,-t.L1/2).addCornerRounded(t.R7).addSegStrokeR(t.G1,0).addCornerRounded(t.R7).addSegStrokeR(0,t.L1).addCornerRounded(t.R7).addSegStrokeR(-t.G1,0).addCornerRounded(t.R7).closeSegStroke(),xt=Mt(-t.G1/2+t.W2,-t.L1/2+t.W3).addCornerRounded(t.R8).addSegStrokeR(J,0).addCornerRounded(t.R8).addSegStrokeR(0,G).addCornerRounded(t.R8).addSegStrokeR(-J,0).addCornerRounded(t.R8).closeSegStroke(),K=Mt(-t.G1/2+t.W2,t.W1/2).addCornerRounded(t.R8).addSegStrokeR(J,0).addCornerRounded(t.R8).addSegStrokeR(0,G).addCornerRounded(t.R8).addSegStrokeR(-J,0).addCornerRounded(t.R8).closeSegStroke();d.addMainOI([E,xt,K]),h.mergeFigure(d,!0);const ut=[];ut.push(M(-t.G1/2,S-t.S3,t.W2,t.S3)),ut.push(M(-t.G1/2,-S,t.W2,t.S3)),ut.push(M(t.G1/2-t.W2,S-t.S3,t.W2,t.S3)),ut.push(M(t.G1/2-t.W2,-S,t.W2,t.S3));for(const Nt of ut)h.addMainO(Nt),d.addSecond(Nt);o.fig={faceWheel:s,faceRod:i,faceTransversal:l,faceFrame:d,faceLift:h};const nt=o.partName,tt=[];tt.push(`subpax_${nt}_wheel1`),tt.push(`subpax_${nt}_wheel2`),t.d3_rod&&tt.push(`subpax_${nt}_rod`),tt.push(`subpax_${nt}_transversal`),tt.push(`subpax_${nt}_frame`),tt.push(`subpax_${nt}_lift`),o.vol={extrudes:[{outName:`subpax_${nt}_wheel1`,face:`${nt}_faceWheel`,extrudeMethod:j.eLinearOrtho,length:t.T1,rotate:[0,0,0],translate:[0,0,0]},{outName:`subpax_${nt}_wheel2`,face:`${nt}_faceWheel`,extrudeMethod:j.eLinearOrtho,length:t.T1,rotate:[0,0,0],translate:[0,0,x-t.T1]},{outName:`subpax_${nt}_rod`,face:`${nt}_faceRod`,extrudeMethod:j.eLinearOrtho,length:A,rotate:[0,0,0],translate:[0,0,-t.G3]},{outName:`subpax_${nt}_transversal`,face:`${nt}_faceTransversal`,extrudeMethod:j.eLinearOrtho,length:x,rotate:[0,0,0],translate:[0,0,0]},{outName:`subpax_${nt}_frame`,face:`${nt}_faceFrame`,extrudeMethod:j.eLinearOrtho,length:t.T3,rotate:[0,f,f],translate:[0,T+t.T2,x/2]},{outName:`subpax_${nt}_lift`,face:`${nt}_faceLift`,extrudeMethod:j.eLinearOrtho,length:t.T2,rotate:[0,f,f],translate:[0,T,x/2]}],volumes:[{outName:`pax_${nt}`,boolMethod:ee.eUnion,inList:tt}]},o.sub={},o.logstr+=`minimir drawn successfully!
`,o.calcErr=!1}catch(f){o.logstr+=f,console.log(f)}return o}var Rn={pTitle:"minimir",pDescription:"support of mirror of the heliostat-model",pDef:as,pGeom:$n},hs={partName:"rccar",params:[e("N1","unit",4,1,12,1),e("L1","mm",300,10,2e3,1),e("W1","mm",1200,10,2e3,1),Tt("General"),We("gen3D",["all","platform","bone","hand","motor","wheel"]),e("T1","mm",10,1,100,1),e("E1","mm",10,1,100,1),e("E2","mm",10,1,500,1),e("E3","mm",30,1,500,1),Tt("Platform"),e("H1","mm",230,10,2e3,1),e("W2","mm",100,10,2e3,1),Te("triangleInt",!0),Te("triangleExt",!1),Tt("Bone"),e("D1","mm",20,1,200,1),e("D2","mm",40,1,200,1),e("W3","mm",30,1,200,1),e("L2","mm",150,1,200,1),Tt("Unit"),e("F1","mm",180,1,1e3,1),e("Dwheel","mm",250,10,2e3,1),e("Z1","mm",100,10,2e3,1),e("Z2","mm",160,10,2e3,1),e("Lwheel","mm",100,10,2e3,1),e("Lmotor","mm",140,10,1e3,1),e("Dsteering","mm",40,1,500,1),e("Daxis","mm",20,1,500,1),Tt("Angles"),e("aBoneMin","degree",-40,-80,0,1),e("aBoneMax","degree",20,-80,80,1),e("aBoneLeft","%",0,0,100,1),e("aBoneRight","%",0,0,100,1),We("wheel",["straight","turn"]),e("ra","degree",0,-90,90,1),e("rx","cm",0,-1e3,1e3,1),e("ry","cm",0,-1e3,1e3,1)],paramSvg:{N1:"rccar_all_xy.svg",L1:"rccar_all_xy.svg",W1:"rccar_all_xz.svg",gen3D:"rccar_all_xy.svg",T1:"rccar_one_xy.svg",E1:"rccar_one_xy.svg",E2:"rccar_motor_xz.svg",E3:"rccar_motor_xz.svg",H1:"rccar_platform_xz.svg",W2:"rccar_platform_xz.svg",triangleInt:"rccar_all_xy.svg",triangleExt:"rccar_all_xy.svg",D1:"rccar_bone.svg",D2:"rccar_bone.svg",W3:"rccar_bone.svg",L2:"rccar_bone.svg",F1:"rccar_one_xy.svg",Dwheel:"rccar_motor_xz.svg",Z1:"rccar_motor_xz.svg",Z2:"rccar_motor_xz.svg",Lwheel:"rccar_motor_xz.svg",Lmotor:"rccar_motor_xz.svg",Dsteering:"rccar_motor_xz.svg",Daxis:"rccar_motor_xz.svg",aBoneMin:"rccar_all_xz.svg",aBoneMax:"rccar_all_xz.svg",aBoneLeft:"rccar_all_xz.svg",aBoneRight:"rccar_all_xz.svg",wheel:"rccar_all_xy.svg",ra:"rccar_all_xy.svg",rx:"rccar_all_xy.svg",ry:"rccar_all_xy.svg"},sim:{tMax:200,tStep:.5,tUpdate:500}};function Mn(c,t,r=""){const o=ae(hs.partName+r),s=U(),i=U(),l=U(),d=U(),h=U(),f=U(),a=U(),b=U(),g=U(),S=U(),_=U(),x=U(),A=U(),R=U(),v=U();o.logstr+=`${o.partName} simTime: ${c}
`;try{let gt=function(N){const _t=(N+c)%200;return(_t>100?200-_t:_t)/100},ft=function(N,_t,Bt){const jt=Math.atan2(N,_t);return Bt+Ds(jt-Bt)},st=function(N,_t,Bt){const jt=N*(p-t.T1),le=-N*(p+2*(t.E2+B)+t.T1),Se=Bt>0?le:jt,Ne=N*(t.E2+B),Ce=N*t.T1+Ne,qe=N*B,to=Bt>0?-jt-Ce:jt+Ce,Ls=Mt(Se,0,"green").addSegStrokeR(Ce,0).addPointR(qe,B).addPointR(0,2*B).addSegArc2().addSegStrokeR(-Ne,0).addSegStrokeR(0,St).addSegStrokeR(Ne,0).addPointR(qe,B).addPointR(0,2*B).addSegArc2().addSegStrokeR(-Ce,0).closeSegStroke().translatePolar(_t,Bt),As=z(to,B,bt).translatePolar(_t,Bt),ys=z(to,St+3*B,bt).translatePolar(_t,Bt);return[Ls,As,ys]},et=function(N,_t,Bt,jt){const le=Mt(Bt,jt+L).addPointR(-L,-L).addPointR(0,-2*L).addSegArc2().addSegStrokeR(L+_t,0).addSegStrokeR(0,2*L).closeSegStroke().rotate(Bt,jt,N),Se=z(Bt,jt,Wt);return[le,Se]},E=function(N,_t){const Bt=Mt(N-Yt,_t,"green").addPointR(Yt,-Yt).addPointR(2*Yt,0).addSegArc2().addSegStrokeR(L-Yt,t.Z1+t.T1+t.E1).addSegStrokeR(0,se).addSegStrokeR(-2*L,0).addSegStrokeR(0,-se).closeSegStroke(),jt=z(N,_t,ot+t.E1);return[Bt,jt]},xt=function(N,_t,Bt,jt){return Mt(Bt,jt).addSegStrokeR(N*ot,0).addSegStrokeR(0,ge+t.E3).addSegStrokeR(N*be,0).addCornerRounded(Ae).addSegStrokeR(0,t.Lwheel).addCornerRounded(Ae).addSegStrokeR(-N*D,0).closeSegStroke().rotate(Bt,jt,_t)},K=function(N,_t,Bt){const jt=t.Lmotor-ge,le=jt*Math.cos(Bt),Se=jt*Math.sin(Bt),Ne=xt(1,-Y+Bt,N+le,_t+Se),Ce=xt(-1,-Y+Bt,N+le,_t+Se),to=M(N+jt,_t-L,ge,2*L).rotate(N,_t,Bt);return[Ne,Ce,to]},ut=function(N,_t){return{outName:`subpax_${te}_platformTriangle${_t}`,face:`${te}_faceTriangle`,extrudeMethod:j.eLinearOrtho,length:t.T1,rotate:[0,0,0],translate:[0,0,N]}},nt=function(N,_t){return{outName:`subpax_${te}_PFfixation${_t}`,face:`${te}_facePFfixation`,extrudeMethod:j.eLinearOrtho,length:t.T1,rotate:[0,0,0],translate:[0,0,N]}},tt=function(N,_t){return{outName:`subpax_${te}_bones${_t}`,face:`${te}_faceBones`,extrudeMethod:j.eLinearOrtho,length:t.T1,rotate:[0,0,0],translate:[0,0,N]}},Nt=function(N,_t){return{outName:`subpax_${te}_handFixation${_t}`,face:`${te}_faceHandFixation`,extrudeMethod:j.eLinearOrtho,length:t.T1,rotate:[0,0,0],translate:[0,0,N]}},Pt=function(N,_t,Bt){return{outName:`subpax_${te}_handPlate${_t}${Bt}`,face:`${te}_faceHandPlate${_t}`,extrudeMethod:j.eLinearOrtho,length:t.T1,rotate:[Y,0,0],translate:[0,N+t.T1,0]}},Ft=function(N,_t){return{outName:`subpax_${te}_handBack${_t}`,face:`${te}_faceHandBack${_t}`,extrudeMethod:j.eLinearOrtho,length:t.Z2,rotate:[Y,0,0],translate:[0,N+t.T1,0]}},V=function(N,_t){return{outName:`subpax_${te}_motorBulk${_t}`,face:`${te}_faceMotorBulk${_t}`,extrudeMethod:j.eLinearOrtho,length:se,rotate:[Y,0,0],translate:[0,N-t.E1,0]}},it=function(N,_t,Bt,jt,le){const Se=t.Lmotor-ge,Ne=Se*Math.cos(jt),Ce=Se*Math.sin(jt),qe=Mo().addRotation(0,Y-jt,0).addTranslation(N+Ne,_t,Bt+Ce);return{outName:`subpax_${te}_mFoot${le}`,face:`${te}_faceMFoot`,extrudeMethod:j.eLinearOrtho,length:ge,rotate:qe.getRotation(),translate:qe.getTranslation()}},wt=function(N,_t,Bt,jt,le){const Se=t.Lmotor-ge,Ne=Se*Math.cos(jt),Ce=Se*Math.sin(jt),qe=Mo().addRotation(0,Y-jt,0).addTranslation(N+Ne,_t,Bt+Ce);return{outName:`subpax_${te}_wheel${le}`,face:`${te}_faceWheel`,extrudeMethod:j.eRotate,rotate:qe.getRotation(),translate:qe.getTranslation()}};var T=gt,k=ft,m=st,O=et,W=E,F=xt,ct=K,u=ut,I=nt,J=tt,G=Nt,X=Pt,Ht=Ft,Q=V,ht=it,vt=wt;const dt=Math.PI,Y=dt/2,rt=t.W1/2,p=t.W2/2,at=t.H1-t.T1,kt=rt-p,Ot=t.W2-2*t.T1,It=t.H1-2*t.T1,w=t.N1*(t.L1+t.T1)+t.T1,Dt=w*t.W1/10**6,B=t.D2/2,bt=t.D1/2,L=t.F1/2,Gt=(t.L1-t.F1)/2,Vt=Gt+t.T1+t.E1,q=Gt+2*(t.T1+t.E1),H=q+t.T1,y=t.F1-6*t.T1-4*t.E1,C=H+y,P=C+t.T1+t.E1,Z=C+2*(t.T1+t.E1),D=t.Dwheel/2,ot=t.Daxis/2,Wt=t.Dsteering/2,St=t.Z2-4*B,yt=t.Z2-t.T1,$t=we(t.aBoneMin),lt=we(t.aBoneMax),qt=D+t.Z1+t.L2*Math.sin($t)+t.H1,Xt=t.W3/2;if(B<Xt)throw`err152: D2 ${n(t.D2)} is too small compare to W3 ${n(t.W3)} mm`;const Zt=Math.sqrt(B**2-Xt**2),Et=t.L2-2*Zt,mt=$t+gt(t.aBoneRight)*(lt-$t),Ut=dt-$t-gt(t.aBoneLeft)*(lt-$t),Kt=t.L2*Math.cos(mt),zt=t.L2*Math.cos(Ut),ne=2*B+Kt,he=2*B-zt,oe=t.L2*Math.sin(mt),re=t.L2*Math.sin(Ut),fe=2*B*Math.sign(mt)+oe,$e=we(t.ra),ce=10*t.rx,ue=10*t.ry,xe=2*L+t.E2+t.T1,Rt=p+t.E2+B+Kt-B,_e=-p-t.E2-B+zt-B-t.E2,He=p+2*(t.E2+B)+Kt,Le=-p-2*(t.E2+B)+zt,pt=p+2*(t.E2+B)+Kt+t.T1+t.E2+L,At=-p-2*(t.E2+B)+zt-t.T1-t.E2-L;let Pe=new Array(t.N1).fill($e),$=new Array(t.N1).fill(dt+$e);if(t.wheel===1){const N=[],_t=[],Bt=t.L2*Math.cos($t),jt=p+2*(t.E2+B)+Bt+t.T1+t.E2+L,le=-p-2*(t.E2+B)-Bt-t.T1-t.E2-L;for(let Se=0;Se<t.N1;Se++){const Ne=Se*(t.L1+t.T1)+t.T1+t.L1/2;N.push(ft(Ne-ue,jt-ce,0)),_t.push(ft(Ne-ue,le-ce,dt))}Pe=N,$=_t}const Ct=t.Lmotor-L,se=t.Z2-2*(t.T1+t.E1),Re=L+t.Lmotor,ge=Ct-t.E2,Yt=ot+t.E1+t.T1,Me=se+t.E1+t.T1+t.Z1+Yt,be=D-ot,Ae=Math.min(t.Lwheel/3,be/2);if(Gt<.1)throw`err176: L1 ${n(t.L1)} is too small compare to F1 ${n(t.F1)} mm`;if(t.H1<t.Z2+t.T1)throw`err130: H1 ${n(t.H1)} is too small compare to Z2 ${n(t.Z2)} and T1 ${n(t.T1)} mm`;if(St<.1)throw`err149: Z2 ${n(t.Z2)} is too small compare to D2 ${n(t.D2)} mm`;if(Ot<.1)throw`err153: W2 ${n(t.W2)} is too small compare to T1 ${n(t.T1)} mm`;if(It<.1)throw`err156: H1c ${n(t.H1)} is too small compare to T1 ${n(t.T1)} mm`;if(y<.1)throw`err167: F1 ${n(t.F1)} is too small compare to T1 ${n(t.T1)} and E1 ${n(t.E1)} mm`;if(lt<$t)throw`err181: aBoneMax ${n(t.aBoneMax)} is too small compare to aBoneMin ${n(t.BoneMin)} degree`;if(ge<t.T1)throw`err218: Lmotor ${n(t.Lmotor)} is too small compare to F1 ${n(t.F1)}`;if(se<t.T1)throw`err226: Z2 ${n(t.Z2)} is too small compare to T1 ${n(t.T1)} and E1 ${n(t.E1)} mm`;if(t.Z1<Yt)throw`err256: Z1 ${n(t.Z1)} is too small compare to mFootR ${n(Yt)} mm`;if(D<Yt)throw`err259: Dwheel ${n(t.Dwheel)} is too small compare to mFootR ${n(Yt)} mm`;o.logstr+=`Platform Ltotal ${n(w/1e3)} m, surface ${n(Dt)} m2
`,o.logstr+=`Hplatform ${n(qt)} mm
`;const De=Mt(-p,0).addSegStrokeR(t.W2,0).addSegStrokeR(0,at).addSegStrokeR(kt,0).addSegStrokeR(0,t.T1).addSegStrokeR(-t.W1,0).addSegStrokeR(0,-t.T1).addSegStrokeR(kt,0).closeSegStroke(),Ie=M(-p+t.T1,t.T1,Ot,It);s.addMainOI([De,Ie]);const Be=Mt(-p,0).addSegStrokeR(t.T1,0).addSegStrokeR(0,t.H1).addSegStrokeR(-kt-t.T1,0).addSegStrokeR(0,-t.T1).closeSegStroke(),Fe=Mt(p,0).addSegStrokeR(kt,at).addSegStrokeR(0,t.T1).addSegStrokeR(-kt-t.T1,0).addSegStrokeR(0,-t.H1).closeSegStroke();i.addMainO(Be),i.addMainO(Fe),s.addSecond(Be),s.addSecond(Fe),l.addMainOI(st(1,0,0)),l.addMainOI(st(-1,0,0)),s.mergeFigure(l,!0);const Ze=Mt(Zt,Xt).addPointR(-Zt-B,-Xt).addPointR(0,-2*Xt).addSegArc2().addSegStrokeR(Et,0).addPointR(Zt+B,Xt).addPointR(0,2*Xt).addSegArc2().closeSegStroke(),me=Ze.rotate(0,0,mt),Ve=Ze.rotate(0,0,Ut),Je=Jt(p+t.E2+B,B),bo=Je.translatePolar(mt,t.L2),so=Jt(p+t.E2+B,St+3*B),Io=so.translatePolar(mt,t.L2),no=Jt(-p-t.E2-B,B),Bo=no.translatePolar(Ut,t.L2),co=Jt(-p-t.E2-B,St+3*B),Fo=co.translatePolar(Ut,t.L2);d.addMainOI([me.translate(Je.cx,Je.cy),z(Je.cx,Je.cy,bt),z(bo.cx,bo.cy,bt)]),d.addMainOI([me.translate(so.cx,so.cy),z(so.cx,so.cy,bt),z(Io.cx,Io.cy,bt)]),d.addMainOI([Ve.translate(no.cx,no.cy),z(no.cx,no.cy,bt),z(Bo.cx,Bo.cy,bt)]),d.addMainOI([Ve.translate(co.cx,co.cy),z(co.cx,co.cy,bt),z(Fo.cx,Fo.cy,bt)]),s.mergeFigure(d,!0),h.addMainOI(st(-1,mt,t.L2)),h.addMainOI(st(1,Ut,t.L2)),s.mergeFigure(h,!0);for(let N=0;N<t.N1;N++){const _t=N*(t.L1+t.T1)+t.T1+t.L1/2;f.addMainOI(et(dt,t.T1+t.E2,pt,_t)),a.addMainOI(et(0,t.T1+t.E2,At,_t))}s.addSecond(M(He,oe,xe,t.T1)),s.addSecond(M(He,oe+yt,xe,t.T1)),s.addSecond(M(Le-xe,re,xe,t.T1)),s.addSecond(M(Le-xe,re+yt,xe,t.T1));for(let N=0;N<t.N1;N++){const _t=N*(t.L1+t.T1)+t.T1+Gt;b.addMainO(M(He,_t,t.T1,2*L)),g.addMainO(M(Le-t.T1,_t,t.T1,2*L))}s.addSecond(M(He,oe,t.T1,t.Z2)),s.addSecond(M(Le-t.T1,re,t.T1,t.Z2));for(let N=0;N<t.N1;N++){const _t=N*(t.L1+t.T1)+t.T1+t.L1/2;S.addMainOI(et(Pe[N],Ct,pt,_t)),_.addMainOI(et($[N],Ct,At,_t))}const mo=He+t.T1+t.E2,Jo=oe+t.T1+t.E1,qo=Le-t.T1-t.E2-Re,bs=re+t.T1+t.E1;s.addSecond(M(mo,Jo,Re,se)),s.addSecond(M(qo,bs,Re,se));const ko=mo+L+t.Lmotor-ge,wo=oe-t.Z1-Yt,Ho=qo,Lo=re-t.Z1-Yt;if(s.addSecond(M(ko,wo,ge,Me)),s.addSecond(M(Ho,Lo,ge,Me)),x.addMainOI(E(0,0)),A.addMainO(xt(1,0,0,0)),A.addSecond(xt(-1,0,0,0)),s.addSecond(xt(1,-Y,ko,wo+Yt)),s.addSecond(xt(-1,-Y,ko,wo+Yt)),s.addSecond(xt(1,Y,Ho+ge,Lo+Yt)),s.addSecond(xt(-1,Y,Ho+ge,Lo+Yt)),R.addMainOI([M(-rt,0,t.W1,w),M(-p+t.T1,0,Ot,w)]),R.addSecond(M(-p,0,t.W2,w)),t.triangleExt)for(let N=0;N<2;N++){const _t=N*(t.L1+t.T1)*t.N1;R.addSecond(M(-rt,_t,kt,t.T1)),R.addSecond(M(p,_t,kt,t.T1))}if(t.triangleInt)for(let N=1;N<t.N1;N++){const _t=N*(t.L1+t.T1);R.addSecond(M(-rt,_t,kt,t.T1)),R.addSecond(M(p,_t,kt,t.T1))}const io=t.E2+2*B,ks=-p-io;for(let N=0;N<t.N1;N++){const _t=t.T1+N*(t.L1+t.T1);for(const Bt of[Gt,q,C,Z]){const jt=_t+Bt;R.addSecond(M(p,jt,io,t.T1)),R.addSecond(M(ks,jt,io,t.T1))}}const ws=-p-t.E2-he;for(let N=0;N<t.N1;N++){const _t=t.T1+N*(t.L1+t.T1);for(const Bt of[Gt,C]){const jt=_t+Bt+t.T1+t.E1;R.addSecond(M(p+t.E2,jt,ne,t.T1)),R.addSecond(M(ws,jt,he,t.T1))}}for(let N=0;N<t.N1;N++){const _t=t.T1+N*(t.L1+t.T1);for(const Bt of[Gt,q,C,Z]){const jt=_t+Bt;R.addSecond(M(Rt,jt,io,t.T1)),R.addSecond(M(_e,jt,io,t.T1))}}R.mergeFigure(f,!0),R.mergeFigure(a,!0),R.mergeFigure(b,!0),R.mergeFigure(g,!0),R.mergeFigure(S,!0),R.mergeFigure(_,!0),R.addPoint(Jt(ce,ue,ho.eBigSquare));for(let N=0;N<t.N1;N++){const _t=N*(t.L1+t.T1)+t.T1+t.L1/2;for(const Bt of K(pt,_t,Pe[N]))R.addSecond(Bt);for(const Bt of K(At,_t,$[N]))R.addSecond(Bt)}if(v.addMainO(M(0,0,w,t.H1)),v.addSecond(M(0,at,w,t.T1)),t.triangleExt)for(let N=0;N<2;N++){const _t=N*(t.L1+t.T1)*t.N1;v.addSecond(M(_t,0,t.T1,at))}if(t.triangleInt)for(let N=1;N<t.N1;N++){const _t=N*(t.L1+t.T1);v.addSecond(M(_t,0,t.T1,at))}const ze=2*B;for(let N=0;N<t.N1;N++){const _t=t.T1+N*(t.L1+t.T1);for(const Bt of[Gt,q,C,Z]){const jt=_t+Bt;v.addSecond(M(jt,0,t.T1,ze)),v.addSecond(M(jt,ze+St,t.T1,ze))}}for(let N=0;N<t.N1;N++){const _t=t.T1+N*(t.L1+t.T1);for(const Bt of[Gt,C]){const jt=_t+Bt+t.T1+t.E1;if(fe>0)v.addSecond(M(jt,0,t.T1,fe)),v.addSecond(M(jt,2*B+St,t.T1,fe));else{const le=-fe;v.addSecond(M(jt,2*B-le,t.T1,le)),v.addSecond(M(jt,4*B+St-le,t.T1,le))}}}for(let N=0;N<t.N1;N++){const _t=t.T1+N*(t.L1+t.T1);for(const Bt of[Gt,q,C,Z]){const jt=_t+Bt;v.addSecond(M(jt,oe,t.T1,ze)),v.addSecond(M(jt,oe+ze+St,t.T1,ze))}}const Ee=[oe,oe+yt],Ke=[re,re+yt];for(let N=0;N<t.N1;N++){const _t=t.T1+N*(t.L1+t.T1),Bt=_t+Gt;v.addSecond(M(Bt,Ee[0],t.F1,t.T1)),v.addSecond(M(Bt,Ee[1],t.F1,t.T1)),v.addSecond(M(Bt,Ee[0],t.F1,t.Z2)),v.addSecond(M(Bt,Jo,t.F1,se));const jt=_t+t.L1/2,le=Ee[0]-t.Z1;for(const Se of E(jt,le))v.addSecond(Se);v.addSecond(z(jt,le,ot)),v.addSecond(z(jt,le,D))}o.fig={facePlatform:s,faceTop:R,faceSide:v,faceTriangle:i,facePFfixation:l,faceBones:d,faceHandFixation:h,faceHandPlateR:f,faceHandPlateL:a,faceHandBackR:b,faceHandBackL:g,faceMotorBulkR:S,faceMotorBulkL:_,faceMFoot:x,faceWheel:A};const te=o.partName,Qe=[],pe=[],Hs={outName:`subpax_${te}_platformMain`,face:`${te}_facePlatform`,extrudeMethod:j.eLinearOrtho,length:w,rotate:[0,0,0],translate:[0,0,0]},ro=[];for(let N=0;N<t.N1;N++){const _t=t.T1+N*(t.L1+t.T1);for(const[Bt,jt]of[Gt,q,C,Z].entries()){const le=_t+jt,Se=4*N+Bt;ro.push(nt(le,Se)),pe.push(`subpax_${te}_PFfixation${Se}`)}}if(pe.push(`subpax_${te}_platformMain`),t.triangleExt&&(ro.push(ut(0,0)),ro.push(ut(w-t.T1,t.N1+1)),pe.push(`subpax_${te}_platformTriangle0`),pe.push(`subpax_${te}_platformTriangle${t.N1+1}`)),t.triangleInt)for(let N=1;N<t.N1;N++)ro.push(ut(N*(t.T1+t.L1),N+1)),pe.push(`subpax_${te}_platformTriangle${N+1}`);const jo=[],Go=[];for(let N=0;N<t.N1;N++){const _t=t.T1+N*(t.L1+t.T1);for(const[Bt,jt]of[Vt,P].entries()){const le=_t+jt,Se=2*N+Bt;Go.push(tt(le,Se)),jo.push(`subpax_${te}_bones${Se}`)}}const je=[],Ge=[];for(let N=0;N<t.N1;N++){const _t=t.T1+N*(t.L1+t.T1);for(const[Bt,jt]of[Gt,q,C,Z].entries()){const le=_t+jt,Se=4*N+Bt;Ge.push(Nt(le,Se)),je.push(`subpax_${te}_handFixation${Se}`)}}Ge.push(Pt(Ee[0],"R",1)),Ge.push(Pt(Ee[1],"R",2)),Ge.push(Pt(Ke[0],"L",1)),Ge.push(Pt(Ke[1],"L",2)),je.push(`subpax_${te}_handPlateR1`),je.push(`subpax_${te}_handPlateR2`),je.push(`subpax_${te}_handPlateL1`),je.push(`subpax_${te}_handPlateL2`),Ge.push(Ft(Ee[1],"R")),Ge.push(Ft(Ke[1],"L")),je.push(`subpax_${te}_handBackR`),je.push(`subpax_${te}_handBackL`);const lo=[],go=[];go.push(V(Ee[1],"R")),go.push(V(Ke[1],"L")),lo.push(`subpax_${te}_motorBulkR`),lo.push(`subpax_${te}_motorBulkL`);for(let N=0;N<t.N1;N++){const _t=(2*N).toString().padStart(2,"0"),Bt=(2*N+1).toString().padStart(2,"0"),jt=N*(t.L1+t.T1)+t.T1+t.L1/2;go.push(it(pt,Ee[0]-t.Z1,jt,Pe[N],_t)),lo.push(`subpax_${te}_mFoot${_t}`),go.push(it(At,Ke[0]-t.Z1,jt,$[N],Bt)),lo.push(`subpax_${te}_mFoot${Bt}`)}const Ao=[],yo=[];for(let N=0;N<t.N1;N++){const _t=(2*N).toString().padStart(2,"0"),Bt=(2*N+1).toString().padStart(2,"0"),jt=N*(t.L1+t.T1)+t.T1+t.L1/2;yo.push(wt(pt,Ee[0]-t.Z1,jt,Pe[N],_t)),Ao.push(`subpax_${te}_wheel${_t}`),yo.push(wt(At,Ke[0]-t.Z1,jt,$[N],Bt)),Ao.push(`subpax_${te}_wheel${Bt}`)}(t.gen3D===0||t.gen3D===1)&&Qe.push(...pe),(t.gen3D===0||t.gen3D===2)&&Qe.push(...jo),(t.gen3D===0||t.gen3D===3)&&Qe.push(...je),(t.gen3D===0||t.gen3D===4)&&Qe.push(...lo),(t.gen3D===0||t.gen3D===5)&&Qe.push(...Ao),o.vol={extrudes:[Hs,...ro,...Go,...Ge,...go,...yo],volumes:[{outName:`pax_${te}`,boolMethod:ee.eUnion,inList:Qe}]},o.sub={},o.logstr+=`RC-car drawn successfully!
`,o.calcErr=!1}catch(gt){o.logstr+=gt,console.log(gt)}return o}var Wn={pTitle:"rccar",pDescription:"high-level concept of the RC-car",pDef:hs,pGeom:Mn},fs={partName:"singleBone",params:[e("D1","mm",30,1,500,1),e("D2","mm",70,1,500,1),e("L1","mm",200,10,1e3,1),Tt("Details"),e("R3","mm",50,0,1e3,1),e("W1","mm",30,1,500,1),e("T1","mm",10,1,100,1),Tt("Holes"),e("P2","%",50,0,99,1),e("W2","mm",10,1,500,1)],paramSvg:{D1:"singleBone_face.svg",D2:"singleBone_face.svg",L1:"singleBone_face.svg",R3:"singleBone_face.svg",W1:"singleBone_face.svg",T1:"singleBone_face.svg",P2:"singleBone_face.svg",W2:"singleBone_face.svg"},sim:{tMax:200,tStep:.5,tUpdate:500}};function Tn(c,t,r=""){const o=ae(fs.partName+r),s=U();o.logstr+=`${o.partName} simTime: ${c}
`;try{const i=t.W1/2,l=t.D1/2,d=t.D2/2,h=t.L1+2*d,f=d**2-i**2;if(f<0)throw`err086: D2 ${n(t.D2)} is too small compare to W1 ${n(t.W1)} mm`;const a=Math.sqrt(f),b=t.L1-2*a,g=i*t.P2/100,S=t.W2+2*g,_=Math.max(Math.floor((t.L1-2*d-t.W2)/S),0),x=(t.L1-2*d-_*2*g)/(_+1),A=d+x+g,R=x+2*g;if(d<l)throw`err085: D2 ${n(t.D2)} is too small compare to D1 ${n(t.D1)} mm`;if(b<0)throw`err095: L1 ${n(t.L1)} is too small compare to D2 ${n(t.D2)} mm`;o.logstr+=`Bone length ${n(h)} mm
`,o.logstr+=`Bone with N2 ${_} holes of diameter ${n(2*g)} mm
`,o.logstr+=`Bone W2b ${n(x)} mm
`;const v=Mt(a,i).addCornerRounded(t.R3).addPointR(-a-d,-i).addPointR(0,-2*i).addSegArc2().addCornerRounded(t.R3).addSegStrokeR(b,0).addCornerRounded(t.R3).addPointR(a+d,i).addPointR(0,2*i).addSegArc2().addCornerRounded(t.R3).closeSegStroke(),T=z(0,0,l),k=z(t.L1,0,l),m=[];if(g>0)for(let W=0;W<_;W++)m.push(z(A+W*R,0,g));s.addMainOI([v,T,k,...m]),o.fig={faceBone:s};const O=o.partName;o.vol={extrudes:[{outName:`subpax_${O}_bone`,face:`${O}_faceBone`,extrudeMethod:j.eLinearOrtho,length:t.T1,rotate:[0,0,0],translate:[0,0,0]}],volumes:[{outName:`pax_${O}`,boolMethod:ee.eIdentity,inList:[`subpax_${O}_bone`]}]},o.sub={},o.logstr+=`singleBone drawn successfully!
`,o.calcErr=!1}catch(i){o.logstr+=i,console.log(i)}return o}var vn={pTitle:"singleBone",pDescription:"detailed design of the suspension bone of the rccar",pDef:fs,pGeom:Tn},us={partName:"doubleBone",params:[e("D1","mm",30,1,500,1),e("D2","mm",70,1,500,1),e("L1","mm",300,10,1e3,1),e("L2","mm",200,10,1e3,1),e("E1","mm",40,1,1e3,1),Tt("Side"),e("W1","mm",30,1,500,1),e("P2","%",50,0,99,1),e("W2","mm",10,1,500,1),Tt("Top"),e("S1","mm",20,1,100,1),e("S2","mm",20,1,100,1),e("S3","mm",20,1,100,1),e("R3","mm",10,0,1e3,1),Tt("Wing width"),e("P11","%",8,0,90,1),e("P12","%",20,0,90,1),e("P21","%",18,0,90,1),e("P22","%",20,0,90,1),Tt("Folding"),e("T1","mm",2,.5,10,.1),e("Jangle","degree",90,30,120,1),e("Jradius","mm",10,.1,50,.1),e("Jneutral","%",50,0,100,1),e("Jmark","mm",2,.1,10,.1),e("Jradius2","mm",4,.1,50,.1),e("Jmark2","mm",2,.1,10,.1)],paramSvg:{D1:"doubleBone_face.svg",D2:"doubleBone_face.svg",L1:"doubleBone_face.svg",L2:"doubleBone_top.svg",E1:"doubleBone_top.svg",W1:"doubleBone_face.svg",P2:"doubleBone_side.svg",W2:"doubleBone_side.svg",S1:"doubleBone_top.svg",S2:"doubleBone_top.svg",S3:"doubleBone_top.svg",R3:"doubleBone_side.svg",P11:"doubleBone_top.svg",P12:"doubleBone_top.svg",P21:"doubleBone_top.svg",P22:"doubleBone_top.svg",T1:"doubleBone_folding.svg",Jangle:"doubleBone_folding.svg",Jradius:"doubleBone_folding.svg",Jneutral:"doubleBone_folding.svg",Jmark:"doubleBone_folding.svg",Jradius2:"doubleBone_folding.svg",Jmark2:"doubleBone_folding.svg"},sim:{tMax:200,tStep:.5,tUpdate:500}};function Pn(c,t,r=""){const o=ae(us.partName+r);o.logstr+=`${o.partName} simTime: ${c}
`;try{let a=function(Yt,Me,be){const Ae=Math.atan2(Me,Yt),De=be/Math.sin(Ae);return[Ae,De]},b=function(Yt,Me){if(Yt<0)throw`err559: iL ${n(Yt)} is negative mm`;let be=Yt,Ae=0;return Me>0&&(Ae=Me/100*Yt,be=(Yt-Ae)/2),[be,Ae]},g=function(Yt,Me){return ye(F,T).addPointR(-F-m,-T).addPointR(0,-2*T).addSegArc2().startJunction(Yt,de.eA,ie.eABLeft).addSegStrokeR(ct,0).addPointR(F+m,T).addPointR(0,2*T).addSegArc2().startJunction(Me,de.eB,ie.eABRight).closeSegStroke()},S=function(Yt,Me,be){const Ae=`J${be}1`,De=`J${be}2`,Ie=ye(0,0).addSegStrokeR(nt,0).startJunction(Ae,de.eA,ie.eABLeft).addSegStrokeR(ut,0).addSegStrokeR(nt,0);return Me!==""&&Ie.startJunction(Me,de.eA,ie.eABLeft),Ie.addSegStrokeR(0,ct).addSegStrokeR(-nt,0).startJunction(De,de.eA,ie.eABLeft).addSegStrokeR(-ut,0).addSegStrokeR(-nt,0).startJunction(Yt,de.eB,ie.eABRight).closeSegStroke(),Ie},_=function(Yt,Me,be,Ae,De,Ie,Be,Fe,Ze){const me=ye(Me,be).addCornerRounded(t.R3).addSegStrokeR(Ie,0);Be>0&&me.startJunction(`${Yt}1`,de.eA,ie.eABRight).addSegStrokeR(Be,0).addSegStrokeR(Ie,0);const Ve=A-De;me.addCornerRounded(t.R3).addSegStrokeRP(Ve,Fe),Ze>0&&me.startJunction(`${Yt}2`,de.eA,ie.eABRight).addSegStrokeRP(Ve,Ze).addSegStrokeRP(Ve,Fe);const Je=A+De;return me.addCornerRounded(t.R3).addSegStrokeRP(Je,Fe),Ze>0&&me.startJunction(`${Yt}3`,de.eA,ie.eABRight).addSegStrokeRP(Je,Ze).addSegStrokeRP(Je,Fe),me.rotate(Me,be,Ae)},x=function(Yt){return ye(0,0).addSegStrokeR(ut,0).addSegStrokeR(0,t.W1).startJunction(Yt,de.eB,ie.eABRight).addSegStrokeR(-ut,0).closeSegStroke()};var s=a,i=b,l=g,d=S,h=_,f=x;const A=Math.PI,R=A/2,v=t.W1,T=v/2,k=t.D1/2,m=t.D2/2,O=t.L1+2*m,W=m**2-T**2;if(W<0)throw`err086: D2 ${n(t.D2)} is too small compare to W1 ${n(t.W1)} mm`;const F=Math.sqrt(W),ct=t.L1-2*F,u=T*t.P2/100,I=t.W2+2*u,J=Math.max(Math.floor((t.L1-2*m-t.W2)/I),0),G=(t.L1-2*m-J*2*u)/(J+1),X=m+G+u,Ht=G+2*u,Q=we(t.Jangle),ht=t.Jneutral/100,vt=t.Jradius,gt=t.Jmark,ft=t.Jradius2,st=t.Jmark2,et=vt+t.T1*(1-Q),E=vt-t.T1*Q,xt=ft-t.T1*Q,K=t.L2-2*et,ut=K+2*E-2*t.E1,nt=(K-ut)/2,tt=Math.max(Math.floor((ut-t.W2)/I),0),Nt=(ut-tt*2*u)/(tt+1),Pt=Nt+u,Ft=Nt+2*u,V=ct-2*t.S2,it=K-2*t.S1,[wt,dt]=a(it,V,t.S3/2),Y=it-2*dt,[rt,p]=a(V,it,t.S3/2),at=V-2*p,[kt,Ot]=b(Y,t.P11),It=Y/(2*Math.cos(wt)),[w,Dt]=b(It,t.P12),[B,bt]=b(at,t.P21),L=at/(2*Math.cos(rt)),[Gt,Vt]=b(L,t.P22),q=t.W1/2+E-xt;if(m<k)throw`err085: D2 ${n(t.D2)} is too small compare to D1 ${n(t.D1)} mm`;if(ct<0)throw`err095: L1 ${n(t.L1)} is too small compare to D2 ${n(t.D2)} mm`;if(t.E1<E)throw`err151: E1 ${n(t.E1)} is too small compare to Jradius ${n(t.Jradius)} mm`;if(ut<0)throw`err150: L2 ${n(t.L2)} is too small compare to E1 ${n(t.E1)} mm`;o.logstr+=`Bone length ${n(O)} mm
`,o.logstr+=`Bone with N2 ${J} holes of diameter ${n(2*u)} and W2b ${n(G)} mm
`,o.logstr+=`Side with N2c ${tt} holes of diameter ${n(2*u)} and W2c ${n(Nt)} mm
`;const H=z(0,0,k),y=z(t.L1,0,k),C=[];if(u>0)for(let Yt=0;Yt<J;Yt++)C.push(z(X+Yt*Ht,0,u));const P=g("J1","J2"),Z=g("J3","J4"),D=ve([P,H,y,...C]),ot=ve([Z,H,y,...C]),Wt=S("J1","",1),St=S("J3","J2",2),yt=t.S1+dt,$t=t.S2,lt=_("J14",yt,$t,0,wt,kt,Ot,w,Dt),Lt=_("J24",yt,$t,0,wt,kt,Ot,w,Dt),qt=K-t.S1-dt,Xt=ct-t.S2,Zt=_("J12",qt,Xt,A,wt,kt,Ot,w,Dt),Et=_("J22",qt,Xt,A,wt,kt,Ot,w,Dt),mt=K-t.S1,Ut=t.S2+p,Kt=_("J11",mt,Ut,R,rt,B,bt,Gt,Vt),zt=_("J21",mt,Ut,R,rt,B,bt,Gt,Vt),ne=t.S1,he=ct-t.S2-p,oe=_("J13",ne,he,-R,rt,B,bt,Gt,Vt),re=_("J23",ne,he,-R,rt,B,bt,Gt,Vt),fe=ve([Wt,lt,Zt,Kt,oe]),$e=ve([St,Lt,Et,zt,re]),ce=[];if(u>0)for(let Yt=0;Yt<tt;Yt++)ce.push(z(Pt+Yt*Ft,T,u));const ue=ve([x("J11"),...ce]),xe=ve([x("J12"),...ce]),Rt=[],_e=[],He=[bt,Vt,Vt],Le=[Ot,Dt,Dt];for(let Yt=0;Yt<2;Yt++)for(let Me=0;Me<4;Me++)for(let be=0;be<3;be++){const Ae=`J${Yt+1}${Me+1}${be+1}`;Rt.push(Ae);const Be=(Me%2===1?Le:He)[be];if(Be>0){const Fe=ye(0,0).addSegStrokeR(Be,0).addSegStrokeR(0,q).startJunction(Ae,de.eA,ie.eABLeft).addSegStrokeR(-Be,0).closeSegStroke();_e.push(ve([Fe]))}}const pt=["J1","J2","J3","J4","J11","J12","J21","J22"],At={angle:Q,radius:vt,neutral:ht,mark:gt},Pe={angle:Q,radius:ft,neutral:ht,mark:st},$={};for(const Yt of pt)$[Yt]=At;for(const Yt of Rt)$[Yt]=Pe;const Ct=["J1",K,"J2",v,"J3",K],se=["J11",v,"J21",ct],Re=["J12",v,"J22"],ge=vo([D,fe,$e,ot,ue,xe,..._e],$,[{x1:0,y1:0,a1:0,l1:v,ante:Ct,post:["J4"]},{x1:4*v,y1:0,a1:0,l1:ct,ante:se,post:Re}],t.T1,o.partName);o.fig=ge.makeFigures(),o.vol=ge.makeVolume(),o.sub={},o.logstr+=`doubleBone drawn successfully!
`,o.calcErr=!1}catch(a){o.logstr+=a,console.log(a)}return o}var bn={pTitle:"doubleBone",pDescription:"combined suspension bones of the rccar",pDef:us,pGeom:Pn},Ss={partName:"pcar",params:[e("LB1","mm",1e3,100,4e3,1),e("LB2","mm",3e3,100,8e3,1),e("LB3","mm",1e3,100,4e3,1),e("LT1","mm",800,100,4e3,1),e("LT3","mm",1200,100,4e3,1),e("LT4","mm",1600,100,4e3,1),e("HF1","mm",900,100,3e3,1),e("HF3","mm",600,100,3e3,1),e("HF4","mm",300,100,3e3,1),e("HB1","mm",800,100,3e3,1),Tt("Wheels"),e("HW1","mm",200,-1e3,1e3,1),e("DW1","mm",100,1,500,1),e("DW2","mm",600,1,2e3,1),e("DW3","mm",800,1,2e3,1),e("WW1","mm",300,1,1e3,1),e("WW2","mm",200,1,1e3,1),e("RW2","mm",50,1,1e3,1),Tt("Side"),e("C1","mm",50,1,500,1),e("C2","mm",100,1,500,1),e("C3","mm",50,1,500,1),e("C4","mm",50,1,500,1),e("Rs1","mm",100,1,2e3,1),e("Rs2","mm",100,1,2e3,1),e("Rs3","mm",100,1,2e3,1),e("Rs4","mm",100,1,2e3,1),e("Rs5","mm",100,1,2e3,1),e("Rs6","mm",500,1,2e3,1),e("Rs7","mm",100,1,2e3,1),Tt("Top"),e("Wt1","mm",600,1,2e3,1),e("Wt2","mm",800,1,2e3,1),e("Ct1","mm",50,1,500,1),e("Ct2","mm",50,1,500,1),e("Ct3","mm",50,1,500,1),e("Rt1","mm",100,1,2e3,1),e("Rt2","mm",400,1,2e3,1),Tt("Front"),e("Wf1","mm",800,1,2e3,1),e("Wf2","mm",300,1,1e3,1),e("Cf1","mm",50,1,500,1),e("Cf2","mm",50,1,500,1),e("Cf3","mm",50,1,500,1),e("Rf1","mm",100,1,2e3,1),e("Rf2","mm",100,1,2e3,1),e("Rf3","mm",100,1,2e3,1)],paramSvg:{LB1:"pcar_side.svg",LB2:"pcar_side.svg",LB3:"pcar_side.svg",LT1:"pcar_side.svg",LT3:"pcar_side.svg",LT4:"pcar_side.svg",HF1:"pcar_side.svg",HF3:"pcar_side.svg",HF4:"pcar_side.svg",HB1:"pcar_side.svg",HW1:"pcar_side.svg",DW1:"pcar_side.svg",DW2:"pcar_side.svg",DW3:"pcar_side.svg",WW1:"pcar_front.svg",WW2:"pcar_front.svg",RW2:"pcar_front.svg",C1:"pcar_side.svg",C2:"pcar_side.svg",C3:"pcar_side.svg",C4:"pcar_side.svg",Rs1:"pcar_side.svg",Rs2:"pcar_side.svg",Rs3:"pcar_side.svg",Rs4:"pcar_side.svg",Rs5:"pcar_side.svg",Rs6:"pcar_side.svg",Rs7:"pcar_side.svg",Wt1:"pcar_top.svg",Wt2:"pcar_top.svg",Ct1:"pcar_top.svg",Ct2:"pcar_top.svg",Ct3:"pcar_top.svg",Ct4:"pcar_top.svg",Rt1:"pcar_top.svg",Rt2:"pcar_top.svg",Wf1:"pcar_front.svg",Wf2:"pcar_front.svg",Cf1:"pcar_front.svg",Cf2:"pcar_front.svg",Cf3:"pcar_front.svg",Rf1:"pcar_front.svg",Rf2:"pcar_front.svg",Rf3:"pcar_front.svg"},sim:{tMax:180,tStep:.5,tUpdate:500}};function kn(c,t,r=""){const o=ae(Ss.partName+r),s=U(),i=U(),l=U(),d=U(),h=U();o.logstr+=`${o.partName} simTime: ${c}
`;try{let g=function(rt,p,at){const kt=(rt**2+p**2)/4,Ot=Math.sqrt(kt),w=Math.sqrt(kt+at**2)/2,Dt=Math.atan2(Ot,at);return w/Math.cos(Dt)},S=function(rt){const p=Mt(-t.LB1,k).addCornerRounded(t.Rs1);return rt?p.addSegStrokeR(st,0).addPointR(ft,t.HW1+T).addPointR(2*ft,0).addSegArc2().addSegStrokeR(et,0).addPointR(ft,t.HW1+T).addPointR(2*ft,0).addSegArc2().addSegStrokeR(E,0):p.addSegStrokeR(O,0),p.addCornerRounded(t.Rs7).addSegStrokeR(0,t.HF1).addCornerRounded(t.Rs6).addPointR(-t.LT4,t.HF4).addSegArc(nt,!1,!0).addCornerRounded(t.Rs5).addPointR(-t.LT3,ct).addSegArc(ut,!1,!0).addCornerRounded(t.Rs4).addPointR(-F,0).addSegArc(K,!1,!0).addCornerRounded(t.Rs3).addPointR(-t.LT1,-u).addSegArc(xt,!1,!0).addCornerRounded(t.Rs2).closeSegStroke(),p},_=function(rt,p,at,kt){return Mt(p,at).addSegStrokeR(rt*R,0).addSegStrokeR(0,t.WW1).addSegStrokeR(rt*(v-R),0).addCornerRounded(t.RW2).addSegStrokeR(0,t.WW2).addCornerRounded(t.RW2).addSegStrokeR(-rt*v,0).closeSegStroke().rotate(p,at,kt)};var f=g,a=S,b=_;const x=Math.PI,A=x/2,R=t.DW1/2,v=t.DW2/2,T=t.DW3/2,k=v-t.HW1,m=t.HF1+t.HF3+t.HF4,O=t.LB1+t.LB2+t.LB3,W=2*t.Wt1+t.Wt2,F=O-(t.LT1+t.LT3+t.LT4),ct=t.HF3-t.C2,u=t.HB1-t.C2,I=m-t.HB1,J=m-t.Cf3-t.Wf1,G=W-2*(t.Cf1+t.Wf2),X=W-2*t.Cf1,Ht=t.Wt1-(t.Cf1+t.WW1+t.WW2),Q=t.Wt1-(t.Ct2+t.WW1+t.WW2),ht=t.LB1-(t.Ct1+T),vt=t.LB3-(t.Ct3+T),gt=T**2-t.HW1**2;if(gt<0)throw`err158: dXwheel2 ${n(gt)} is negative because of HW1 ${n(t.HW1)} and RW3 ${n(T)} mm`;const ft=Math.sqrt(T**2-t.HW1**2),st=t.LB1-ft,et=t.LB2-2*ft,E=t.LB3-ft,xt=g(t.LT1,u,t.C1),K=g(F,0,t.C2),ut=g(t.LT3,ct,t.C3),nt=g(t.LT4,t.HF4,t.C4),tt=g(0,W-2*t.Ct2,t.Ct1),Nt=g(0,W-2*t.Ct2,t.Ct3),Pt=g(O-t.Ct1-t.Ct3,0,t.Ct2),Ft=g(0,t.Wf1,t.Cf1),V=g(t.Wf2,J,t.Cf2),it=g(G,0,t.Cf3);if(k<0)throw`err147: DW2 ${n(t.DW2)} is too small comapre to HW1 ${n(t.HW1)} mm`;if(F<0)throw`err169: LT2 ${n(F)} mm is negative`;if(ct<0)throw`err174: HF3b ${n(ct)} mm is negative`;if(u<0)throw`err178: HB1b ${n(u)} mm is negative`;if(I<0)throw`err172: HB2 ${n(I)} mm is negative`;if(J<0)throw`err161: Wf1b ${n(J)} mm is negative`;if(G<0)throw`err164: Wf2b ${n(G)} mm is negative`;if(Ht<0)throw`err167: Cf1b ${n(Ht)} mm is negative`;if(ht<0)throw`err170: Ct1b ${n(ht)} mm is negative`;if(Q<0)throw`err173: Ct2b ${n(Q)} mm is negative`;if(vt<0)throw`err176: Ct3b ${n(vt)} mm is negative`;if(st<0)throw`err185: LB1b ${n(st)} mm is negative`;if(et<0)throw`err189: LB2b ${n(et)} mm is negative`;if(E<0)throw`err193: LB3b ${n(E)} mm is negative`;o.logstr+=`Body: Y0 ${n(k)}, Height ${n(m)}, Lenght: ${n(O)}, Width: ${n(W)} mm
`,s.addMainO(S(!0)),s.addSecond(z(0,v,v)),s.addSecond(z(0,v,R)),s.addSecond(z(t.LB2,v,v)),s.addSecond(z(t.LB2,v,R)),i.addMainO(S(!1)),i.mergeFigure(s,!0);const wt=Mt(-t.LB1+t.Ct1,t.Ct2).addCornerRounded(t.Rt1).addPointR(O-t.Ct1-t.Ct3,0).addSegArc(Pt,!1,!0).addCornerRounded(t.Rt2).addPointR(0,W-2*t.Ct2).addSegArc(Nt,!1,!0).addCornerRounded(t.Rt2).addPointR(-O+t.Ct1+t.Ct3,0).addSegArc(Pt,!1,!0).addCornerRounded(t.Rt1).addPointR(0,-W+2*t.Ct2).addSegArc(tt,!1,!0);l.addMainO(wt);const dt=Mt(t.Cf1,k).addCornerRounded(t.Rf1).addSegStrokeR(X,0).addCornerRounded(t.Rf1).addPointR(0,t.Wf1).addSegArc(Ft,!1,!0).addCornerRounded(t.Rf2).addPointR(-t.Wf2,J).addSegArc(V,!1,!0).addCornerRounded(t.Rf3).addPointR(-G,0).addSegArc(it,!1,!0).addCornerRounded(t.Rf3).addPointR(-t.Wf2,-J).addSegArc(V,!1,!0).addCornerRounded(t.Rf2).addPointR(0,-t.Wf1).addSegArc(Ft,!1,!0);d.addMainO(dt),h.addMainO(_(1,0,0,0)),h.addSecond(_(-1,0,0,0)),l.addSecond(_(1,0,t.Wt1+t.Wt2,0)),l.addSecond(_(-1,0,t.Wt1+t.Wt2,0)),l.addSecond(_(1,t.LB2,t.Wt1+t.Wt2,0)),l.addSecond(_(-1,t.LB2,t.Wt1+t.Wt2,0)),l.addSecond(_(1,0,t.Wt1,x)),l.addSecond(_(-1,0,t.Wt1,x)),l.addSecond(_(1,t.LB2,t.Wt1,x)),l.addSecond(_(-1,t.LB2,t.Wt1,x)),d.addSecond(_(1,t.Wt1,v,A)),d.addSecond(_(-1,t.Wt1,v,A)),d.addSecond(_(1,t.Wt1+t.Wt2,v,-A)),d.addSecond(_(-1,t.Wt1+t.Wt2,v,-A)),o.fig={faceSideWiWheels:s,faceSideWoWheels:i,faceTop:l,faceFront:d,faceWheel:h};const Y=o.partName;o.vol={extrudes:[{outName:`subpax_${Y}_sideWiW1`,face:`${Y}_faceSideWiWheels`,extrudeMethod:j.eLinearOrtho,length:t.Wt1,rotate:[A,0,0],translate:[0,t.Wt1,0]},{outName:`subpax_${Y}_sideWiW2`,face:`${Y}_faceSideWiWheels`,extrudeMethod:j.eLinearOrtho,length:t.Wt1,rotate:[A,0,0],translate:[0,t.Wt2+2*t.Wt1,0]},{outName:`subpax_${Y}_sideWoW`,face:`${Y}_faceSideWoWheels`,extrudeMethod:j.eLinearOrtho,length:t.Wt2,rotate:[A,0,0],translate:[0,t.Wt2+t.Wt1,0]},{outName:`subpax_${Y}_front`,face:`${Y}_faceFront`,extrudeMethod:j.eLinearOrtho,length:O,rotate:[A,0,A],translate:[-t.LB1,0,0]},{outName:`subpax_${Y}_top`,face:`${Y}_faceTop`,extrudeMethod:j.eLinearOrtho,length:m+k,rotate:[0,0,0],translate:[0,0,0]},{outName:`subpax_${Y}_wheel11`,face:`${Y}_faceWheel`,extrudeMethod:j.eRotate,rotate:[A,0,0],translate:[0,t.Wt1,v]},{outName:`subpax_${Y}_wheel12`,face:`${Y}_faceWheel`,extrudeMethod:j.eRotate,rotate:[-A,0,0],translate:[0,t.Wt1+t.Wt2,v]},{outName:`subpax_${Y}_wheel21`,face:`${Y}_faceWheel`,extrudeMethod:j.eRotate,rotate:[A,0,0],translate:[t.LB2,t.Wt1,v]},{outName:`subpax_${Y}_wheel22`,face:`${Y}_faceWheel`,extrudeMethod:j.eRotate,rotate:[-A,0,0],translate:[t.LB2,t.Wt1+t.Wt2,v]}],volumes:[{outName:`ipax_${Y}_side`,boolMethod:ee.eUnion,inList:[`subpax_${Y}_sideWiW1`,`subpax_${Y}_sideWiW2`,`subpax_${Y}_sideWoW`]},{outName:`ipax_${Y}_body`,boolMethod:ee.eIntersection,inList:[`ipax_${Y}_side`,`subpax_${Y}_front`,`subpax_${Y}_top`]},{outName:`pax_${Y}`,boolMethod:ee.eUnion,inList:[`ipax_${Y}_body`,`subpax_${Y}_wheel11`,`subpax_${Y}_wheel12`,`subpax_${Y}_wheel21`,`subpax_${Y}_wheel22`]}]},o.sub={},o.logstr+=`pcar drawn successfully!
`,o.calcErr=!1}catch(g){o.logstr+=g,console.log(g)}return o}var wn={pTitle:"pcar",pDescription:"the envelop of a passager car",pDef:Ss,pGeom:kn},_s={partName:"capsule",params:[e("L1","mm",5e3,1e3,2e4,1),e("WW1","mm",1800,100,4e3,1),e("E1","mm",10,1,100,1),Tt("Nose"),e("H1","mm",300,10,4e3,1),e("H2","mm",500,10,4e3,1),e("H3","mm",1200,10,4e3,1),e("W1","mm",300,10,4e3,1),e("W3","mm",1500,10,4e3,1),e("C3","mm",200,1,1e3,1),e("R1","mm",100,0,500,1),e("R2","mm",100,0,500,1),e("R3","mm",100,0,500,1),e("R4","mm",100,0,500,1),Tt("Wheels"),e("H0","mm",600,100,2e3,1),e("D7","mm",500,10,2e3,1),e("D8","mm",100,10,2e3,1),e("WW2","mm",1e3,100,4e3,1),e("WW3","mm",100,1,500,1),Tt("Wheels details"),e("W6","mm",500,10,2e3,1),e("W7","mm",600,10,2e3,1),e("W8","mm",300,10,2e3,1),e("H6","mm",300,10,2e3,1),Tt("Front window"),e("FH1","mm",600,10,3e3,1),e("FW1","mm",100,10,3e3,1),e("FR1","mm",100,0,500,1),e("FH3","mm",100,10,3e3,1),e("FW3","mm",300,10,3e3,1),e("FR3","mm",100,0,500,1),Tt("Top"),We("topStyle",["mirador","sky","roof"]),e("H5","mm",300,10,2e3,1),e("W4","mm",500,10,5e3,1),e("W5","mm",1e3,10,5e3,1),e("R5","mm",50,1,500,1),e("S5","mm",200,10,500,1),Tt("Wall"),Te("sideWall",!0),e("U1","mm",100,10,1e3,1),e("U2","mm",500,10,3e3,1),e("U3","mm",400,10,3e3,1),e("V1","mm",600,10,3e3,1),e("V2","mm",400,10,3e3,1),e("JR1","mm",100,0,2e3,1),e("JR2","mm",100,0,2e3,1),e("JR3","mm",100,0,2e3,1),e("JR4","mm",100,0,2e3,1),e("JR5","mm",100,0,2e3,1),e("JR6","mm",100,0,2e3,1)],paramSvg:{L1:"capsule_side.svg",WW1:"capsule_top.svg",E1:"capsule_nose.svg",H1:"capsule_nose.svg",H2:"capsule_nose.svg",H3:"capsule_nose.svg",W1:"capsule_nose.svg",W3:"capsule_nose.svg",C3:"capsule_nose.svg",R1:"capsule_nose.svg",R2:"capsule_nose.svg",R3:"capsule_nose.svg",R4:"capsule_nose.svg",H0:"capsule_side.svg",D7:"capsule_side.svg",D8:"capsule_side.svg",WW2:"capsule_wheels.svg",WW3:"capsule_wheels.svg",W6:"capsule_side.svg",W7:"capsule_side.svg",W8:"capsule_side.svg",H6:"capsule_side.svg",FH1:"capsule_wheels.svg",FW1:"capsule_wheels.svg",FR1:"capsule_wheels.svg",FH3:"capsule_wheels.svg",FW3:"capsule_wheels.svg",FR3:"capsule_wheels.svg",topStyle:"capsule_side.svg",H5:"capsule_nose.svg",W4:"capsule_nose.svg",W5:"capsule_top.svg",R5:"capsule_top.svg",S5:"capsule_top.svg",sideWall:"capsule_side.svg",U1:"capsule_wall.svg",U2:"capsule_wall.svg",U3:"capsule_wall.svg",V1:"capsule_wall.svg",V2:"capsule_wall.svg",JR1:"capsule_wall.svg",JR2:"capsule_wall.svg",JR3:"capsule_wall.svg",JR4:"capsule_wall.svg",JR5:"capsule_wall.svg",JR6:"capsule_wall.svg"},sim:{tMax:180,tStep:.5,tUpdate:500}};function Hn(c,t,r=""){const o=ae(_s.partName+r),s=U(),i=U(),l=U(),d=U(),h=U(),f=U(),a=U(),b=U();o.logstr+=`${o.partName} simTime: ${c}
`;try{let v=function(pt){const At=Mt(-u,t.H0);return pt?At.addSegStrokeR(G,0).addSegStrokeR(0,-X).addSegStrokeR(Ht,0).addSegStrokeR(0,X).addSegStrokeR(G,0):At.addSegStrokeR(t.L1,0),At.addCornerRounded(t.R1).addSegStrokeR(t.W1,t.H1).addCornerRounded(t.R2).addSegStrokeR(0,t.H2).addCornerRounded(t.R3).addPointR(vt.cx,vt.cy).addPointR(-t.W3,t.H3).addSegArc2().addCornerRounded(t.R4).addSegStrokeR(-Q,0).addCornerRounded(t.R4).addPointR(ft.cx,ft.cy).addPointR(-t.W3,-t.H3).addSegArc2().addCornerRounded(t.R3).addSegStrokeR(0,-t.H2).addCornerRounded(t.R2).closeSegStroke().addCornerRounded(t.R1),At},T=function(pt){return Mt(0,Vt).addSegStrokeR(pt*w,0).addSegStrokeR(0,t.WW3).addSegStrokeR(pt*(Dt-w),0).addSegStrokeR(0,2*Gt).addSegStrokeR(-pt*(Dt-w),0).addSegStrokeR(0,t.WW3).addSegStrokeR(-pt*w,0).closeSegStroke()},k=function(pt){return Mt(-C+yt-pt,-St).addPointR(pt,-pt).addSegArc(pt,!1,!0).addSegStrokeR($t,0).addPointR(pt,pt).addSegArc(pt,!1,!0).addSegStrokeR(0,Wt).addPointR(-pt,pt).addSegArc(pt,!1,!0).addSegStrokeR(-$t,0).addPointR(-pt,-pt).addSegArc(pt,!1,!0).closeSegStroke()},m=function(pt){const At=pt*(at/2-t.U1),Pe=t.H0+t.H1+t.H2-dt;return Mt(At,Pe).addCornerRounded(t.JR1).addPointR(pt*p.cx,p.cy).addPointR(-pt*Y,rt).addSegArc2().addCornerRounded(t.JR4).addSegStrokeR(-pt*t.U2,0).addCornerRounded(t.JR3).addSegStrokeR(0,-rt).addCornerRounded(t.JR2).closeSegStroke()},O=function(pt,At){return{outName:`subpax_${Rt}_wheel${At}`,face:`${Rt}_faceWheels`,extrudeMethod:j.eRotate,rotate:[0,0,0],translate:[pt,w,0]}},W=function(pt,At,Pe,$){return{outName:`subpax_${Rt}_topLeg${$}`,face:`${Rt}_faceTopLeg`,extrudeMethod:j.eLinearOrtho,length:I,rotate:[0,Pe,0],translate:[pt,0,At]}};var g=v,S=T,_=k,x=m,A=O,R=W;const F=Math.PI/2,ct=t.L1*t.WW1/10**6,u=t.L1/2,I=t.E1,J=2*I,G=t.W6+t.W7+t.W8,X=t.H0-t.H6,Ht=t.L1-2*G,Q=t.L1+2*t.W1-2*t.W3,ht=Math.atan2(t.H3,-t.W3),vt=Jt(0,0).translate(-t.W3/2,t.H3/2).translatePolar(ht-F,t.C3),gt=Math.atan2(-t.H3,-t.W3),ft=Jt(0,0).translate(-t.W3/2,-t.H3/2).translatePolar(gt-F,t.C3),st=Math.atan2(t.H1,-t.W1),et=I/Math.tan(st/2),E=I/Math.tan((3*F-st)/2),xt=F+Math.atan2(t.W3,t.H3),K=I/Math.tan(xt/2),ut=I/Math.tan((3*F-xt)/2),nt=t.W3-I+ut,tt=t.H3-I+K,Nt=Jt(0,0).translate(-nt/2,tt/2).translatePolar(ht-F,t.C3),Pt=Jt(0,0).translate(-nt/2,-tt/2).translatePolar(gt-F,t.C3),Ft=Math.max(0,t.R1-I),V=Math.max(0,t.R2-I),it=Math.max(0,t.R3-I),wt=Math.max(0,t.R4-I),dt=t.U1/Math.tan((3*F-st)/2),Y=t.W3-t.U1+t.U1/Math.tan((3*F-xt)/2),rt=t.H3-t.U1+t.U1/Math.tan(xt/2),p=Jt(0,0).translate(-Y/2,rt/2).translatePolar(ht-F,t.C3),at=t.L1+2*t.W1,kt=t.H1+t.H2+t.H3,Ot=at-2*(t.U1+Y+t.U2+t.U3),It=kt-t.V1-t.V2,w=t.D7/2,Dt=t.D8/2,B=u-t.W8,bt=B-t.W7,L=t.WW1/2,Gt=t.WW2/2,Vt=L-Gt-t.WW3,q=[-B,-bt,B,bt],H=-Vt-Gt-t.WW3,y=Q-2*t.W4,C=y/2,P=t.H0+t.H1+t.H2+t.H3,Z=P+t.H5,D=Z+I,ot=t.W5/2,Wt=t.R5*3,St=Wt/2,yt=ot-St,$t=y-2*yt,lt=t.H5-4*t.R5,Lt=t.H6+I,qt=Ht-2*I,Xt=qt/2,Zt=X-I,Et=t.H0+t.H1+t.H2,mt=t.WW1-2*t.FW1,Ut=t.WW1-2*t.FW3,Kt=kt-t.FH1-t.FH3,zt=at+200;if(t.L1-2*G<2*I)throw`err176: L1 ${n(t.L1)} is too small compare to W6 ${n(t.W6)}, W7 ${n(t.W7)} and W8 ${n(t.W8)} mm`;if(X<I)throw`err114: Hbatterie ${n(X)} is too small compare to E1 ${n(I)} mm`;if(Ht<2*I)throw`err118: Lbatterie ${n(Ht)} is too small compare to E1 ${n(I)} mm`;if(y<3*t.R5+t.W5)throw`err122: L5 ${n(y)} is too small compare to W5 ${n(t.W5)} and R5 ${n(t.R5)} mm`;if(lt<.1)throw`err220: H5 ${n(t.H5)} is too small compare to R5 ${n(t.R5)} mm`;o.logstr+=`Platform surface: ${n(ct)} m2, height: ${n(D/1e3)} m
`,o.logstr+=`Lroof: ${n(Q)}, L5: ${n(y)} mm
`,o.logstr+=`Ltotal: ${n(at/1e3)}, Htotal: ${n(kt/1e3)} m
`,o.logstr+=`Batterie: LbatInt ${n(qt)}, HbatInt: ${n(Zt)}, WW1 ${n(t.WW1)} mm
`;const ne=v(!0),he=Mt(-u+et,t.H0+I).addSegStrokeR(2*u-2*et,0).addCornerRounded(Ft).addSegStrokeR(t.W1-I+et,t.H1-I+E).addCornerRounded(V).addSegStrokeR(0,t.H2-2*E).addCornerRounded(it).addPointR(Nt.cx,Nt.cy).addPointR(-nt,tt).addSegArc2().addCornerRounded(wt).addSegStrokeR(-Q+2*ut,0).addCornerRounded(wt).addPointR(Pt.cx,Pt.cy).addPointR(-nt,-tt).addSegArc2().addCornerRounded(it).addSegStrokeR(0,-t.H2+2*E).addCornerRounded(V).closeSegStroke().addCornerRounded(Ft),oe=M(-Xt,Lt,qt,Zt);s.addMainOI([ne,he,oe]),s.addSecond(z(-B,w,w)),s.addSecond(z(-B,w,Dt)),s.addSecond(z(-bt,w,w)),s.addSecond(z(-bt,w,Dt)),s.addSecond(z(B,w,w)),s.addSecond(z(B,w,Dt)),s.addSecond(z(bt,w,w)),s.addSecond(z(bt,w,Dt)),s.addSecond(M(-C,P,y,t.H5)),s.addSecond(M(-C-t.S5,Z,y+2*t.S5,I)),i.addMainO(T(1)),i.addSecond(T(-1));const re=Mt(-mt/2,t.H0+t.FH1).addCornerRounded(t.FR1).addSegStrokeR(mt,0).addCornerRounded(t.FR1).addSegStrokeR(t.FW1-t.FW3,Kt).addCornerRounded(t.FR3).addSegStrokeR(-Ut,0).addCornerRounded(t.FR3).closeSegStroke();l.addMainO(re),l.addSecond(T(1).rotate(0,0,F).translate(L,w)),l.addSecond(T(-1).rotate(0,0,F).translate(L,w)),l.addSecond(M(-L,t.H6,t.WW1,X)),l.addSecond(M(-L,t.H0,t.WW1,t.H1)),l.addSecond(M(-L,t.H0+t.H1,t.WW1,t.H2)),l.addSecond(M(-L,Et,t.WW1,t.H3)),l.addSecond(M(-ot,P,t.W5,t.H5)),l.addSecond(M(-ot-t.S5,Z,t.W5+2*t.S5,I)),l.addSecond(M(-L+I,t.H0+I,t.WW1-J,kt-J));const fe=k(yt-I),$e=k(yt),ce=k(yt+t.S5);d.addMainOI([$e,fe]),d.addSecond(ce),d.addSecond(M(-Q/2,-L,Q,2*L)),d.addSecond(M(-at/2,-L,at,2*L)),d.addSecond(T(1).translate(q[0],H)),d.addSecond(T(1).translate(q[1],H)),d.addSecond(T(1).translate(q[2],H)),d.addSecond(T(1).translate(q[3],H)),d.addSecond(T(-1).translate(q[0],H)),d.addSecond(T(-1).translate(q[1],H)),d.addSecond(T(-1).translate(q[2],H)),d.addSecond(T(-1).translate(q[3],H)),h.addMainO(fe),h.mergeFigure(d,!0),f.addMainO(ce),f.mergeFigure(d,!0);const ue=Mt(-St,P).addSegStrokeR(Wt,0).addSegStrokeR(0,t.R5).addPointR(-t.R5,t.R5).addSegArc(t.R5,!1,!1).addSegStrokeR(0,lt).addPointR(t.R5,t.R5).addSegArc(t.R5,!1,!1).addSegStrokeR(0,t.R5).addSegStrokeR(-Wt,0).addSegStrokeR(0,-t.R5).addPointR(t.R5,-t.R5).addSegArc(t.R5,!1,!1).addSegStrokeR(0,-lt).addPointR(-t.R5,-t.R5).addSegArc(t.R5,!1,!1).closeSegStroke();a.addMainO(ue),l.addSecond(ue);const xe=Mt(-Ot/2,t.H0+t.V1).addCornerRounded(t.JR5).addSegStrokeR(Ot,0).addCornerRounded(t.JR5).addSegStrokeR(0,It).addCornerRounded(t.JR6).addSegStrokeR(-Ot,0).addCornerRounded(t.JR6).closeSegStroke();b.addMainOI([v(!1),m(1),m(-1),xe]),b.mergeFigure(s,!0),o.fig={faceBody:s,faceWheels:i,faceFront:l,faceTop:d,faceTopInt:h,faceTopTop:f,faceTopLeg:a,faceWall:b};const Rt=o.partName,_e=[];t.topStyle===0&&_e.push(`subpax_${Rt}_top1`,`subpax_${Rt}_top2`,`subpax_${Rt}_topTop`,`subpax_${Rt}_topLeg1`,`subpax_${Rt}_topLeg2`,`subpax_${Rt}_topLeg3`,`subpax_${Rt}_topLeg4`,`subpax_${Rt}_topLeg5`,`subpax_${Rt}_topLeg6`);const He=[];t.topStyle!==2&&He.push(`subpax_${Rt}_topInt`);const Le=[];t.sideWall===1&&Le.push(`subpax_${Rt}_wall1`,`subpax_${Rt}_wall2`),o.vol={extrudes:[{outName:`subpax_${Rt}_body`,face:`${Rt}_faceBody`,extrudeMethod:j.eLinearOrtho,length:t.WW1,rotate:[0,0,0],translate:[0,0,0]},O(q[0],"1"),O(q[1],"2"),O(q[2],"3"),O(q[3],"4"),{outName:`subpax_${Rt}_frontWin`,face:`${Rt}_faceFront`,extrudeMethod:j.eLinearOrtho,length:zt,rotate:[0,F,0],translate:[-zt/2,0,L]},{outName:`subpax_${Rt}_topInt`,face:`${Rt}_faceTopInt`,extrudeMethod:j.eLinearOrtho,length:3*I,rotate:[-F,0,0],translate:[0,P-2*I,L]},{outName:`subpax_${Rt}_top1`,face:`${Rt}_faceTop`,extrudeMethod:j.eLinearOrtho,length:t.R5,rotate:[-F,0,0],translate:[0,P,L]},{outName:`subpax_${Rt}_top2`,face:`${Rt}_faceTop`,extrudeMethod:j.eLinearOrtho,length:t.R5,rotate:[-F,0,0],translate:[0,Z-t.R5,L]},{outName:`subpax_${Rt}_topTop`,face:`${Rt}_faceTopTop`,extrudeMethod:j.eLinearOrtho,length:I,rotate:[-F,0,0],translate:[0,Z,L]},W(-C,L,F,"1"),W(C-I,L,F,"2"),W(-$t/2+St,L-ot,0,"3"),W(-$t/2+St,L+ot-I,0,"4"),W($t/2-St,L-ot,0,"5"),W($t/2-St,L+ot-I,0,"6"),{outName:`subpax_${Rt}_wall1`,face:`${Rt}_faceWall`,extrudeMethod:j.eLinearOrtho,length:I,rotate:[0,0,0],translate:[0,0,0]},{outName:`subpax_${Rt}_wall2`,face:`${Rt}_faceWall`,extrudeMethod:j.eLinearOrtho,length:I,rotate:[0,0,0],translate:[0,0,t.WW1-I]}],volumes:[{outName:`ipax_${Rt}_plus`,boolMethod:ee.eUnion,inList:[`subpax_${Rt}_body`,`subpax_${Rt}_wheel1`,`subpax_${Rt}_wheel2`,`subpax_${Rt}_wheel3`,`subpax_${Rt}_wheel4`,..._e,...Le]},{outName:`ipax_${Rt}_minus`,boolMethod:ee.eUnion,inList:[`subpax_${Rt}_frontWin`,...He]},{outName:`pax_${Rt}`,boolMethod:ee.eSubstraction,inList:[`ipax_${Rt}_plus`,`ipax_${Rt}_minus`]}]},o.sub={},o.logstr+=`capsule drawn successfully!
`,o.calcErr=!1}catch(v){o.logstr+=v,console.log(v)}return o}var Ln={pTitle:"capsule",pDescription:"high-level concept of the train-capsule",pDef:_s,pGeom:Hn},xs={partName:"tunnel",params:[e("W1","mm",2e3,500,1e4,10),e("H1","mm",4e3,500,1e4,10),e("a1","degree",75,45,100,1),Tt("Stone"),e("T1","mm",400,100,1e3,1),e("T2","mm",200,100,1e3,1),e("T3Max","mm",400,100,1e3,1),e("E1","mm",5,0,50,1)],paramSvg:{W1:"tunnel_profile.svg",H1:"tunnel_profile.svg",a1:"tunnel_profile.svg",T1:"tunnel_profile.svg",T2:"tunnel_profile.svg",T3Max:"tunnel_profile.svg",E1:"tunnel_profile.svg"},sim:{tMax:180,tStep:.5,tUpdate:500}};function An(c,t,r=""){const o=ae(xs.partName+r),s=U(),i=U(),l=U(),d=U();o.logstr+=`${o.partName} simTime: ${c}
`;try{let g=function(H,y){const C=H*(1+k)/T,P=T**2/(1+k),Z=(y-C)*P,D=(H*T+Z*k)/T**2,ot=D*k,Wt=Z/Math.tan(v);return[Z,D,ot,Wt]},S=function(H,y,C){const P=H+C*st;let Z=P+C*(y-ft),D=!1;Math.abs(Z)>xt&&(Z=C*xt,D=!0);const ot=Math.min(0,-(C*P-R)*m),Wt=Math.min(0,-(C*Z-R)*m),St=Mt(P,-et);return D?St.addSegStrokeA(C*G,-et).addSegStrokeA(Z,Wt):St.addSegStrokeA(Z,-et).addSegStrokeA(Z,Wt),Math.abs(P)<R&&Math.abs(Z)>R&&St.addSegStrokeA(C*R,0),St.addSegStrokeA(P,ot).closeSegStroke(),St},_=function(H,y,C){const P=C===1?v:Math.PI-v,Z=Jt(C*R,0).translatePolar(P,H+st);return Mt(Z.cx,Z.cy).addSegStrokeRP(P-C*A,et).addSegStrokeRP(P,y-ft).addSegStrokeRP(P+C*A,et).closeSegStroke()},x=function(H,y,C){const P=-A+C*(v+H/Q),Z=P+C*y/Q,D=Jt(0,u).translatePolar(P,W).translatePolar(P+C*A,st),ot=D.translatePolar(P,et),Wt=Jt(0,u).translatePolar(Z,W).translatePolar(Z-C*A,st),St=Wt.translatePolar(Z,et);return Mt(D.cx,D.cy).addSegStrokeA(ot.cx,ot.cy).addSegStrokeA(St.cx,St.cy).addSegStrokeA(Wt.cx,Wt.cy).closeSegStroke()};var h=g,f=S,a=_,b=x;const A=Math.PI/2,R=t.W1/2,v=we(t.a1),T=Math.sin(v),k=Math.cos(v),m=Math.tan(A-v),[O,W,F,ct]=g(R,t.H1),u=O+F,I=u+W,J=t.T2+t.E1,G=R+t.T1*Math.tan(v/2),X=t.H1+2*t.T1,[Ht,Q,ht,vt]=g(G,X),gt=Ht+ht+Q,ft=t.E1,st=ft/2,et=t.T1,E=t.T3Max,xt=G+(et-(G-R)*m)/(m+Math.tan(v)),K=et/Math.tan(v),ut=G+K,nt=Math.floor(ut/E),tt=ut-nt*E,Nt=G+K-E/2,Pt=Math.floor(Nt/E),Ft=Nt-Pt*E,V=O/T,it=V-E/2,wt=Math.floor(it/E),dt=it-wt*E,Y=Math.floor(V/E),rt=V-Y*E,p=Q*(Math.PI-v),at=Math.floor(p/E),kt=p-at*E,Ot=p-E/2,It=Math.floor(Ot/E),w=Ot-It*E,Dt=W**2*(Math.PI-v),B=u*W*T,bt=R*O,L=(Dt+B+bt)*10**-6;if(Math.abs(t.H1-I)>.1)throw`err086: H1 ${n(t.H1)} and H1ib ${n(I)} are not equal`;if(Math.abs(X-gt)>.1)throw`err102: H1e ${n(X)} and H1eb ${n(gt)} are not equal`;if(Math.abs(Ht+ht-t.T1-u)>.1)throw`err106: H2e ${n(Ht)} and BCe ${n(ht)} not match the other circle center`;o.logstr+=`Surface ${n(L)} m2
`,o.logstr+=`dbg131: AsN ${n(wt)} stones
`;const Gt=Mt(-R,0).addSegStrokeR(2*R,0).addSegStrokeR(ct,O).addPointR(-ct-R,F+W).addPointR(-2*(ct+R),0).addSegArc2().closeSegStroke(),Vt=Mt(-G,-t.T1).addSegStrokeR(2*G,0).addSegStrokeR(vt,Ht).addPointR(-vt-G,ht+Q).addPointR(-2*(vt+G),0).addSegArc2().closeSegStroke();s.addMainOI([Vt,Gt]),s.addSecond(z(0,u,W)),i.addMainOI([M(0,-t.T1,t.T2,t.H1+2*t.T1),M(0,0,t.T2,t.H1)]),i.addMainOI([M(J,-t.T1,t.T2,t.H1+2*t.T1),M(J,0,t.T2,t.H1)]);for(let H=0;H<nt;H++){const y=tt+H*E;l.addMainO(S(y,E,1)),l.addMainO(S(-y,E,-1))}tt>st&&(2*tt<E?l.addMainO(S(-tt,2*tt,1)):(l.addMainO(S(0,tt,-1)),l.addMainO(S(0,tt,1)))),d.addMainO(S(Ft+Pt*E,E/2,1)),d.addMainO(S(-Ft-Pt*E,E/2,-1));for(let H=0;H<Pt;H++){const y=Ft+H*E;d.addMainO(S(y,E,1)),d.addMainO(S(-y,E,-1))}Ft>st&&(2*Ft<E?d.addMainO(S(-Ft,2*Ft,1)):(d.addMainO(S(0,Ft,1)),d.addMainO(S(0,Ft,-1)))),l.addMainO(_(0,E/2,1)),l.addMainO(_(0,E/2,-1));for(let H=0;H<wt;H++)l.addMainO(_(E/2+H*E,E,1)),l.addMainO(_(E/2+H*E,E,-1));dt>ft&&(l.addMainO(_(E/2+wt*E,dt,1)),l.addMainO(_(E/2+wt*E,dt,-1)));for(let H=0;H<Y;H++)d.addMainO(_(H*E,E,1)),d.addMainO(_(H*E,E,-1));rt>ft&&(d.addMainO(_(Y*E,rt,1)),d.addMainO(_(Y*E,rt,-1)));for(let H=0;H<at;H++)l.addMainO(x(H*E,E,1)),l.addMainO(x(H*E,E,-1));kt>ft&&(kt<E/2?l.addMainO(x(at*E,2*kt,1)):(l.addMainO(x(at*E,kt,1)),l.addMainO(x(at*E,kt,-1)))),d.addMainO(x(0,E/2,1)),d.addMainO(x(0,E/2,-1));for(let H=0;H<It;H++)d.addMainO(x(E/2+H*E,E,1)),d.addMainO(x(E/2+H*E,E,-1));w>ft&&(w<E/2?d.addMainO(x(E/2+It*E,2*w,1)):(d.addMainO(x(E/2+It*E,w,1)),d.addMainO(x(E/2+It*E,w,-1)))),l.mergeFigure(s,!0),d.mergeFigure(l,!0),o.fig={faceProfile:s,faceSlice:i,faceStoneA:l,faceStoneB:d};const q=o.partName;o.vol={extrudes:[{outName:`subpax_${q}_A`,face:`${q}_faceStoneA`,extrudeMethod:j.eLinearOrtho,length:t.T2,rotate:[0,0,0],translate:[0,0,0]},{outName:`subpax_${q}_B`,face:`${q}_faceStoneB`,extrudeMethod:j.eLinearOrtho,length:t.T2,rotate:[0,0,0],translate:[0,0,J]}],volumes:[{outName:`pax_${q}`,boolMethod:ee.eUnion,inList:[`subpax_${q}_A`,`subpax_${q}_B`]}]},o.sub={},o.logstr+=`tunnel drawn successfully!
`,o.calcErr=!1}catch(g){o.logstr+=g,console.log(g)}return o}var yn={pTitle:"tunnel",pDescription:"tunnel for the train-capsule",pDef:xs,pGeom:An},$s={partName:"bridge",params:[e("N1","arc",9,1,100,1),e("W1","m",20,1,100,.1),e("W2","m",2,1,100,.1),e("H1","m",2,1,100,.1),e("H2","m",30,1,100,.1),We("arcStyle",["gothic","half-circle","rectangular"]),e("Ea","m",10,1,100,.1),Tt("Transversal"),e("W3","m",10,1,100,1),e("W4","m",18,1,100,1),e("H3","m",5,1,500,1),e("H4","m",20,1,500,1),We("sideStyle",["straight","arc"]),Tt("Valley extremity"),e("Ix1","m",5,0,50,.1),e("Ih11","m",2,1,50,1),e("Ih12","m",2,1,50,1),e("Ix2","m",5,0,50,.1),e("Ih21","m",2,1,50,1),e("Ih22","m",2,1,50,1),Tt("Valley"),e("p1x","%",20,1,99,1),e("p1y","m",-24,-300,10,1),e("p2x","%",40,1,99,1),e("p2y","m",-18,-300,10,1),e("p3x","%",60,1,99,1),e("p3y","m",-31,-300,10,1),e("p4x","%",80,1,99,1),e("p4y","m",-25,-300,10,1)],paramSvg:{N1:"bridge_panorama.svg",W1:"bridge_panorama.svg",W2:"bridge_panorama.svg",H1:"bridge_panorama.svg",H2:"bridge_panorama.svg",arcStyle:"bridge_arc.svg",Ea:"bridge_column.svg",W3:"bridge_column.svg",W4:"bridge_column.svg",H3:"bridge_column.svg",H4:"bridge_column.svg",sideStyle:"bridge_column.svg",Ix1:"bridge_panorama.svg",Ih11:"bridge_panorama.svg",Ih12:"bridge_panorama.svg",Ix2:"bridge_panorama.svg",Ih21:"bridge_panorama.svg",Ih22:"bridge_panorama.svg",p1x:"bridge_panorama.svg",p1y:"bridge_panorama.svg",p2x:"bridge_panorama.svg",p2y:"bridge_panorama.svg",p3x:"bridge_panorama.svg",p3y:"bridge_panorama.svg",p4x:"bridge_panorama.svg",p4y:"bridge_panorama.svg"},sim:{tMax:180,tStep:.5,tUpdate:500}};function Nn(c,t,r=""){const o=ae($s.partName+r),s=U(),i=U(),l=U();o.logstr+=`${o.partName} simTime: ${c}
`;try{const d=Math.PI/2,h=t.W1/2,f=t.W2/2,a=t.W3/2,b=t.W4/2,g=h+t.Ea,S=t.H1+t.H2,_=t.W2+t.N1*(t.W1+t.W2),x=_-t.Ix1-t.Ix2,A=S-t.H3-t.H4,v=[t.p1x,t.p2x,t.p3x,t.p4x].map(u=>t.Ix1+x*u/100),T=[t.p1y,t.p2y,t.p3y,t.p4y];if(t.H2<h&&t.arcStyle===1)throw`err116: H2 ${t.H2} is too small compare to W1 ${t.W1} m`;if(t.H2<g&&t.arcStyle===0)throw`err125: H2 ${t.H2} is too small compare to W1 ${t.W1} and Ea ${t.Ea} m`;if(t.W4<t.W3)throw`err129: W4 ${t.W4} is too small compare to W3 ${t.W3} m`;if(A<0)throw`err133: H2 ${t.H2} is too small compare to H3 ${t.H3} or H4 ${t.H4} m`;if(x<0)throw`err139: N1 ${t.N1} is too small compare to Ix1 ${t.Ix1} or Ix2 ${t.Ix2} m`;for(let u=0;u<v.length-1;u++)if(v[u+1]<v[u])throw`err145: vx${u+1} ${v[u+1]} is smaller than vx${u} ${v[u]} m`;o.logstr+=`Bridge length: ${n(x)} m
`;const k=Mt(0,0).addSegStrokeR(0,-S).addSegStrokeR(t.W2,0);for(let u=0;u<t.N1;u++)switch(t.arcStyle){case 1:k.addSegStrokeR(0,t.H2-h).addPointR(h,h).addPointR(2*h,0).addSegArc2().addSegStrokeR(0,-t.H2+h).addSegStrokeR(t.W2,0),i.addSecond(M(-a,-t.H1-h,2*a,h));break;case 0:k.addSegStrokeR(0,t.H2-g).addPointR(h,g).addSegArc3(d,!0).addPointR(h,-g).addSegArc3(d,!1).addSegStrokeR(0,-t.H2+g).addSegStrokeR(t.W2,0),i.addSecond(M(-a,-t.H1-g,2*a,g));break;default:k.addSegStrokeR(0,t.H2).addSegStrokeR(t.W1,0).addSegStrokeR(0,-t.H2).addSegStrokeR(t.W2,0),i.addSecond(M(-a,-t.H1,2*a,t.H1))}k.addSegStrokeR(0,S).closeSegStroke(),s.addMainO(k);for(let u=0;u<t.N1+1;u++){const I=u*(t.W2+t.W1);s.addSecond(M(I,-t.H3-A,t.W2,A)),s.addSecond(M(I,-S,t.W2,t.H4))}const m=Mt(-b,-S).addSegStrokeR(2*b,0).addSegStrokeR(0,t.H4);t.sideStyle===1?m.addPointR(-b+a,A).addSegArc3(-d,!1):m.addSegStrokeR(-b+a,A),m.addSegStrokeR(0,t.H3).addSegStrokeR(-t.W3,0).addSegStrokeR(0,-t.H3),t.sideStyle===1?m.addPointR(a-b,-A).addSegArc3(-d,!0):m.addSegStrokeR(a-b,-A),m.closeSegStroke(),i.addMainO(m);const O=Mt(-2*f,t.Ih11).addSegStrokeR(2*f+t.Ix1,0).addSegStrokeR(0,-t.Ih11-t.Ih12);for(let u=0;u<v.length;u++)O.addSegStrokeA(v[u],T[u]);O.addSegStrokeA(_-t.Ix2,-t.Ih22).addSegStrokeR(0,t.Ih21+t.Ih22).addSegStrokeR(2*f+t.Ix2,0).addSegStrokeR(0,-t.Ih21-S-t.H1).addSegStrokeR(-_-4*f,0).closeSegStroke(),l.addMainO(O),l.addSecond(k),s.addSecond(O),o.fig={faceArcade:s,faceColumn:i,faceValley:l};const W=o.partName,F=[],ct=[];for(let u=0;u<t.N1+1;u++){const I=u*(t.W2+t.W1),J=`subpax_${W}_col${String(u).padStart(3,"0")}`,G={outName:J,face:`${W}_faceColumn`,extrudeMethod:j.eLinearOrtho,length:2*f,rotate:[0,d,0],translate:[I,0,0]};F.push(G),ct.push(J)}o.vol={extrudes:[{outName:`subpax_${W}_arcade`,face:`${W}_faceArcade`,extrudeMethod:j.eLinearOrtho,length:2*a,rotate:[0,0,0],translate:[0,0,-a]},...F,{outName:`subpax_${W}_valley`,face:`${W}_faceValley`,extrudeMethod:j.eLinearOrtho,length:4*b,rotate:[0,0,0],translate:[0,0,-2*b]}],volumes:[{outName:`pax_${W}`,boolMethod:ee.eUnion,inList:[`subpax_${W}_arcade`,...ct,`subpax_${W}_valley`]}]},o.sub={},o.logstr+=`bridge drawn successfully!
`,o.calcErr=!1}catch(d){o.logstr+=d,console.log(d)}return o}var Dn={pTitle:"bridge",pDescription:"bridge for the train-capsule",pDef:$s,pGeom:Nn},Rs={partName:"trackXY",params:[e("W1","mm",1e3,10,2e3,1),e("T1","mm",80,1,200,1),e("S1","mm",200,1,500,1),e("B1","mm",200,2,500,1),e("B2","mm",300,2,1e3,1),e("H1","mm",100,1,500,1),e("H2","mm",200,1,500,1),Tt("Track"),e("a0","degree",30,-180,180,1),e("a1","degree",-120,-180,180,1),e("a2","degree",70,-180,180,1),e("L1","m",30,.01,200,.01),e("L2","m",1,.01,200,.01),e("L3","m",20,.01,200,.01),e("r1","m",10,.01,200,.01),e("r2","m",20,.01,200,.01)],paramSvg:{W1:"trackXY_section.svg",T1:"trackXY_section.svg",S1:"trackXY_top.svg",B1:"trackXY_top.svg",B2:"trackXY_top.svg",H1:"trackXY_side.svg",H2:"trackXY_side.svg",a0:"trackXY_midLine.svg",a1:"trackXY_midLine.svg",a2:"trackXY_midLine.svg",L1:"trackXY_midLine.svg",L2:"trackXY_midLine.svg",L3:"trackXY_midLine.svg",r1:"trackXY_midLine.svg",r2:"trackXY_midLine.svg"},sim:{tMax:180,tStep:.5,tUpdate:500}};function En(c,t,r=""){const o=ae(Rs.partName+r),s=U(),i=U(),l=U(),d=U();o.logstr+=`${o.partName} simTime: ${c}
`;try{let a=function(B,bt,L){return M(B-Q,bt-ht,2*Q,2*ht).rotate(B,bt,L)},b=function(B,bt,L){const Gt=S+L*g,Vt=S-Math.sign(_)*g,q=S-Math.sign(_)*g+_/2,H=S-Math.sign(_)*g+_,y=T-Math.sign(x)*g,C=T-Math.sign(x)*g+x/2,P=T-Math.sign(x)*g+x,Z=L*Math.sign(_)*B,D=L*Math.sign(_)*(B+bt),ot=L*Math.sign(x)*B,Wt=L*Math.sign(x)*(B+bt),St=Jt(0,0).translatePolar(Gt,B),yt=rt.translatePolar(q,t.r1-D),$t=rt.translatePolar(H,t.r1-D),lt=kt.translatePolar(C,t.r2-Wt),Lt=kt.translatePolar(P,t.r2-Wt),qt=kt.translatePolar(C,t.r2-ot),Xt=kt.translatePolar(y,t.r2-ot),Zt=rt.translatePolar(q,t.r1-Z),Et=rt.translatePolar(Vt,t.r1-Z);return Mt(St.cx,St.cy).addSegStrokeRP(Gt,bt).addSegStrokeRP(S,t.L1).addPointA(yt.cx,yt.cy).addPointA($t.cx,$t.cy).addSegArc2().addSegStrokeRP(T,t.L2).addPointA(lt.cx,lt.cy).addPointA(Lt.cx,Lt.cy).addSegArc2().addSegStrokeRP(k,t.L3).addSegStrokeRP(k+g,bt).addSegStrokeRP(k+Math.PI,t.L3).addPointA(qt.cx,qt.cy).addPointA(Xt.cx,Xt.cy).addSegArc2().addSegStrokeRP(T+Math.PI,t.L2).addPointA(Zt.cx,Zt.cy).addPointA(Et.cx,Zt.cy).addSegArc2().closeSegStroke()};var h=a,f=b;const g=Math.PI/2,S=we(t.a0),_=we(t.a1),x=we(t.a2),A=Math.abs(_)*t.r1,R=Math.abs(x)*t.r2,v=t.L1+A+t.L2+R+t.L3,T=S+_,k=T+x,[m,O]=Ue(t.r1,_,t.r1),[W,F]=Ue(t.r2,x,t.r2);o.logstr+=O+F;const ct=_/2,u=x/2,I=t.H1/1e3,J=t.H2/1e3,G=t.W1/2e3,X=t.T1/1e3,Ht=t.S1/1e3,Q=t.B1/2e3,ht=G+X+Ht,vt=(t.B1+t.B2)/1e3,gt=Math.floor(t.L1/vt),ft=t.L1-gt*vt,st=Math.floor((ft+A)/vt),et=ft+A-st*vt,E=Math.sign(_)*vt/t.r1,xt=Math.sign(_)*ft/t.r1,K=Math.floor((et+t.L2)/vt),ut=et+t.L2-K*vt,nt=Math.floor((ut+R)/vt),tt=ut+R-nt*vt,Nt=Math.sign(x)*vt/t.r2,Pt=Math.sign(x)*ut/t.r2,Ft=Math.floor((tt+t.L3)/vt),V=1+Math.floor(v/vt),it=1+gt+st+K+nt+Ft;if(Math.abs(t.a1)<.5)throw`err102: a1 ${t.a1} degree is too closed to zero`;if(Math.abs(t.a2)<.5)throw`err112: a2 ${t.a2} degree is too closed to zero`;o.logstr+=`Track-XY length: ${n(v)} m
`,o.logstr+=`Beam number: ${V} ${it}, size: ${n(2*ht)} x ${n(2*Q)} m
`,o.logstr+=`Final orientation: ${n(Qt(k))} degree
`;const wt=Mt(0,0).addSegStrokeRP(S,t.L1).addPointRP(S+ct,m).addSegArc3(S,!0).addSegStrokeRP(T,t.L2).addPointRP(T+u,W).addSegArc3(T,!0).addSegStrokeRP(k,t.L3);s.addSecond(wt);const dt=Jt(0,0);s.addMainO(a(dt.cx,dt.cy,S));for(let B=0;B<gt;B++){const bt=dt.translatePolar(S,(B+1)*vt);s.addMainO(a(bt.cx,bt.cy,S))}const Y=dt.translatePolar(S,t.L1),rt=Y.translatePolar(S+Math.sign(_)*g,t.r1);for(let B=0;B<st;B++){const bt=S-Math.sign(_)*g-xt+(B+1)*E,L=rt.translatePolar(bt,t.r1);s.addMainO(a(L.cx,L.cy,bt-g))}const p=Y.translatePolar(S+ct,m);for(let B=0;B<K;B++){const bt=p.translatePolar(T,(B+1)*vt-et);s.addMainO(a(bt.cx,bt.cy,T))}const at=p.translatePolar(T,t.L2),kt=at.translatePolar(T+Math.sign(x)*g,t.r2);for(let B=0;B<nt;B++){const bt=T-Math.sign(x)*g-Pt+(B+1)*Nt,L=kt.translatePolar(bt,t.r2);s.addMainO(a(L.cx,L.cy,bt-g))}const Ot=at.translatePolar(T+u,W);for(let B=0;B<Ft;B++){const bt=Ot.translatePolar(k,(B+1)*vt-tt);s.addMainO(a(bt.cx,bt.cy,k))}s.addPoint(Jt(rt.cx,rt.cy,ho.eTri2)),s.addPoint(Jt(kt.cx,kt.cy,ho.eTri2)),i.mergeFigure(s,!0);const It=b(G,X,-1),w=b(G,X,1);i.addMainO(It),i.addMainO(w),s.addSecond(It),s.addSecond(w),l.addSecond(M(-ht,0,2*ht,I)),l.addMainO(M(-ht+Ht,I,X,J)),l.addMainO(M(G,I,X,J));for(let B=0;B<11;B++)d.addSecond(M(B*vt,0,2*Q,I));d.addMainO(M(0,I,2*Q+10*vt,J)),o.fig={faceTop1:s,faceTop2:i,faceSide:d,faceSection:l};const Dt=o.partName;o.vol={extrudes:[{outName:`subpax_${Dt}_beam`,face:`${Dt}_faceTop1`,extrudeMethod:j.eLinearOrtho,length:I,rotate:[0,0,0],translate:[0,0,0]},{outName:`subpax_${Dt}_rail`,face:`${Dt}_faceTop2`,extrudeMethod:j.eLinearOrtho,length:J,rotate:[0,0,0],translate:[0,0,I]}],volumes:[{outName:`pax_${Dt}`,boolMethod:ee.eUnion,inList:[`subpax_${Dt}_beam`,`subpax_${Dt}_rail`]}]},o.sub={},o.logstr+=`trackXY drawn successfully!
`,o.calcErr=!1}catch(a){o.logstr+=a,console.log(a)}return o}var Cn={pTitle:"trackXY",pDescription:"simulation of train-capsule on XY-track",pDef:Rs,pGeom:En},Ms={partName:"trackXZ",params:[e("W1","mm",1e3,10,2e3,1),e("T1","mm",80,1,200,1),e("S1","mm",200,1,500,1),e("B1","mm",200,2,500,1),e("B2","mm",300,2,1e3,1),e("H1","mm",100,1,500,1),e("H2","mm",200,1,500,1),Tt("Slope"),e("a1","%",5,-90,90,1),e("a3","%",20,-90,90,1),e("a5","%",2,-90,90,1),e("L1","m",30,.01,200,.01),e("L2","m",5,.01,200,.01),e("L3","m",20,.01,200,.01),e("L4","m",3,.01,200,.01),e("L5","m",20,.01,200,.01)],paramSvg:{W1:"trackXZ_section.svg",T1:"trackXZ_section.svg",S1:"trackXZ_top.svg",B1:"trackXZ_top.svg",B2:"trackXZ_top.svg",H1:"trackXZ_side.svg",H2:"trackXZ_side.svg",a1:"trackXZ_slope.svg",a3:"trackXZ_slope.svg",a5:"trackXZ_slope.svg",L1:"trackXZ_slope.svg",L2:"trackXZ_slope.svg",L3:"trackXZ_slope.svg",L4:"trackXZ_slope.svg",L5:"trackXZ_slope.svg"},sim:{tMax:180,tStep:.5,tUpdate:500}};function On(c,t,r=""){const o=ae(Ms.partName+r),s=U(),i=U(),l=U(),d=U();o.logstr+=`${o.partName} simTime: ${c}
`;try{let f=function(Lt,qt,Xt){const Zt=Jt(Lt,qt).translatePolar(Xt+2*a,R);return Mt(Zt.cx,Zt.cy).addSegStrokeRP(Xt,2*R).addSegStrokeRP(Xt+a,g).addSegStrokeRP(Xt+2*a,2*R).addSegStrokeRP(Xt-a,g).closeSegStroke()};var h=f;const a=Math.PI/2,b=t.L1+t.L2+t.L3+t.L4+t.L5,g=t.H1/1e3,S=t.H2/1e3,_=t.W1/2e3,x=t.T1/1e3,A=t.S1/1e3,R=t.B1/2e3,v=_+x+A,T=(t.B1+t.B2)/1e3,k=Math.asin(t.a1/100),m=Math.asin(t.a3/100),O=Math.asin(t.a5/100),W=we(.1),F=Math.abs(m-k),ct=Math.abs(O-m),u=Math.max(F,ct),I=m-k,J=O-m,G=Math.abs(t.L2/I),X=Math.abs(t.L4/J),Ht=Jt(0,0),Q=Ht.translatePolar(k,t.L1),ht=Q.translatePolar(k+Math.sign(I)*a,G),vt=ht.translatePolar(k-Math.sign(I)*a+I/2,G),gt=ht.translatePolar(k-Math.sign(I)*a+I,G),ft=gt.translatePolar(m,t.L3),st=ft.translatePolar(m+Math.sign(J)*a,X),et=st.translatePolar(m-Math.sign(J)*a+J/2,X),E=st.translatePolar(m-Math.sign(J)*a+J,X),xt=E.translatePolar(O,t.L5),K=Math.atan2(xt.cy,xt.cx),ut=100*Math.sin(K),nt=T-R,tt=Math.floor(nt+t.L1/T),Nt=nt+t.L1-tt*T,Pt=Nt/G,Ft=T/G,V=Math.floor((Nt+t.L2)/T),it=Nt+t.L2-V*T,wt=Math.floor((it+t.L3)/T),dt=it+t.L3-wt*T,Y=dt/X,rt=T/X,p=Math.floor((dt+t.L4)/T),at=dt+t.L4-p*T,kt=Math.floor((at+t.L5)/T),Ot=tt+V+wt+p+kt,It=Math.floor((nt+b)/T),w=g+S;if(F<W)throw`err107: a1 ${n(t.a1)} and a3 ${n(t.a3)} (degree) are too closed`;if(ct<W)throw`err107: a3 ${n(t.a3)} and a5 ${n(t.a5)} (degree) are too closed`;o.logstr+=`Slope length: ${n(b)}, X ${n(xt.cx)} Y ${n(xt.cy)} m, average ${n(ut)} % ${n(Qt(K))} degree
`,o.logstr+=`Slope max transition: aDiffMax ${n(Qt(u))} degree
`,o.logstr+=`Beam number: ${Ot} ${It}, size: ${n(2*v)} x ${n(2*R)} m
`,d.addSecond(M(-v,0,2*v,g)),d.addMainO(M(-v+A,g,x,S)),d.addMainO(M(_,g,x,S));for(let Lt=0;Lt<11;Lt++)l.addSecond(M(Lt*T,-v,2*R,2*v));l.addMainO(M(0,_,2*R+10*T,x)),l.addMainO(M(0,-_-x,2*R+10*T,x));const Dt=Mt(Ht.cx,Ht.cy).addSegStrokeA(Q.cx,Q.cy).addPointA(vt.cx,vt.cy).addPointA(gt.cx,gt.cy).addSegArc2().addSegStrokeA(ft.cx,ft.cy).addPointA(et.cx,et.cy).addPointA(E.cx,E.cy).addSegArc2().addSegStrokeA(xt.cx,xt.cy);s.addSecond(Dt);for(let Lt=0;Lt<tt;Lt++){const qt=Ht.translatePolar(k,(Lt+1)*T-nt);s.addMainO(f(qt.cx,qt.cy,k))}for(let Lt=0;Lt<V;Lt++){const qt=k+Math.sign(I)*(-a+(Lt+1)*Ft-Pt),Xt=ht.translatePolar(qt,G);s.addMainO(f(Xt.cx,Xt.cy,qt+Math.sign(I)*a))}for(let Lt=0;Lt<wt;Lt++){const qt=gt.translatePolar(m,(Lt+1)*T-it);s.addMainO(f(qt.cx,qt.cy,m))}for(let Lt=0;Lt<p;Lt++){const qt=m+Math.sign(J)*(-a+(Lt+1)*rt-Y),Xt=st.translatePolar(qt,X);s.addMainO(f(Xt.cx,Xt.cy,qt+Math.sign(J)*a))}for(let Lt=0;Lt<kt;Lt++){const qt=E.translatePolar(O,(Lt+1)*T-at);s.addMainO(f(qt.cx,qt.cy,O))}i.mergeFigure(s,!0);const B=Ht.translatePolar(k+a,g),bt=Ht.translatePolar(k+a,w),L=Q.translatePolar(k+a,g),Gt=Q.translatePolar(k+a,w),Vt=vt.translatePolar((k+m)/2+a,g),q=vt.translatePolar((k+m)/2+a,w),H=gt.translatePolar(m+a,g),y=gt.translatePolar(m+a,w),C=ft.translatePolar(m+a,g),P=ft.translatePolar(m+a,w),Z=et.translatePolar((m+O)/2+a,g),D=et.translatePolar((m+O)/2+a,w),ot=E.translatePolar(O+a,g),Wt=E.translatePolar(O+a,w),St=xt.translatePolar(O+a,g),yt=xt.translatePolar(O+a,w),$t=Mt(B.cx,B.cy).addSegStrokeA(L.cx,L.cy).addPointA(Vt.cx,Vt.cy).addPointA(H.cx,H.cy).addSegArc2().addSegStrokeA(C.cx,C.cy).addPointA(Z.cx,Z.cy).addPointA(ot.cx,ot.cy).addSegArc2().addSegStrokeA(St.cx,St.cy).addSegStrokeA(yt.cx,yt.cy).addSegStrokeA(Wt.cx,Wt.cy).addPointA(D.cx,D.cy).addPointA(P.cx,P.cy).addSegArc2().addSegStrokeA(y.cx,y.cy).addPointA(q.cx,q.cy).addPointA(Gt.cx,Gt.cy).addSegArc2().addSegStrokeA(bt.cx,bt.cy).closeSegStroke();i.addMainO($t),s.addSecond($t),o.fig={faceBeam:s,faceRail:i,faceTop:l,faceSection:d};const lt=o.partName;o.vol={extrudes:[{outName:`subpax_${lt}_beam`,face:`${lt}_faceBeam`,extrudeMethod:j.eLinearOrtho,length:2*v,rotate:[0,0,0],translate:[0,0,0]},{outName:`subpax_${lt}_rail1`,face:`${lt}_faceRail`,extrudeMethod:j.eLinearOrtho,length:x,rotate:[0,0,0],translate:[0,0,A]},{outName:`subpax_${lt}_rail2`,face:`${lt}_faceRail`,extrudeMethod:j.eLinearOrtho,length:x,rotate:[0,0,0],translate:[0,0,v+_]}],volumes:[{outName:`pax_${lt}`,boolMethod:ee.eUnion,inList:[`subpax_${lt}_beam`,`subpax_${lt}_rail1`,`subpax_${lt}_rail2`]}]},o.sub={},o.logstr+=`trackXZ drawn successfully!
`,o.calcErr=!1}catch(f){o.logstr+=f,console.log(f)}return o}var In={pTitle:"trackXZ",pDescription:"simulation of train-capsule on XZ-track",pDef:Ms,pGeom:On},Ws={partName:"square",params:[e("W1","mm",100,5,500,1),e("Di","mm",50,2,500,1),Tt("Details and thickness"),e("R1","mm",0,0,50,1),e("T1","mm",30,1,500,1)],paramSvg:{W1:"square_top.svg",Di:"square_top.svg",R1:"square_top.svg",T1:"square_top.svg"},sim:{tMax:180,tStep:.5,tUpdate:500}};function Bn(c,t,r=""){const o=ae(Ws.partName+r),s=U(),i=U();o.logstr+=`${o.partName} simTime: ${c}
`;try{const l=t.Di/2,d=t.W1/2,h=t.W1**2-Math.PI*l**2,f=h*t.T1;if(t.W1<t.Di)throw`err069: W1 ${t.W1} is too small compare to Di ${t.Di}`;o.logstr+=`Surface ${n(h)} mm2, volume ${n(f)} mm3
`;const a=Mt(-d,-d).addCornerRounded(t.R1).addSegStrokeR(t.W1,0).addCornerRounded(t.R1).addSegStrokeR(0,t.W1).addCornerRounded(t.R1).addSegStrokeR(-t.W1,0).addCornerRounded(t.R1).closeSegStroke(),b=z(0,0,l);s.addMainOI([a,b]),i.addMainO(M(-d,0,2*d,t.T1)),i.addSecond(M(-l,0,2*l,t.T1)),o.fig={faceSquare:s,faceHeight:i};const g=o.partName;o.vol={extrudes:[{outName:`subpax_${g}_square`,face:`${g}_faceSquare`,extrudeMethod:j.eLinearOrtho,length:t.T1,rotate:[0,0,0],translate:[0,0,0]}],volumes:[{outName:`pax_${g}`,boolMethod:ee.eUnion,inList:[`subpax_${g}_square`]}]},o.sub={},o.logstr+=`square drawn successfully!
`,o.calcErr=!1}catch(l){o.logstr+=l,console.log(l)}return o}var Fn={pTitle:"square",pDescription:"simple square shape for experimenting systemix",pDef:Ws,pGeom:Bn},Ts={partName:"triangle",params:[e("W1","mm",100,5,500,1),e("T1","mm",20,1,500,1),e("E1","mm",10,1,500,1),e("N1","triangles",3,1,20,1),Tt("Details and hole"),e("R1","mm",0,0,50,1),e("Di","mm",50,2,500,1)],paramSvg:{W1:"triangle_top.svg",T1:"triangle_side.svg",E1:"triangle_side.svg",N1:"triangle_side.svg",R1:"triangle_top.svg",Di:"triangle_top.svg"},sim:{tMax:180,tStep:.5,tUpdate:500}};function mn(c,t,r=""){const o=ae(Ts.partName+r),s=U(),i=U();o.logstr+=`${o.partName} simTime: ${c}
`;try{const l=t.Di/2,d=t.W1/2,h=d*Math.tan(Math.PI/6),f=d*Math.tan(Math.PI/3),a=d*f-Math.PI*l**2,b=a*t.T1,g=t.T1+t.E1;if(h<l)throw`err077: W1 ${t.W1} is too small compare to Di ${t.Di}`;o.logstr+=`Surface ${n(a)} mm2, volume ${n(b)} mm3
`;const S=Mt(-d,-h).addCornerRounded(t.R1).addSegStrokeR(t.W1,0).addCornerRounded(t.R1).addSegStrokeRP(2*Math.PI/3,t.W1).addCornerRounded(t.R1).closeSegStroke(),_=z(0,0,l);s.addMainOI([S,_]);for(let R=0;R<t.N1;R++){const v=R*g;i.addMainO(M(-h,v,f,t.T1)),i.addSecond(M(-l,v,2*l,t.T1))}o.fig={faceTriangle:s,faceHeight:i};const x=o.partName,A=[...Array(t.N1).keys()];o.vol={extrudes:A.map(R=>({outName:`subpax_${x}_tri${R}`,face:`${x}_faceTriangle`,extrudeMethod:j.eLinearOrtho,length:t.T1,rotate:[0,0,0],translate:[0,0,R*g]})),volumes:[{outName:`pax_${x}`,boolMethod:ee.eUnion,inList:A.map(R=>`subpax_${x}_tri${R}`)}]},o.sub={},o.logstr+=`triangle drawn successfully!
`,o.calcErr=!1}catch(l){o.logstr+=l,console.log(l)}return o}var Jn={pTitle:"triangle",pDescription:"triangle sandwich shape for experimenting systemix",pDef:Ts,pGeom:mn},vs={partName:"cylinder",params:[e("D1","mm",100,5,500,1),e("Di","mm",50,2,500,1),Tt("Thickness"),e("T1","mm",30,1,500,1)],paramSvg:{D1:"cylinder_top.svg",Di:"cylinder_top.svg",T1:"cylinder_top.svg"},sim:{tMax:180,tStep:.5,tUpdate:500}};function qn(c,t,r=""){const o=ae(vs.partName+r),s=U(),i=U();o.logstr+=`${o.partName} simTime: ${c}
`;try{const l=t.Di/2,d=t.D1/2,h=Math.PI*d**2-Math.PI*l**2,f=h*t.T1;if(d<l)throw`err071: D1 ${t.D1} is too small compare to Di ${t.Di}`;o.logstr+=`Surface ${n(h)} mm2, volume ${n(f)} mm3
`;const a=z(0,0,d),b=z(0,0,l);s.addMainOI([a,b]),i.addMainO(M(-d,0,2*d,t.T1)),i.addSecond(M(-l,0,2*l,t.T1)),o.fig={faceCylinder:s,faceHeight:i};const g=o.partName;o.vol={extrudes:[{outName:`subpax_${g}_cyl`,face:`${g}_faceCylinder`,extrudeMethod:j.eLinearOrtho,length:t.T1,rotate:[0,0,0],translate:[0,0,0]}],volumes:[{outName:`pax_${g}`,boolMethod:ee.eIdentity,inList:[`subpax_${g}_cyl`]}]},o.sub={},o.logstr+=`cylinder drawn successfully!
`,o.calcErr=!1}catch(l){o.logstr+=l,console.log(l)}return o}var jn={pTitle:"cylinder",pDescription:"simple cylinder shape for experimenting systemix",pDef:vs,pGeom:qn};const Ps={"desi77/door1arc":qs,"desi77/stoneTower":Gs,"desi77/house":Ys,"desi77/factory":Us,"desi77/springTorqueA":zs,"desi77/plugTorque":Qs,"desi77/springTorqueB":tn,"desi77/springTorqueC":on,"desi77/springWorm":nn,"desi77/springOne":dn,"desi77/springSide":ln,"desi77/springInt":an,"desi77/heliostat":fn,"desi77/minifoot":Sn,"desi77/minihelio":xn,"desi77/minimir":Rn,"desi77/rccar":Wn,"desi77/singleBone":vn,"desi77/doubleBone":bn,"desi77/pcar":wn,"desi77/capsule":Ln,"desi77/tunnel":yn,"desi77/bridge":Dn,"desi77/trackXY":Cn,"desi77/trackXZ":In,"desi77/square":Fn,"desi77/triangle":Jn,"desi77/cylinder":jn};function Gn(c){const t=/^.*\//g;return c.replace(t,"")}function Xn(c){const t={};for(const r of Object.keys(c)){const o=Gn(r);t[o]=`/${r}`}return t}function Yn(c){const t=[];for(const r of Object.keys(c))t.push(r);return t}const Un=Xn(Ps),Vn=Yn(Ps);export{Ps as a,Un as b,Vn as d};
